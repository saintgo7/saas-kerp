# Go 중심 K-ERP 개발 상세 계획서

## 1. Go 선택 근거

### 1.1 PHP(Laravel) 대비 Go 장점

| 항목 | PHP/Laravel | Go | 선택 이유 |
|------|-------------|-----|----------|
| **성능** | 요청당 메모리 20-50MB | 요청당 메모리 2-5MB | 10배 효율적 |
| **동시성** | 프로세스 기반, 제한적 | 고루틴 10만+ 동시 처리 | ERP 대량 처리 필수 |
| **타입 안전성** | 런타임 오류 | 컴파일 타임 검증 | 회계 시스템 안정성 |
| **배포** | PHP + 웹서버 + 의존성 | 단일 바이너리 | 운영 단순화 |
| **클라우드 비용** | 높음 (리소스 다소비) | 낮음 (경량) | SaaS 수익성 |
| **확장성** | 수직 확장 중심 | 수평 확장 용이 | 멀티테넌트 필수 |

### 1.2 ERP 도메인에서 Go의 이점

```
┌─────────────────────────────────────────────────────────────────┐
│                    ERP에서 Go가 빛나는 영역                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  [대량 전표 처리]                                                │
│  • 월말 결산 시 수천~수만 건 전표 일괄 처리                      │
│  • Go: 고루틴으로 병렬 처리 → 수 초 내 완료                      │
│  • PHP: 순차 처리 → 수 분 소요, 타임아웃 위험                    │
│                                                                  │
│  [실시간 잔액 계산]                                              │
│  • 계정별 잔액, 거래처별 잔액 실시간 조회                        │
│  • Go: 인메모리 캐시 + 고루틴 → 즉시 응답                        │
│  • PHP: 매번 DB 쿼리 → 지연 발생                                 │
│                                                                  │
│  [4대보험 EDI 파일 생성]                                         │
│  • 수백~수천 명 직원 데이터 일괄 처리                            │
│  • Go: 바이트 레벨 제어, 빠른 파일 I/O                           │
│  • PHP: 문자열 처리 오버헤드                                     │
│                                                                  │
│  [세금계산서 대량 발행]                                          │
│  • 월말 수천 건 세금계산서 일괄 발행                             │
│  • Go: 동시 API 호출 + 재시도 로직                               │
│  • PHP: 순차 처리, 외부 API 병목                                 │
│                                                                  │
│  [급여 계산 엔진]                                                │
│  • 복잡한 계산 로직 (4대보험, 소득세, 수당 등)                   │
│  • Go: 정적 타입으로 계산 오류 방지                              │
│  • PHP: 타입 혼동으로 인한 계산 오류 위험                        │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 2. Go 기술 스택 상세

### 2.1 핵심 기술 스택

```
┌─────────────────────────────────────────────────────────────────┐
│                     Go 중심 기술 스택                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  [백엔드]                                                        │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ Language:      Go 1.22+                                 │    │
│  │ Web Framework: Gin (성숙도) 또는 Echo (성능)           │    │
│  │ ORM:           GORM v2 + sqlc (복잡 쿼리)              │    │
│  │ Validation:    go-playground/validator                  │    │
│  │ Config:        Viper                                    │    │
│  │ Logging:       Zap (Uber)                               │    │
│  │ DI:            Wire (Google) 또는 fx (Uber)            │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  [API & 통신]                                                    │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ API Style:     REST + gRPC (내부 서비스)                │    │
│  │ API Docs:      Swagger/OpenAPI (swaggo)                 │    │
│  │ HTTP Client:   resty                                    │    │
│  │ Message Queue: NATS JetStream                           │    │
│  │ WebSocket:     gorilla/websocket                        │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  [데이터]                                                        │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ Primary DB:    PostgreSQL 16                            │    │
│  │ Cache:         Redis 7 (go-redis/redis)                │    │
│  │ Search:        Meilisearch                              │    │
│  │ File Storage:  MinIO (S3 호환)                         │    │
│  │ Migrations:    golang-migrate/migrate                   │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  [인프라]                                                        │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ Container:     Docker                                   │    │
│  │ Orchestration: Kubernetes                               │    │
│  │ Service Mesh:  Istio (선택)                            │    │
│  │ CI/CD:         GitHub Actions                           │    │
│  │ Monitoring:    Prometheus + Grafana                     │    │
│  │ Tracing:       Jaeger (OpenTelemetry)                  │    │
│  │ API Gateway:   Kong 또는 Traefik                       │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  [프론트엔드]                                                    │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ Web:           React 18 + TypeScript + Vite             │    │
│  │ State:         Zustand 또는 TanStack Query             │    │
│  │ UI:            Shadcn/ui + Tailwind CSS                │    │
│  │ Mobile:        React Native + Expo                      │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 2.2 Go 웹 프레임워크 비교 및 선정

| 프레임워크 | 성능 | 성숙도 | 생태계 | 추천 |
|------------|------|--------|--------|------|
| **Gin** | ★★★★☆ | ★★★★★ | ★★★★★ | ✅ **1순위** |
| Echo | ★★★★★ | ★★★★☆ | ★★★★☆ | 2순위 |
| Fiber | ★★★★★ | ★★★☆☆ | ★★★☆☆ | 고성능 필요시 |
| Chi | ★★★★☆ | ★★★★☆ | ★★★☆☆ | 미니멀 선호시 |

**선정: Gin**
- 가장 많은 레퍼런스와 커뮤니티
- 풍부한 미들웨어 생태계
- 안정적인 production 사용 사례
- 한국 Go 개발자 대부분 Gin 경험 보유

### 2.3 ORM/데이터 접근 전략

```
┌─────────────────────────────────────────────────────────────────┐
│                   데이터 접근 계층 전략                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  [3계층 접근 방식]                                               │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │              Layer 1: GORM (기본 CRUD)                  │    │
│  │                                                         │    │
│  │  • 단순 CRUD 작업                                       │    │
│  │  • 모델 정의 및 관계 설정                               │    │
│  │  • 마이그레이션 관리                                    │    │
│  │  • 생산성 우선 영역                                     │    │
│  │                                                         │    │
│  │  예: 기준정보, 사용자, 설정 등                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                         │                                        │
│                         ▼                                        │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │              Layer 2: sqlc (복잡 쿼리)                  │    │
│  │                                                         │    │
│  │  • SQL 작성 → Go 코드 자동 생성                        │    │
│  │  • 타입 안전한 쿼리                                     │    │
│  │  • 복잡한 집계/조인/서브쿼리                           │    │
│  │  • 성능 최적화 필요 영역                                │    │
│  │                                                         │    │
│  │  예: 재무제표, 원장 집계, 급여 계산                     │    │
│  └─────────────────────────────────────────────────────────┘    │
│                         │                                        │
│                         ▼                                        │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │           Layer 3: Raw SQL (특수 케이스)                │    │
│  │                                                         │    │
│  │  • 데이터베이스 특화 기능                               │    │
│  │  • 벌크 작업 (COPY, bulk insert)                       │    │
│  │  • PostgreSQL 고급 기능 (CTE, Window Function)         │    │
│  │                                                         │    │
│  │  예: EDI 파일 대량 처리, 월말 마감 배치                 │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 3. 프로젝트 구조

### 3.1 모노레포 구조 (권장)

```
k-erp/
├── cmd/                              # 실행 진입점
│   ├── api/                          # API 서버
│   │   └── main.go
│   ├── worker/                       # 백그라운드 워커
│   │   └── main.go
│   └── migrate/                      # 마이그레이션 CLI
│       └── main.go
│
├── internal/                         # 비공개 패키지 (외부 import 불가)
│   ├── domain/                       # 도메인 모델 (엔티티)
│   │   ├── company.go
│   │   ├── user.go
│   │   ├── account.go
│   │   ├── voucher.go
│   │   ├── employee.go
│   │   └── tax_invoice.go
│   │
│   ├── repository/                   # 데이터 접근 계층
│   │   ├── company_repo.go
│   │   ├── account_repo.go
│   │   ├── voucher_repo.go
│   │   └── interfaces.go             # Repository 인터페이스
│   │
│   ├── service/                      # 비즈니스 로직
│   │   ├── accounting/               # 회계 서비스
│   │   │   ├── voucher_service.go
│   │   │   ├── ledger_service.go
│   │   │   └── financial_statement.go
│   │   ├── tax/                      # 세금 서비스
│   │   │   ├── tax_invoice_service.go
│   │   │   ├── vat_report_service.go
│   │   │   └── popbill_client.go
│   │   ├── hr/                       # 인사/급여 서비스
│   │   │   ├── employee_service.go
│   │   │   ├── payroll_service.go
│   │   │   └── insurance_service.go
│   │   └── edi/                      # EDI 서비스
│   │       ├── edi_generator.go
│   │       └── edi_parser.go
│   │
│   ├── handler/                      # HTTP 핸들러 (컨트롤러)
│   │   ├── auth_handler.go
│   │   ├── company_handler.go
│   │   ├── account_handler.go
│   │   ├── voucher_handler.go
│   │   ├── tax_invoice_handler.go
│   │   ├── employee_handler.go
│   │   └── payroll_handler.go
│   │
│   ├── middleware/                   # HTTP 미들웨어
│   │   ├── auth.go                   # JWT 인증
│   │   ├── tenant.go                 # 멀티테넌트 식별
│   │   ├── rbac.go                   # 권한 검사
│   │   ├── logging.go                # 요청 로깅
│   │   └── ratelimit.go              # Rate Limiting
│   │
│   ├── dto/                          # Data Transfer Objects
│   │   ├── request/
│   │   │   ├── voucher_request.go
│   │   │   └── employee_request.go
│   │   └── response/
│   │       ├── voucher_response.go
│   │       └── financial_response.go
│   │
│   └── infrastructure/               # 인프라 연동
│       ├── database/
│       │   ├── postgres.go
│       │   └── redis.go
│       ├── queue/
│       │   └── nats.go
│       └── storage/
│           └── minio.go
│
├── pkg/                              # 공개 패키지 (외부 import 가능)
│   ├── config/                       # 설정 관리
│   │   └── config.go
│   ├── logger/                       # 로깅 유틸리티
│   │   └── zap.go
│   ├── validator/                    # 유효성 검증
│   │   └── validator.go
│   ├── errors/                       # 에러 정의
│   │   └── errors.go
│   ├── pagination/                   # 페이지네이션
│   │   └── pagination.go
│   └── korean/                       # 한국 특화 유틸리티
│       ├── business_number.go        # 사업자번호 검증
│       ├── resident_number.go        # 주민번호 검증
│       └── currency.go               # 원화 처리
│
├── db/                               # 데이터베이스
│   ├── migrations/                   # 마이그레이션 파일
│   │   ├── 000001_create_companies.up.sql
│   │   ├── 000001_create_companies.down.sql
│   │   ├── 000002_create_accounts.up.sql
│   │   └── ...
│   ├── queries/                      # sqlc 쿼리 파일
│   │   ├── company.sql
│   │   ├── account.sql
│   │   ├── voucher.sql
│   │   └── ledger.sql
│   └── seeds/                        # 초기 데이터
│       ├── accounts_kifrs.sql        # K-IFRS 계정과목
│       └── permissions.sql           # 기본 권한
│
├── api/                              # API 정의
│   ├── openapi/
│   │   └── openapi.yaml              # OpenAPI 스펙
│   └── proto/                        # gRPC 프로토 (내부 통신용)
│       └── internal.proto
│
├── web/                              # 프론트엔드 (React)
│   ├── src/
│   │   ├── components/
│   │   ├── pages/
│   │   ├── hooks/
│   │   ├── services/
│   │   └── store/
│   ├── package.json
│   └── vite.config.ts
│
├── deployments/                      # 배포 설정
│   ├── docker/
│   │   ├── Dockerfile
│   │   ├── Dockerfile.worker
│   │   └── docker-compose.yml
│   └── k8s/
│       ├── base/
│       ├── overlays/
│       │   ├── development/
│       │   ├── staging/
│       │   └── production/
│       └── kustomization.yaml
│
├── scripts/                          # 유틸리티 스크립트
│   ├── setup.sh
│   ├── generate.sh                   # 코드 생성
│   └── test.sh
│
├── docs/                             # 문서
│   ├── plan/                         # 기획 문서 (기존)
│   ├── api/                          # API 문서
│   └── architecture/                 # 아키텍처 문서
│
├── go.mod
├── go.sum
├── Makefile
├── .env.example
├── .gitignore
├── .golangci.yml                     # 린터 설정
└── README.md
```

### 3.2 Clean Architecture 레이어

```
┌─────────────────────────────────────────────────────────────────┐
│                    Clean Architecture 구조                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                      Handler Layer                       │    │
│  │                    (HTTP/gRPC 핸들러)                    │    │
│  │                                                          │    │
│  │   • HTTP 요청/응답 처리                                  │    │
│  │   • 입력 유효성 검증                                     │    │
│  │   • DTO 변환                                             │    │
│  │   • 에러 응답 포맷팅                                     │    │
│  └─────────────────────────────────────────────────────────┘    │
│                              │                                   │
│                              ▼                                   │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                      Service Layer                       │    │
│  │                      (비즈니스 로직)                     │    │
│  │                                                          │    │
│  │   • 핵심 비즈니스 로직                                   │    │
│  │   • 트랜잭션 관리                                        │    │
│  │   • 도메인 규칙 적용                                     │    │
│  │   • 외부 서비스 조율                                     │    │
│  └─────────────────────────────────────────────────────────┘    │
│                              │                                   │
│                              ▼                                   │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                    Repository Layer                      │    │
│  │                      (데이터 접근)                       │    │
│  │                                                          │    │
│  │   • 데이터베이스 CRUD                                    │    │
│  │   • 쿼리 최적화                                          │    │
│  │   • 캐시 관리                                            │    │
│  │   • 외부 저장소 연동                                     │    │
│  └─────────────────────────────────────────────────────────┘    │
│                              │                                   │
│                              ▼                                   │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                      Domain Layer                        │    │
│  │                      (엔티티/값객체)                     │    │
│  │                                                          │    │
│  │   • 비즈니스 엔티티 정의                                 │    │
│  │   • 불변 규칙 (invariants)                              │    │
│  │   • 값 객체 (Value Objects)                             │    │
│  │   • 도메인 이벤트                                        │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  [의존성 규칙]                                                  │
│  Handler → Service → Repository → Domain                        │
│  (외부 → 내부로만 의존, 역방향 의존 금지)                      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 4. 핵심 도메인 모델 설계

### 4.1 회사/테넌트 (Company)

```go
// internal/domain/company.go

package domain

import (
    "time"
    "github.com/google/uuid"
)

type Company struct {
    ID              uuid.UUID  `gorm:"type:uuid;primary_key"`
    BusinessNumber  string     `gorm:"size:10;uniqueIndex;not null"` // 사업자등록번호
    Name            string     `gorm:"size:100;not null"`
    CEOName         string     `gorm:"size:50;not null"`
    BusinessType    string     `gorm:"size:100"`                      // 업태
    BusinessItem    string     `gorm:"size:100"`                      // 종목
    Address         string     `gorm:"size:500"`
    Phone           string     `gorm:"size:20"`
    Email           string     `gorm:"size:100"`
    FiscalYearStart int        `gorm:"default:1"`                     // 회계연도 시작월
    CurrencyCode    string     `gorm:"size:3;default:'KRW'"`
    IsActive        bool       `gorm:"default:true"`

    // 팝빌 연동 정보
    PopbillID       string     `gorm:"size:50"`
    PopbillLinked   bool       `gorm:"default:false"`

    // Timestamps
    CreatedAt       time.Time
    UpdatedAt       time.Time
    DeletedAt       *time.Time `gorm:"index"`

    // Relations
    Branches        []Branch
    Users           []User
    Accounts        []Account
}

// 사업자번호 유효성 검증
func (c *Company) ValidateBusinessNumber() bool {
    // 사업자번호 체크 로직
    return validateKoreanBusinessNumber(c.BusinessNumber)
}
```

### 4.2 계정과목 (Account)

```go
// internal/domain/account.go

package domain

type AccountType string

const (
    AccountTypeAsset     AccountType = "ASSET"      // 자산
    AccountTypeLiability AccountType = "LIABILITY"  // 부채
    AccountTypeEquity    AccountType = "EQUITY"     // 자본
    AccountTypeRevenue   AccountType = "REVENUE"    // 수익
    AccountTypeExpense   AccountType = "EXPENSE"    // 비용
)

type Account struct {
    ID          uuid.UUID   `gorm:"type:uuid;primary_key"`
    CompanyID   uuid.UUID   `gorm:"type:uuid;index;not null"`
    Code        string      `gorm:"size:10;not null"`              // 계정코드
    Name        string      `gorm:"size:100;not null"`             // 계정명
    NameEn      string      `gorm:"size:100"`                      // 영문명
    Type        AccountType `gorm:"size:20;not null"`              // 계정구분
    ParentID    *uuid.UUID  `gorm:"type:uuid"`                     // 상위계정
    Level       int         `gorm:"default:1"`                     // 계층레벨
    IsActive    bool        `gorm:"default:true"`
    IsSystem    bool        `gorm:"default:false"`                 // 시스템계정(수정불가)

    // K-IFRS 관련
    FSCategory  string      `gorm:"size:50"`                       // 재무제표 분류
    FSOrder     int         `gorm:"default:0"`                     // 재무제표 표시순서

    CreatedAt   time.Time
    UpdatedAt   time.Time

    // Relations
    Company     Company
    Parent      *Account
    Children    []Account `gorm:"foreignKey:ParentID"`
}

// 차변/대변 기본 방향
func (a *Account) DefaultDebitCredit() string {
    switch a.Type {
    case AccountTypeAsset, AccountTypeExpense:
        return "DEBIT"
    case AccountTypeLiability, AccountTypeEquity, AccountTypeRevenue:
        return "CREDIT"
    }
    return "DEBIT"
}
```

### 4.3 전표 (Voucher)

```go
// internal/domain/voucher.go

package domain

type VoucherStatus string

const (
    VoucherStatusDraft    VoucherStatus = "DRAFT"     // 작성중
    VoucherStatusPending  VoucherStatus = "PENDING"   // 승인대기
    VoucherStatusApproved VoucherStatus = "APPROVED"  // 승인완료
    VoucherStatusRejected VoucherStatus = "REJECTED"  // 반려
    VoucherStatusCanceled VoucherStatus = "CANCELED"  // 취소
)

type Voucher struct {
    ID            uuid.UUID     `gorm:"type:uuid;primary_key"`
    CompanyID     uuid.UUID     `gorm:"type:uuid;index;not null"`
    VoucherNumber string        `gorm:"size:20;not null"`           // 전표번호
    VoucherDate   time.Time     `gorm:"type:date;not null;index"`   // 전표일자
    Description   string        `gorm:"size:500"`                   // 적요
    Status        VoucherStatus `gorm:"size:20;default:'DRAFT'"`

    TotalDebit    int64         `gorm:"default:0"`                  // 총 차변금액
    TotalCredit   int64         `gorm:"default:0"`                  // 총 대변금액

    // 승인 관련
    CreatedBy     uuid.UUID     `gorm:"type:uuid"`
    ApprovedBy    *uuid.UUID    `gorm:"type:uuid"`
    ApprovedAt    *time.Time

    CreatedAt     time.Time
    UpdatedAt     time.Time

    // Relations
    Lines         []VoucherLine
    Company       Company
    Creator       User `gorm:"foreignKey:CreatedBy"`
}

// 차대변 균형 검증
func (v *Voucher) IsBalanced() bool {
    return v.TotalDebit == v.TotalCredit
}

type VoucherLine struct {
    ID          uuid.UUID `gorm:"type:uuid;primary_key"`
    VoucherID   uuid.UUID `gorm:"type:uuid;index;not null"`
    LineNumber  int       `gorm:"not null"`
    AccountID   uuid.UUID `gorm:"type:uuid;not null"`
    Description string    `gorm:"size:200"`
    DebitAmount int64     `gorm:"default:0"`                       // 차변금액
    CreditAmount int64    `gorm:"default:0"`                       // 대변금액

    // 거래처 연결 (선택)
    PartnerID   *uuid.UUID `gorm:"type:uuid"`

    // Relations
    Account     Account
    Partner     *Partner
}
```

### 4.4 직원/급여 (Employee/Payroll)

```go
// internal/domain/employee.go

package domain

type EmployeeStatus string

const (
    EmployeeStatusActive   EmployeeStatus = "ACTIVE"    // 재직
    EmployeeStatusLeave    EmployeeStatus = "LEAVE"     // 휴직
    EmployeeStatusResigned EmployeeStatus = "RESIGNED"  // 퇴사
)

type Employee struct {
    ID              uuid.UUID      `gorm:"type:uuid;primary_key"`
    CompanyID       uuid.UUID      `gorm:"type:uuid;index;not null"`
    EmployeeNumber  string         `gorm:"size:20;not null"`           // 사번
    Name            string         `gorm:"size:50;not null"`
    ResidentNumber  string         `gorm:"size:14"`                    // 주민등록번호 (암호화)
    Email           string         `gorm:"size:100"`
    Phone           string         `gorm:"size:20"`
    Address         string         `gorm:"size:500"`

    DepartmentID    *uuid.UUID     `gorm:"type:uuid"`
    PositionID      *uuid.UUID     `gorm:"type:uuid"`

    HireDate        time.Time      `gorm:"type:date;not null"`
    ResignDate      *time.Time     `gorm:"type:date"`
    Status          EmployeeStatus `gorm:"size:20;default:'ACTIVE'"`

    // 급여 정보
    BaseSalary      int64          `gorm:"default:0"`                  // 기본급

    // 4대보험 정보
    NationalPensionNumber   string `gorm:"size:20"`                    // 국민연금 관리번호
    HealthInsuranceNumber   string `gorm:"size:20"`                    // 건강보험 자격취득번호
    EmploymentInsuranceNumber string `gorm:"size:20"`                  // 고용보험 피보험자번호

    CreatedAt       time.Time
    UpdatedAt       time.Time

    // Relations
    Department      *Department
    Position        *Position
    PayrollRecords  []PayrollRecord
}
```

---

## 5. API 설계

### 5.1 API 엔드포인트 구조

```
┌─────────────────────────────────────────────────────────────────┐
│                        API 엔드포인트                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  [인증] /api/v1/auth                                            │
│  ├── POST   /login                  로그인                      │
│  ├── POST   /logout                 로그아웃                    │
│  ├── POST   /refresh                토큰 갱신                   │
│  ├── POST   /password/reset         비밀번호 재설정             │
│  └── GET    /me                     내 정보                     │
│                                                                  │
│  [회사] /api/v1/companies                                       │
│  ├── GET    /                       회사 목록 (관리자)          │
│  ├── POST   /                       회사 등록                   │
│  ├── GET    /:id                    회사 상세                   │
│  ├── PUT    /:id                    회사 수정                   │
│  └── GET    /:id/branches           사업장 목록                 │
│                                                                  │
│  [계정과목] /api/v1/accounts                                    │
│  ├── GET    /                       계정과목 목록               │
│  ├── POST   /                       계정과목 등록               │
│  ├── GET    /:id                    계정과목 상세               │
│  ├── PUT    /:id                    계정과목 수정               │
│  ├── DELETE /:id                    계정과목 삭제               │
│  └── GET    /tree                   계정과목 트리               │
│                                                                  │
│  [전표] /api/v1/vouchers                                        │
│  ├── GET    /                       전표 목록                   │
│  ├── POST   /                       전표 등록                   │
│  ├── GET    /:id                    전표 상세                   │
│  ├── PUT    /:id                    전표 수정                   │
│  ├── DELETE /:id                    전표 삭제                   │
│  ├── POST   /:id/approve            전표 승인                   │
│  ├── POST   /:id/reject             전표 반려                   │
│  └── POST   /:id/cancel             전표 취소                   │
│                                                                  │
│  [원장] /api/v1/ledgers                                         │
│  ├── GET    /general                총계정원장                  │
│  ├── GET    /account/:id            계정별원장                  │
│  └── GET    /partner/:id            거래처별원장                │
│                                                                  │
│  [재무제표] /api/v1/financial-statements                        │
│  ├── GET    /balance-sheet          재무상태표                  │
│  ├── GET    /income-statement       손익계산서                  │
│  ├── GET    /cash-flow              현금흐름표                  │
│  └── GET    /trial-balance          시산표                      │
│                                                                  │
│  [세금계산서] /api/v1/tax-invoices                              │
│  ├── GET    /                       세금계산서 목록             │
│  ├── POST   /                       세금계산서 발행             │
│  ├── GET    /:id                    세금계산서 상세             │
│  ├── POST   /:id/cancel             세금계산서 취소             │
│  ├── GET    /summary                매출/매입 집계              │
│  └── GET    /vat-report             부가세 신고자료             │
│                                                                  │
│  [직원] /api/v1/employees                                       │
│  ├── GET    /                       직원 목록                   │
│  ├── POST   /                       직원 등록                   │
│  ├── GET    /:id                    직원 상세                   │
│  ├── PUT    /:id                    직원 수정                   │
│  └── POST   /:id/resign             퇴사 처리                   │
│                                                                  │
│  [급여] /api/v1/payroll                                         │
│  ├── GET    /periods                급여 기간 목록              │
│  ├── POST   /calculate              급여 계산                   │
│  ├── GET    /:period_id             급여 내역                   │
│  ├── POST   /:period_id/confirm     급여 확정                   │
│  └── GET    /:period_id/payslip/:id 급여명세서                  │
│                                                                  │
│  [4대보험] /api/v1/insurance                                    │
│  ├── POST   /acquisition            자격취득 신고               │
│  ├── POST   /loss                   자격상실 신고               │
│  ├── POST   /salary-report          보수총액 신고               │
│  ├── GET    /edi-files              EDI 파일 목록               │
│  └── GET    /edi-files/:id/download EDI 파일 다운로드           │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 5.2 API 응답 표준

```go
// pkg/response/response.go

package response

// 성공 응답
type SuccessResponse struct {
    Success bool        `json:"success"`
    Data    interface{} `json:"data"`
    Meta    *Meta       `json:"meta,omitempty"`
}

// 페이지네이션 메타
type Meta struct {
    Page       int   `json:"page"`
    PerPage    int   `json:"per_page"`
    Total      int64 `json:"total"`
    TotalPages int   `json:"total_pages"`
}

// 에러 응답
type ErrorResponse struct {
    Success bool         `json:"success"`
    Error   ErrorDetail  `json:"error"`
}

type ErrorDetail struct {
    Code    string            `json:"code"`
    Message string            `json:"message"`
    Details map[string]string `json:"details,omitempty"`
}

// 에러 코드 정의
const (
    ErrCodeValidation     = "VALIDATION_ERROR"
    ErrCodeUnauthorized   = "UNAUTHORIZED"
    ErrCodeForbidden      = "FORBIDDEN"
    ErrCodeNotFound       = "NOT_FOUND"
    ErrCodeConflict       = "CONFLICT"
    ErrCodeInternal       = "INTERNAL_ERROR"
    ErrCodeBalanceError   = "BALANCE_ERROR"      // 차대변 불일치
    ErrCodePopbillError   = "POPBILL_ERROR"      // 팝빌 연동 오류
    ErrCodeEDIError       = "EDI_ERROR"          // EDI 오류
)
```

---

## 6. 개발 환경 및 명령어

### 6.1 개발 환경 설정

```bash
# 필수 도구 설치
go install github.com/cosmtrek/air@latest              # Hot Reload
go install github.com/swaggo/swag/cmd/swag@latest    # Swagger 생성
go install github.com/sqlc-dev/sqlc/cmd/sqlc@latest  # SQL → Go 생성
go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest  # 린터
go install -tags 'postgres' github.com/golang-migrate/migrate/v4/cmd/migrate@latest  # 마이그레이션
go install github.com/google/wire/cmd/wire@latest    # DI 코드 생성
```

### 6.2 Makefile

```makefile
# Makefile

.PHONY: all build run test lint migrate swagger generate clean

# 변수
APP_NAME=k-erp
GO=go
DOCKER_COMPOSE=docker-compose

# 빌드
build:
	$(GO) build -o bin/$(APP_NAME) ./cmd/api

build-worker:
	$(GO) build -o bin/$(APP_NAME)-worker ./cmd/worker

# 실행
run:
	air -c .air.toml

run-worker:
	$(GO) run ./cmd/worker

# Docker 개발환경
dev-up:
	$(DOCKER_COMPOSE) -f deployments/docker/docker-compose.yml up -d

dev-down:
	$(DOCKER_COMPOSE) -f deployments/docker/docker-compose.yml down

dev-logs:
	$(DOCKER_COMPOSE) -f deployments/docker/docker-compose.yml logs -f

# 테스트
test:
	$(GO) test -v -race -cover ./...

test-coverage:
	$(GO) test -coverprofile=coverage.out ./...
	$(GO) tool cover -html=coverage.out -o coverage.html

test-unit:
	$(GO) test -v -short ./...

test-integration:
	$(GO) test -v -run Integration ./...

# 린트
lint:
	golangci-lint run ./...

lint-fix:
	golangci-lint run --fix ./...

# 마이그레이션
migrate-up:
	migrate -path db/migrations -database "$(DATABASE_URL)" up

migrate-down:
	migrate -path db/migrations -database "$(DATABASE_URL)" down 1

migrate-create:
	@read -p "Migration name: " name; \
	migrate create -ext sql -dir db/migrations -seq $$name

migrate-force:
	@read -p "Version: " version; \
	migrate -path db/migrations -database "$(DATABASE_URL)" force $$version

# 코드 생성
generate:
	$(GO) generate ./...

swagger:
	swag init -g cmd/api/main.go -o api/openapi

sqlc:
	sqlc generate

wire:
	wire ./internal/...

# 시드 데이터
seed:
	$(GO) run ./cmd/seed

seed-accounts:
	psql "$(DATABASE_URL)" < db/seeds/accounts_kifrs.sql

# 클린
clean:
	rm -rf bin/
	rm -f coverage.out coverage.html

# 전체 초기 설정
setup: dev-up migrate-up seed
	@echo "Setup completed!"

# 도움말
help:
	@echo "Available commands:"
	@echo "  make build          - Build API server"
	@echo "  make run            - Run with hot reload"
	@echo "  make test           - Run all tests"
	@echo "  make lint           - Run linter"
	@echo "  make migrate-up     - Run migrations"
	@echo "  make swagger        - Generate Swagger docs"
	@echo "  make sqlc           - Generate sqlc code"
	@echo "  make dev-up         - Start Docker dev environment"
	@echo "  make setup          - Initial setup"
```

### 6.3 .air.toml (Hot Reload 설정)

```toml
# .air.toml

root = "."
tmp_dir = "tmp"

[build]
  cmd = "go build -o ./tmp/main ./cmd/api"
  bin = "./tmp/main"
  delay = 1000
  exclude_dir = ["assets", "tmp", "vendor", "web", "node_modules"]
  exclude_file = []
  exclude_regex = ["_test.go"]
  exclude_unchanged = false
  follow_symlink = false
  full_bin = ""
  include_dir = []
  include_ext = ["go", "tpl", "tmpl", "html"]
  kill_delay = "0s"
  log = "build-errors.log"
  send_interrupt = false
  stop_on_error = true

[color]
  build = "yellow"
  main = "magenta"
  runner = "green"
  watcher = "cyan"

[log]
  time = false

[misc]
  clean_on_exit = true
```

---

## 7. 개발 로드맵 (Go 버전)

### 7.1 전체 일정

```
┌─────────────────────────────────────────────────────────────────┐
│                    Go 기반 K-ERP 개발 로드맵                     │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  Phase 1: 프로젝트 기반 구축                                    │
│  ├── Week 1-2: 개발 환경 및 프로젝트 구조 설정                  │
│  ├── Week 3-4: 인증/인가 시스템 구현                            │
│  └── Week 5-6: 기준정보 (회사/사용자/권한) 구현                 │
│                                                                  │
│  Phase 2: 핵심 회계 시스템                                      │
│  ├── Week 7-8: 계정과목 관리                                    │
│  ├── Week 9-10: 전표 입력/관리                                  │
│  ├── Week 11-12: 원장 조회                                      │
│  └── Week 13-14: 재무제표 생성                                  │
│                                                                  │
│  Phase 3: 세금계산서 연동                                       │
│  ├── Week 15-16: Popbill SDK 연동                               │
│  ├── Week 17-18: 세금계산서 발행/수신                           │
│  └── Week 19-20: 부가세 신고 자료                               │
│                                                                  │
│  Phase 4: 인사/급여 시스템                                      │
│  ├── Week 21-22: 직원 관리                                      │
│  ├── Week 23-24: 급여 계산 엔진                                 │
│  ├── Week 25-26: 4대보험 EDI 연동                               │
│  └── Week 27-28: 원천징수/연말정산                              │
│                                                                  │
│  Phase 5: 확장 기능 및 런칭                                     │
│  ├── Week 29-30: 거래처/품목 관리                               │
│  ├── Week 31-32: 재고 관리                                      │
│  ├── Week 33-34: 대시보드/분석                                  │
│  └── Week 35-36: 모바일 앱 + 런칭 준비                          │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 7.2 Phase 1 상세 태스크

```
┌─────────────────────────────────────────────────────────────────┐
│                  Phase 1: 프로젝트 기반 구축                     │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  [Week 1-2: 개발 환경 설정]                                     │
│  □ Git 저장소 초기화 (모노레포)                                 │
│  □ Go 프로젝트 구조 생성 (위 구조도 참조)                       │
│  □ Docker Compose 개발 환경                                     │
│    - PostgreSQL 16                                               │
│    - Redis 7                                                     │
│    - MinIO                                                       │
│    - NATS                                                        │
│  □ Makefile 작성                                                │
│  □ CI/CD 파이프라인 (GitHub Actions)                            │
│    - 린트 검사                                                   │
│    - 테스트 실행                                                 │
│    - Docker 이미지 빌드                                          │
│  □ 개발 도구 설정                                               │
│    - .golangci.yml (린터 규칙)                                  │
│    - .air.toml (Hot Reload)                                     │
│    - .editorconfig                                              │
│                                                                  │
│  [Week 3-4: 인증/인가 시스템]                                   │
│  □ JWT 토큰 발행/검증 구현                                      │
│  □ Refresh Token 로직                                           │
│  □ 비밀번호 해싱 (bcrypt)                                       │
│  □ 로그인/로그아웃 API                                          │
│  □ 미들웨어 구현                                                │
│    - 인증 미들웨어 (JWT 검증)                                   │
│    - 테넌트 미들웨어 (company_id 주입)                          │
│    - RBAC 미들웨어 (권한 검사)                                  │
│    - 로깅 미들웨어                                              │
│    - Rate Limiting                                              │
│  □ 2단계 인증 (TOTP) - 선택                                    │
│                                                                  │
│  [Week 5-6: 기준정보 관리]                                      │
│  □ 마이그레이션 파일 작성                                       │
│    - companies 테이블                                           │
│    - branches 테이블                                            │
│    - users 테이블                                               │
│    - roles 테이블                                               │
│    - permissions 테이블                                         │
│  □ Domain 모델 구현                                             │
│  □ Repository 레이어 구현                                       │
│  □ Service 레이어 구현                                          │
│  □ Handler (API) 구현                                           │
│  □ Swagger 문서 생성                                            │
│  □ 단위 테스트 작성 (coverage 80%+)                             │
│                                                                  │
│  [산출물]                                                        │
│  ✓ 동작하는 Go 프로젝트 스켈레톤                                │
│  ✓ 인증/인가 완료된 API 서버                                    │
│  ✓ 회사/사용자 관리 기능                                        │
│  ✓ Swagger API 문서                                             │
│  ✓ Docker 개발 환경                                             │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 7.3 마일스톤 정의

| 마일스톤 | 완료 기준 | 기간 | 산출물 |
|----------|----------|------|--------|
| **M1: Foundation** | Phase 1 완료 | 6주 | 인증 + 기준정보 시스템 |
| **M2: Accounting** | Phase 2 완료 | 8주 | 전표/원장/재무제표 |
| **M3: Tax** | Phase 3 완료 | 6주 | 세금계산서 + 부가세 |
| **M4: HR** | Phase 4 완료 | 8주 | 급여 + 4대보험 |
| **M5: Launch** | Phase 5 완료 | 8주 | 전체 기능 + 런칭 |

---

## 8. 테스트 전략

### 8.1 테스트 구조

```
┌─────────────────────────────────────────────────────────────────┐
│                        테스트 피라미드                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│                         /\                                       │
│                        /  \                                      │
│                       / E2E \        (10%)                       │
│                      /  Test  \      Playwright                  │
│                     /──────────\                                 │
│                    /            \                                │
│                   /  Integration \   (20%)                       │
│                  /     Tests      \  testcontainers-go           │
│                 /──────────────────\                             │
│                /                    \                            │
│               /     Unit Tests       \  (70%)                    │
│              /      (Domain, Service) \ testing + testify        │
│             /──────────────────────────\                         │
│                                                                  │
│  [테스트 도구]                                                  │
│  • testing:           Go 표준 테스트                            │
│  • testify:           Assertion + Mock                          │
│  • testcontainers-go: 통합 테스트용 Docker                      │
│  • mockery:           인터페이스 Mock 생성                      │
│  • go-sqlmock:        DB Mock                                   │
│  • httptest:          HTTP 핸들러 테스트                        │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 8.2 테스트 예시

```go
// internal/service/accounting/voucher_service_test.go

package accounting_test

import (
    "testing"
    "github.com/stretchr/testify/assert"
    "github.com/stretchr/testify/mock"
    "k-erp/internal/service/accounting"
    "k-erp/internal/domain"
)

func TestVoucherService_CreateVoucher_Success(t *testing.T) {
    // Arrange
    mockRepo := new(MockVoucherRepository)
    service := accounting.NewVoucherService(mockRepo)

    input := &accounting.CreateVoucherInput{
        VoucherDate: time.Now(),
        Description: "테스트 전표",
        Lines: []accounting.VoucherLineInput{
            {AccountID: uuid.New(), DebitAmount: 100000},
            {AccountID: uuid.New(), CreditAmount: 100000},
        },
    }

    mockRepo.On("Create", mock.Anything).Return(nil)

    // Act
    voucher, err := service.CreateVoucher(context.Background(), input)

    // Assert
    assert.NoError(t, err)
    assert.NotNil(t, voucher)
    assert.True(t, voucher.IsBalanced())
    mockRepo.AssertExpectations(t)
}

func TestVoucherService_CreateVoucher_UnbalancedError(t *testing.T) {
    // Arrange
    mockRepo := new(MockVoucherRepository)
    service := accounting.NewVoucherService(mockRepo)

    input := &accounting.CreateVoucherInput{
        Lines: []accounting.VoucherLineInput{
            {AccountID: uuid.New(), DebitAmount: 100000},
            {AccountID: uuid.New(), CreditAmount: 50000},  // 불일치!
        },
    }

    // Act
    voucher, err := service.CreateVoucher(context.Background(), input)

    // Assert
    assert.Error(t, err)
    assert.Nil(t, voucher)
    assert.Equal(t, errors.ErrCodeBalanceError, err.Code)
}
```

---

## 9. 인프라 및 배포

### 9.1 Docker Compose (개발용)

```yaml
# deployments/docker/docker-compose.yml

version: '3.8'

services:
  postgres:
    image: postgres:16-alpine
    environment:
      POSTGRES_DB: kerp
      POSTGRES_USER: kerp
      POSTGRES_PASSWORD: kerp_dev_password
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U kerp"]
      interval: 5s
      timeout: 5s
      retries: 5

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data

  nats:
    image: nats:2.10-alpine
    ports:
      - "4222:4222"
      - "8222:8222"
    command: ["--jetstream", "--store_dir=/data"]
    volumes:
      - nats_data:/data

  minio:
    image: minio/minio:latest
    ports:
      - "9000:9000"
      - "9001:9001"
    environment:
      MINIO_ROOT_USER: minioadmin
      MINIO_ROOT_PASSWORD: minioadmin
    command: server /data --console-address ":9001"
    volumes:
      - minio_data:/data

  meilisearch:
    image: getmeili/meilisearch:v1.6
    ports:
      - "7700:7700"
    environment:
      MEILI_MASTER_KEY: dev_master_key
    volumes:
      - meilisearch_data:/meili_data

volumes:
  postgres_data:
  redis_data:
  nats_data:
  minio_data:
  meilisearch_data:
```

### 9.2 Kubernetes 배포 구조

```
┌─────────────────────────────────────────────────────────────────┐
│                    Kubernetes 배포 아키텍처                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                    Ingress (Traefik)                     │    │
│  │                      api.kerp.io                         │    │
│  └─────────────────────────────────────────────────────────┘    │
│                              │                                   │
│              ┌───────────────┼───────────────┐                  │
│              ▼               ▼               ▼                  │
│  ┌───────────────┐ ┌───────────────┐ ┌───────────────┐         │
│  │   API Pod     │ │   API Pod     │ │   API Pod     │         │
│  │  (Replica 3)  │ │  (Replica 3)  │ │  (Replica 3)  │         │
│  │               │ │               │ │               │         │
│  │  Go Binary    │ │  Go Binary    │ │  Go Binary    │         │
│  └───────────────┘ └───────────────┘ └───────────────┘         │
│              │               │               │                  │
│              └───────────────┼───────────────┘                  │
│                              │                                   │
│              ┌───────────────┼───────────────┐                  │
│              ▼               ▼               ▼                  │
│  ┌───────────────┐ ┌───────────────┐ ┌───────────────┐         │
│  │   Worker Pod  │ │   Worker Pod  │ │   Worker Pod  │         │
│  │  (Replica 2)  │ │  (Replica 2)  │ │  (Replica 2)  │         │
│  │               │ │               │ │               │         │
│  │  Background   │ │  EDI 처리     │ │  급여 계산    │         │
│  └───────────────┘ └───────────────┘ └───────────────┘         │
│                              │                                   │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                    External Services                     │    │
│  │                                                          │    │
│  │  PostgreSQL (RDS)  │  Redis (ElastiCache)  │  S3        │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 10. 팀 구성 제안

### 10.1 최소 팀 구성

| 역할 | 인원 | 주요 업무 |
|------|------|----------|
| **Tech Lead** | 1명 | 아키텍처 설계, 코드 리뷰, 기술 의사결정 |
| **Backend (Go)** | 2-3명 | 핵심 비즈니스 로직, API 개발 |
| **Frontend** | 1-2명 | React 웹, React Native 모바일 |
| **DevOps** | 1명 | 인프라, CI/CD, 모니터링 |
| **QA** | 1명 | 테스트 자동화, 품질 관리 |

### 10.2 Go 개발자 역량 요구사항

```
┌─────────────────────────────────────────────────────────────────┐
│                   Go 개발자 필수 역량                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  [필수]                                                          │
│  ✓ Go 기본 문법 및 관용구                                       │
│  ✓ 고루틴/채널 동시성 프로그래밍                                │
│  ✓ 인터페이스 기반 설계                                         │
│  ✓ 에러 처리 패턴                                               │
│  ✓ 테스트 작성 (table-driven tests)                            │
│  ✓ SQL (PostgreSQL)                                             │
│  ✓ REST API 설계                                                │
│                                                                  │
│  [우대]                                                          │
│  ○ Gin/Echo 프레임워크 경험                                     │
│  ○ GORM 또는 sqlx 경험                                          │
│  ○ Docker/Kubernetes 경험                                       │
│  ○ 회계/ERP 도메인 지식                                         │
│  ○ gRPC 경험                                                    │
│  ○ 마이크로서비스 아키텍처 경험                                 │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 11. 리스크 관리

| 리스크 | 영향도 | 발생확률 | 대응 방안 |
|--------|--------|----------|----------|
| Go 개발자 수급 어려움 | 높음 | 중간 | 원격 근무 허용, Go 교육 프로그램, 해외 개발자 채용 |
| 학습 곡선으로 인한 지연 | 중간 | 높음 | 충분한 온보딩 기간, 페어 프로그래밍, 코드 리뷰 강화 |
| ORM 성숙도 부족 | 중간 | 낮음 | GORM + sqlc 하이브리드 전략, Raw SQL 허용 |
| 팝빌 Go SDK 부재 | 높음 | 확정 | 직접 HTTP 클라이언트 구현, 추상화 레이어 |
| 테스트 커버리지 미달 | 중간 | 중간 | CI에서 커버리지 체크 강제, 리뷰 시 테스트 필수 |

---

**문서 버전**: 1.0
**작성일**: 2025년 1월
**작성자**: K-ERP 개발팀

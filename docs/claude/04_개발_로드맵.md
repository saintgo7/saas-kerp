# 개발 로드맵

## 1. 전체 개발 일정 개요

```
┌─────────────────────────────────────────────────────────────────┐
│                      K-ERP 개발 로드맵                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  Phase 1: 기반 구축 (6주)                                       │
│  ├── 개발환경 설정 (Go 1.22+ / Gin / GORM)                      │
│  ├── 인프라 구성 (AWS EKS)                                      │
│  ├── 인증/인가 시스템 (JWT + RBAC)                              │
│  └── 기준정보 관리                                              │
│                                                                  │
│  Phase 2: 핵심 회계 (8주)                                       │
│  ├── 계정과목 관리                                              │
│  ├── 전표 입력/관리                                             │
│  ├── 분개장/원장                                                │
│  └── 재무제표 (재무상태표, 손익계산서)                          │
│                                                                  │
│  Phase 3: 세금계산서 (6주)                                      │
│  ├── Popbill 연동                                               │
│  ├── 정발행/역발행                                              │
│  ├── 매입/매출 자동집계                                         │
│  └── 부가세 신고자료                                            │
│                                                                  │
│  Phase 4: 급여/인사 (8주)                                       │
│  ├── 직원 관리                                                  │
│  ├── 급여 계산                                                  │
│  ├── 4대보험 연동                                               │
│  └── 원천징수/연말정산                                          │
│                                                                  │
│  Phase 5: 확장 기능 (8주)                                       │
│  ├── 거래처/품목 관리                                           │
│  ├── 재고 관리                                                  │
│  ├── 경영 분석 대시보드                                         │
│  └── 모바일 앱 (React Native)                                   │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 2. Phase 1: 기반 구축

### 2.1 목표
- 안정적인 개발/운영 환경 구축
- 멀티테넌트 아키텍처 기반 마련
- 사용자 인증 및 권한 관리 시스템

### 2.2 기술 스택

| 영역 | 기술 | 버전 |
|------|------|------|
| **Backend** | Go + Gin | 1.22+ |
| **ORM/Query** | GORM + sqlc | v2 / v1 |
| **Database** | PostgreSQL | 16 |
| **Cache** | Redis | 7 |
| **Message Queue** | NATS JetStream | 2.10+ |
| **Frontend** | React + TypeScript + Vite | 18 / 5.x / 5.x |
| **UI Library** | shadcn/ui + Tailwind CSS | latest / 3.x |
| **Container** | Docker + Kubernetes | 24+ / 1.28+ |

### 2.3 태스크 목록

#### 개발 환경
- [ ] Git 저장소 구성 (모노레포)
- [ ] CI/CD 파이프라인 구축 (GitHub Actions)
- [ ] Docker 개발환경 설정 (docker-compose.yml)
- [ ] Go 린터 설정 (golangci-lint)
- [ ] React ESLint/Prettier 설정
- [ ] Air (Hot Reload) 설정

#### 인프라
- [ ] AWS 계정 및 프로젝트 설정
- [ ] EKS 클러스터 구성
- [ ] RDS PostgreSQL 인스턴스 생성
- [ ] ElastiCache Redis 구성
- [ ] S3 버킷 생성 (파일 저장)
- [ ] Route53 도메인 및 ACM SSL 인증서 설정

#### 인증/인가
- [ ] JWT 기반 인증 구현 (golang-jwt/jwt)
- [ ] Access Token + Refresh Token 구조
- [ ] 역할(Role) 및 권한(Permission) 테이블 설계
- [ ] RBAC 미들웨어 구현
- [ ] 로그인/로그아웃 API
- [ ] 비밀번호 재설정 (이메일 발송)
- [ ] 2단계 인증 (TOTP)

#### 기준정보
- [ ] 회사(Company) 모델 및 CRUD
- [ ] 사업장(Branch) 관리
- [ ] 사용자(User) 관리
- [ ] 시스템 설정 (회계연도, 통화 등)

### 2.4 데이터베이스 마이그레이션

```sql
-- db/migrations/000001_create_core_tables.up.sql

-- UUID 확장
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
CREATE EXTENSION IF NOT EXISTS "pgcrypto";

-- 회사 테이블
CREATE TABLE companies (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    business_number VARCHAR(10) NOT NULL UNIQUE,
    name VARCHAR(100) NOT NULL,
    ceo_name VARCHAR(50) NOT NULL,
    business_type VARCHAR(100),
    business_item VARCHAR(100),
    address TEXT,
    phone VARCHAR(20),
    email VARCHAR(100),
    fiscal_year_start VARCHAR(5) DEFAULT '01-01',
    currency_code VARCHAR(3) DEFAULT 'KRW',
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMPTZ
);

-- 사업장 테이블
CREATE TABLE branches (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    company_id UUID NOT NULL REFERENCES companies(id) ON DELETE CASCADE,
    code VARCHAR(10) NOT NULL,
    name VARCHAR(100) NOT NULL,
    address TEXT,
    is_headquarters BOOLEAN DEFAULT false,
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    UNIQUE (company_id, code)
);

-- 역할 테이블
CREATE TABLE roles (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    company_id UUID NOT NULL REFERENCES companies(id) ON DELETE CASCADE,
    name VARCHAR(50) NOT NULL,
    display_name VARCHAR(100) NOT NULL,
    permissions JSONB DEFAULT '[]',
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    UNIQUE (company_id, name)
);

-- 사용자 테이블
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    company_id UUID NOT NULL REFERENCES companies(id) ON DELETE CASCADE,
    role_id UUID REFERENCES roles(id),
    email VARCHAR(100) NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    name VARCHAR(50) NOT NULL,
    phone VARCHAR(20),
    is_active BOOLEAN DEFAULT true,
    last_login_at TIMESTAMPTZ,
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMPTZ,
    UNIQUE (company_id, email)
);

-- RLS 정책 활성화
ALTER TABLE branches ENABLE ROW LEVEL SECURITY;
ALTER TABLE roles ENABLE ROW LEVEL SECURITY;
ALTER TABLE users ENABLE ROW LEVEL SECURITY;

-- 인덱스
CREATE INDEX idx_companies_business_number ON companies(business_number);
CREATE INDEX idx_users_email ON users(company_id, email);
CREATE INDEX idx_users_role ON users(role_id);
```

### 2.5 Go 모델 정의

```go
// internal/domain/company.go
package domain

import (
    "time"

    "github.com/google/uuid"
    "gorm.io/gorm"
)

type Company struct {
    ID              uuid.UUID      `json:"id" gorm:"type:uuid;primaryKey;default:uuid_generate_v4()"`
    BusinessNumber  string         `json:"business_number" gorm:"type:varchar(10);uniqueIndex;not null"`
    Name            string         `json:"name" gorm:"type:varchar(100);not null"`
    CEOName         string         `json:"ceo_name" gorm:"type:varchar(50);not null"`
    BusinessType    *string        `json:"business_type" gorm:"type:varchar(100)"`
    BusinessItem    *string        `json:"business_item" gorm:"type:varchar(100)"`
    Address         *string        `json:"address" gorm:"type:text"`
    Phone           *string        `json:"phone" gorm:"type:varchar(20)"`
    Email           *string        `json:"email" gorm:"type:varchar(100)"`
    FiscalYearStart string         `json:"fiscal_year_start" gorm:"type:varchar(5);default:'01-01'"`
    CurrencyCode    string         `json:"currency_code" gorm:"type:varchar(3);default:'KRW'"`
    IsActive        bool           `json:"is_active" gorm:"default:true"`
    CreatedAt       time.Time      `json:"created_at"`
    UpdatedAt       time.Time      `json:"updated_at"`
    DeletedAt       gorm.DeletedAt `json:"-" gorm:"index"`
}

// internal/domain/user.go
type User struct {
    ID           uuid.UUID      `json:"id" gorm:"type:uuid;primaryKey;default:uuid_generate_v4()"`
    CompanyID    uuid.UUID      `json:"company_id" gorm:"type:uuid;not null;index"`
    RoleID       *uuid.UUID     `json:"role_id" gorm:"type:uuid"`
    Email        string         `json:"email" gorm:"type:varchar(100);not null"`
    PasswordHash string         `json:"-" gorm:"type:varchar(255);not null"`
    Name         string         `json:"name" gorm:"type:varchar(50);not null"`
    Phone        *string        `json:"phone" gorm:"type:varchar(20)"`
    IsActive     bool           `json:"is_active" gorm:"default:true"`
    LastLoginAt  *time.Time     `json:"last_login_at"`
    CreatedAt    time.Time      `json:"created_at"`
    UpdatedAt    time.Time      `json:"updated_at"`
    DeletedAt    gorm.DeletedAt `json:"-" gorm:"index"`

    // Relations
    Company *Company `json:"company,omitempty" gorm:"foreignKey:CompanyID"`
    Role    *Role    `json:"role,omitempty" gorm:"foreignKey:RoleID"`
}
```

### 2.6 JWT 인증 구현

```go
// internal/auth/jwt.go
package auth

import (
    "errors"
    "time"

    "github.com/golang-jwt/jwt/v5"
    "github.com/google/uuid"
)

type Claims struct {
    UserID    uuid.UUID `json:"user_id"`
    CompanyID uuid.UUID `json:"company_id"`
    Email     string    `json:"email"`
    Role      string    `json:"role"`
    jwt.RegisteredClaims
}

type JWTService struct {
    secretKey       []byte
    accessTokenTTL  time.Duration
    refreshTokenTTL time.Duration
}

func NewJWTService(secret string) *JWTService {
    return &JWTService{
        secretKey:       []byte(secret),
        accessTokenTTL:  15 * time.Minute,
        refreshTokenTTL: 7 * 24 * time.Hour,
    }
}

// Access Token 생성
func (s *JWTService) GenerateAccessToken(userID, companyID uuid.UUID, email, role string) (string, error) {
    claims := Claims{
        UserID:    userID,
        CompanyID: companyID,
        Email:     email,
        Role:      role,
        RegisteredClaims: jwt.RegisteredClaims{
            ExpiresAt: jwt.NewNumericDate(time.Now().Add(s.accessTokenTTL)),
            IssuedAt:  jwt.NewNumericDate(time.Now()),
            Issuer:    "k-erp",
        },
    }

    token := jwt.NewWithClaims(jwt.SigningMethodHS256, claims)
    return token.SignedString(s.secretKey)
}

// Token 검증
func (s *JWTService) ValidateToken(tokenString string) (*Claims, error) {
    token, err := jwt.ParseWithClaims(tokenString, &Claims{}, func(token *jwt.Token) (interface{}, error) {
        if _, ok := token.Method.(*jwt.SigningMethodHMAC); !ok {
            return nil, errors.New("invalid signing method")
        }
        return s.secretKey, nil
    })

    if err != nil {
        return nil, err
    }

    if claims, ok := token.Claims.(*Claims); ok && token.Valid {
        return claims, nil
    }

    return nil, errors.New("invalid token")
}
```

---

## 3. Phase 2: 핵심 회계

### 3.1 목표
- K-IFRS 기반 계정과목 체계 구축
- 전표 입력 및 관리 기능
- 재무제표 자동 생성

### 3.2 태스크 목록

#### 계정과목
- [ ] K-IFRS 표준 계정과목 시딩
- [ ] 계정과목 CRUD API
- [ ] 계정과목 계층 구조 (자산/부채/자본/수익/비용)
- [ ] 계정과목 검색 및 필터

#### 전표 관리
- [ ] 전표(Voucher) 모델 설계
- [ ] 전표 입력 API
- [ ] 차변/대변 자동 균형 검증
- [ ] 전표 승인 워크플로우
- [ ] 전표 취소/수정 기능
- [ ] 전표 복사 기능

#### 장부
- [ ] 분개장 조회 API (sqlc)
- [ ] 총계정원장 조회 API (sqlc)
- [ ] 계정별원장 조회 API (sqlc)
- [ ] 잔액 계산 로직

#### 재무제표
- [ ] 재무상태표 생성
- [ ] 손익계산서 생성
- [ ] 현금흐름표 생성
- [ ] 자본변동표 생성
- [ ] Excel/PDF 내보내기 (excelize, go-pdf)

### 3.3 전표 도메인 모델

```go
// internal/domain/voucher.go
package domain

import (
    "time"

    "github.com/google/uuid"
    "github.com/shopspring/decimal"
)

type VoucherStatus string

const (
    VoucherStatusDraft    VoucherStatus = "draft"
    VoucherStatusPending  VoucherStatus = "pending"
    VoucherStatusApproved VoucherStatus = "approved"
    VoucherStatusPosted   VoucherStatus = "posted"
    VoucherStatusRejected VoucherStatus = "rejected"
)

type Voucher struct {
    ID          uuid.UUID       `json:"id" gorm:"type:uuid;primaryKey"`
    CompanyID   uuid.UUID       `json:"company_id" gorm:"type:uuid;not null;index"`
    VoucherNo   string          `json:"voucher_no" gorm:"type:varchar(20);not null"`
    VoucherDate time.Time       `json:"voucher_date" gorm:"type:date;not null;index"`
    VoucherType string          `json:"voucher_type" gorm:"type:varchar(20);not null"`
    Description string          `json:"description" gorm:"type:text"`
    TotalDebit  decimal.Decimal `json:"total_debit" gorm:"type:decimal(18,2);not null"`
    TotalCredit decimal.Decimal `json:"total_credit" gorm:"type:decimal(18,2);not null"`
    Status      VoucherStatus   `json:"status" gorm:"type:varchar(20);default:'draft'"`
    CreatedBy   uuid.UUID       `json:"created_by" gorm:"type:uuid;not null"`
    ApprovedBy  *uuid.UUID      `json:"approved_by" gorm:"type:uuid"`
    ApprovedAt  *time.Time      `json:"approved_at"`
    CreatedAt   time.Time       `json:"created_at"`
    UpdatedAt   time.Time       `json:"updated_at"`

    Lines []VoucherLine `json:"lines" gorm:"foreignKey:VoucherID"`
}

type VoucherLine struct {
    ID            uuid.UUID       `json:"id" gorm:"type:uuid;primaryKey"`
    VoucherID     uuid.UUID       `json:"voucher_id" gorm:"type:uuid;not null;index"`
    LineNo        int             `json:"line_no" gorm:"not null"`
    AccountID     uuid.UUID       `json:"account_id" gorm:"type:uuid;not null"`
    DebitAmount   decimal.Decimal `json:"debit_amount" gorm:"type:decimal(18,2);default:0"`
    CreditAmount  decimal.Decimal `json:"credit_amount" gorm:"type:decimal(18,2);default:0"`
    Description   string          `json:"description" gorm:"type:varchar(200)"`
    PartnerID     *uuid.UUID      `json:"partner_id" gorm:"type:uuid"`

    Account *Account `json:"account,omitempty" gorm:"foreignKey:AccountID"`
}

// 차대변 균형 검증
func (v *Voucher) Validate() error {
    if !v.TotalDebit.Equal(v.TotalCredit) {
        return ErrUnbalancedVoucher
    }
    if v.TotalDebit.IsZero() {
        return ErrZeroAmountVoucher
    }
    return nil
}
```

### 3.4 계정과목 체계

```
┌─────────────────────────────────────────────────────────────────┐
│                     K-IFRS 계정과목 체계                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  1. 자산 (Assets)                                               │
│  ├── 11. 유동자산                                               │
│  │   ├── 111. 당좌자산                                          │
│  │   │   ├── 1111. 현금및현금성자산                             │
│  │   │   ├── 1112. 단기금융상품                                 │
│  │   │   ├── 1113. 매출채권                                     │
│  │   │   └── 1114. 미수금                                       │
│  │   └── 112. 재고자산                                          │
│  │       ├── 1121. 상품                                         │
│  │       ├── 1122. 제품                                         │
│  │       └── 1123. 원재료                                       │
│  └── 12. 비유동자산                                             │
│      ├── 121. 투자자산                                          │
│      ├── 122. 유형자산                                          │
│      └── 123. 무형자산                                          │
│                                                                  │
│  2. 부채 (Liabilities)                                          │
│  ├── 21. 유동부채                                               │
│  │   ├── 211. 매입채무                                          │
│  │   ├── 212. 단기차입금                                        │
│  │   └── 213. 미지급금                                          │
│  └── 22. 비유동부채                                             │
│                                                                  │
│  3. 자본 (Equity)                                               │
│  ├── 31. 자본금                                                 │
│  ├── 32. 자본잉여금                                             │
│  └── 33. 이익잉여금                                             │
│                                                                  │
│  4. 수익 (Revenue)                                              │
│  ├── 41. 매출                                                   │
│  └── 42. 영업외수익                                             │
│                                                                  │
│  5. 비용 (Expenses)                                             │
│  ├── 51. 매출원가                                               │
│  ├── 52. 판매비와관리비                                         │
│  └── 53. 영업외비용                                             │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 4. Phase 3: 세금계산서

### 4.1 목표
- Popbill API 연동 완료
- 전자세금계산서 발행/수신 기능
- 부가세 신고자료 자동 생성

### 4.2 태스크 목록

#### Popbill 연동
- [ ] Popbill 회원가입 및 API 키 발급
- [ ] Go HTTP 클라이언트 구현
- [ ] 연동회원 정보 등록
- [ ] 공동인증서 등록
- [ ] 포인트 충전 기능

#### 세금계산서 발행
- [ ] 정발행 기능
- [ ] 역발행 요청/승인
- [ ] 수정세금계산서 발행
- [ ] 세금계산서 취소
- [ ] 이메일 발송

#### 조회 및 관리
- [ ] 매출/매입 세금계산서 목록
- [ ] 상태별 필터링
- [ ] 기간별 검색
- [ ] 상세 조회 및 미리보기
- [ ] PDF 다운로드

#### 부가세 신고
- [ ] 과세기간별 집계 (sqlc)
- [ ] 매출/매입 합계표 생성
- [ ] 세금계산서 합계표 생성
- [ ] 홈택스 신고용 파일 생성

---

## 5. Phase 4: 급여/인사

### 5.1 목표
- 직원 정보 관리
- 급여 자동 계산
- 4대보험 EDI 연동

### 5.2 태스크 목록

#### 인사 관리
- [ ] 직원(Employee) 모델 설계
- [ ] 직원 등록/수정/퇴직 처리
- [ ] 부서/직급 관리
- [ ] 근태 관리 (선택)

#### 급여 계산
- [ ] 급여 항목 설정
- [ ] 급여 계산 엔진 (Go)
- [ ] 4대보험료 자동 계산
- [ ] 소득세/지방소득세 계산
- [ ] 급여 명세서 생성
- [ ] 급여 이체 파일 생성

#### 4대보험 연동
- [ ] 자격취득 신고서 생성
- [ ] 자격상실 신고서 생성
- [ ] 보수총액 신고서 생성
- [ ] EDI 파일 전송 (SFTP, Go)
- [ ] 처리결과 조회

#### 원천징수
- [ ] 원천징수이행상황신고서
- [ ] 간이세액표 적용
- [ ] 연말정산 기초 데이터

---

## 6. Phase 5: 확장 기능

### 6.1 목표
- 거래처/품목 관리
- 재고 관리 기능
- 경영 분석 도구

### 6.2 태스크 목록

#### 거래처 관리
- [ ] 거래처(Partner) 모델
- [ ] 매출처/매입처 구분
- [ ] 거래처별 잔액 관리
- [ ] 거래처 신용 관리

#### 품목 관리
- [ ] 품목(Product) 모델
- [ ] 품목 카테고리
- [ ] 단가 관리
- [ ] 품목별 매출/매입 분석

#### 재고 관리
- [ ] 입고/출고 처리
- [ ] 재고 실사
- [ ] 재고 평가 (선입선출, 이동평균)
- [ ] 재고 현황 리포트

#### 경영 분석
- [ ] 대시보드 UI (React + Recharts)
- [ ] 매출/매입 추이 차트
- [ ] 손익 분석
- [ ] 현금흐름 분석
- [ ] KPI 지표 관리

#### 모바일
- [ ] React Native + Expo 앱 개발
- [ ] 주요 기능 모바일 대응
- [ ] 푸시 알림 (Firebase)
- [ ] 오프라인 지원

---

## 7. 기술 부채 관리

### 7.1 코드 품질
- [ ] 테스트 커버리지 80% 이상 유지
- [ ] 정적 분석 도구 적용 (golangci-lint)
- [ ] ESLint + Prettier (Frontend)
- [ ] 코드 리뷰 필수화
- [ ] 기술 문서 작성

### 7.2 성능 최적화
- [ ] 데이터베이스 인덱스 최적화
- [ ] 쿼리 성능 모니터링 (pg_stat_statements)
- [ ] Redis 캐싱 전략 수립
- [ ] 대용량 데이터 처리 최적화 (sqlc batch)

### 7.3 보안 강화
- [ ] OWASP Top 10 점검
- [ ] 정기 보안 감사
- [ ] 침투 테스트
- [ ] Dependabot 취약점 패치 자동화

---

## 8. 마일스톤 정의

| 마일스톤 | 완료 기준 | 산출물 |
|----------|----------|--------|
| M1: MVP | Phase 1-2 완료 | 기본 회계 시스템 |
| M2: Tax | Phase 3 완료 | 세금계산서 연동 |
| M3: HR | Phase 4 완료 | 급여/인사 시스템 |
| M4: Full | Phase 5 완료 | 전체 기능 완성 |
| M5: Launch | 베타 테스트 완료 | 정식 서비스 출시 |

---

## 9. 리스크 관리

| 리스크 | 영향도 | 대응 방안 |
|--------|--------|----------|
| Popbill API 변경 | 높음 | 인터페이스 추상화 레이어 구현 |
| 4대보험 EDI 포맷 변경 | 중간 | 버전 관리, 유연한 파서 |
| 인증서 관리 | 높음 | 만료 알림, 갱신 자동화 검토 |
| 성능 이슈 | 중간 | 초기부터 k6 성능 테스트 |
| 보안 취약점 | 높음 | 정기 보안 감사, Trivy 스캔 |

---

## 10. 관련 문서

| 문서 | 설명 |
|------|------|
| [06_Go_기술스택_상세계획.md](./06_Go_기술스택_상세계획.md) | Go 기술스택 상세 |
| [11_CI_CD_파이프라인.md](./11_CI_CD_파이프라인.md) | CI/CD 설정 |
| [13_DB_스키마_상세.md](./13_DB_스키마_상세.md) | DB 스키마 상세 |
| [17_테스트_전략.md](./17_테스트_전략.md) | 테스트 전략 |

---

**문서 버전**: 2.0
**작성일**: 2025년 1월
**작성자**: K-ERP 개발팀

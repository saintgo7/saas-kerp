# 26. 규정준수 가이드 (Compliance Guide)

## 1. 개요

### 1.1 목적
K-ERP SaaS 플랫폼이 준수해야 하는 국내 법규 및 인증 요구사항을 정의하고, 이를 시스템에 반영하기 위한 가이드라인을 제시한다.

### 1.2 적용 법규 및 인증
| 분류 | 법규/인증 | 관련 모듈 | 필수 여부 |
|------|-----------|-----------|-----------|
| **정보보호** | 개인정보보호법 (PIPA) | 전체 | 필수 |
| **정보보호** | K-ISMS 인증 | 전체 | 권장 (100인 이상) |
| **금융** | 전자금융거래법 | 회계, 결제 | 조건부 필수 |
| **세무** | 국세기본법, 부가가치세법 | 세금계산서 | 필수 |
| **회계** | 상법, K-IFRS | 회계 | 필수 |
| **노동** | 근로기준법, 4대보험법 | 인사/급여 | 필수 |
| **클라우드** | 클라우드컴퓨팅법 | 전체 | 필수 |

## 2. 개인정보보호법 (PIPA) 준수

### 2.1 개인정보 처리 원칙
```yaml
privacy_principles:
  - name: 목적 제한
    description: 수집 목적 범위 내에서만 처리
    implementation:
      - 목적별 데이터 분류
      - 접근 권한 세분화

  - name: 최소 수집
    description: 필요 최소한의 정보만 수집
    implementation:
      - 필수/선택 항목 구분
      - 불필요 정보 수집 금지

  - name: 정확성
    description: 정보의 정확성, 완전성 보장
    implementation:
      - 정기 데이터 검증
      - 정보주체 확인 절차

  - name: 안전성
    description: 기술적/관리적 보호조치
    implementation:
      - 암호화, 접근통제
      - 보안 감사 로그
```

### 2.2 개인정보 분류 및 처리
```go
// internal/domain/privacy/classification.go
package privacy

type PIIClassification string

const (
    // 고유식별정보 (암호화 필수)
    PIIUniqueID PIIClassification = "unique_identifier"

    // 민감정보 (별도 동의 필요)
    PIISensitive PIIClassification = "sensitive"

    // 일반 개인정보
    PIIGeneral PIIClassification = "general"

    // 비개인정보
    PIINone PIIClassification = "none"
)

// 데이터 필드별 분류
var FieldClassifications = map[string]PIIClassification{
    // 고유식별정보 (암호화 저장)
    "resident_number":     PIIUniqueID,  // 주민등록번호
    "passport_number":     PIIUniqueID,  // 여권번호
    "driver_license":      PIIUniqueID,  // 운전면허번호
    "alien_registration":  PIIUniqueID,  // 외국인등록번호

    // 민감정보 (별도 동의)
    "health_info":         PIISensitive, // 건강정보
    "disability_grade":    PIISensitive, // 장애등급
    "political_opinion":   PIISensitive, // 정치적 견해

    // 일반 개인정보
    "name":                PIIGeneral,
    "email":               PIIGeneral,
    "phone":               PIIGeneral,
    "address":             PIIGeneral,
    "birth_date":          PIIGeneral,
    "bank_account":        PIIGeneral,

    // 비개인정보
    "company_name":        PIINone,
    "business_number":     PIINone,
}

// 암호화 요구사항 결정
func RequiresEncryption(classification PIIClassification) bool {
    return classification == PIIUniqueID
}

// 별도 동의 요구 여부
func RequiresSeparateConsent(classification PIIClassification) bool {
    return classification == PIISensitive
}
```

### 2.3 개인정보 암호화 구현
```go
// internal/infrastructure/crypto/pii_encryption.go
package crypto

import (
    "crypto/aes"
    "crypto/cipher"
    "crypto/rand"
    "encoding/base64"
    "fmt"

    "github.com/aws/aws-sdk-go-v2/service/kms"
)

// PIIEncryptor - 개인정보 암호화/복호화
type PIIEncryptor struct {
    kmsClient *kms.Client
    keyID     string
}

// Encrypt - 고유식별정보 암호화 (AES-256-GCM + KMS)
func (e *PIIEncryptor) Encrypt(ctx context.Context, plaintext string) (string, error) {
    // KMS에서 데이터 키 생성
    keyOutput, err := e.kmsClient.GenerateDataKey(ctx, &kms.GenerateDataKeyInput{
        KeyId:   &e.keyID,
        KeySpec: types.DataKeySpecAes256,
    })
    if err != nil {
        return "", fmt.Errorf("failed to generate data key: %w", err)
    }

    // AES-GCM 암호화
    block, err := aes.NewCipher(keyOutput.Plaintext)
    if err != nil {
        return "", err
    }

    gcm, err := cipher.NewGCM(block)
    if err != nil {
        return "", err
    }

    nonce := make([]byte, gcm.NonceSize())
    if _, err := rand.Read(nonce); err != nil {
        return "", err
    }

    ciphertext := gcm.Seal(nonce, nonce, []byte(plaintext), nil)

    // 암호화된 데이터 키 + 암호문 결합
    result := EncryptedData{
        EncryptedKey: base64.StdEncoding.EncodeToString(keyOutput.CiphertextBlob),
        Ciphertext:   base64.StdEncoding.EncodeToString(ciphertext),
    }

    return result.Encode(), nil
}

// Decrypt - 복호화
func (e *PIIEncryptor) Decrypt(ctx context.Context, encrypted string) (string, error) {
    data, err := DecodeEncryptedData(encrypted)
    if err != nil {
        return "", err
    }

    // KMS로 데이터 키 복호화
    encryptedKey, _ := base64.StdEncoding.DecodeString(data.EncryptedKey)
    keyOutput, err := e.kmsClient.Decrypt(ctx, &kms.DecryptInput{
        CiphertextBlob: encryptedKey,
        KeyId:          &e.keyID,
    })
    if err != nil {
        return "", fmt.Errorf("failed to decrypt data key: %w", err)
    }

    // AES-GCM 복호화
    ciphertext, _ := base64.StdEncoding.DecodeString(data.Ciphertext)

    block, err := aes.NewCipher(keyOutput.Plaintext)
    if err != nil {
        return "", err
    }

    gcm, err := cipher.NewGCM(block)
    if err != nil {
        return "", err
    }

    nonceSize := gcm.NonceSize()
    nonce, ciphertext := ciphertext[:nonceSize], ciphertext[nonceSize:]

    plaintext, err := gcm.Open(nil, nonce, ciphertext, nil)
    if err != nil {
        return "", fmt.Errorf("decryption failed: %w", err)
    }

    return string(plaintext), nil
}
```

### 2.4 개인정보 처리 동의 관리
```go
// internal/domain/consent/consent.go
package consent

import (
    "time"

    "github.com/google/uuid"
)

type ConsentType string

const (
    ConsentRequired   ConsentType = "required"    // 필수 동의
    ConsentOptional   ConsentType = "optional"    // 선택 동의
    ConsentMarketing  ConsentType = "marketing"   // 마케팅 동의
    ConsentSensitive  ConsentType = "sensitive"   // 민감정보 동의
    ConsentThirdParty ConsentType = "third_party" // 제3자 제공 동의
)

type Consent struct {
    ID          uuid.UUID   `json:"id" gorm:"type:uuid;primaryKey"`
    UserID      uuid.UUID   `json:"user_id" gorm:"type:uuid;not null"`
    CompanyID   uuid.UUID   `json:"company_id" gorm:"type:uuid;not null"`
    Type        ConsentType `json:"type" gorm:"type:varchar(50);not null"`
    Purpose     string      `json:"purpose" gorm:"type:text;not null"`
    Agreed      bool        `json:"agreed" gorm:"not null"`
    AgreedAt    *time.Time  `json:"agreed_at"`
    RevokedAt   *time.Time  `json:"revoked_at"`
    IPAddress   string      `json:"ip_address" gorm:"type:varchar(45)"`
    UserAgent   string      `json:"user_agent" gorm:"type:text"`
    Version     string      `json:"version" gorm:"type:varchar(20)"`  // 약관 버전
    CreatedAt   time.Time   `json:"created_at"`
}

// 동의 약관 템플릿
type ConsentTemplate struct {
    Type        ConsentType
    Title       string
    Description string
    Required    bool
    Version     string
}

var ConsentTemplates = []ConsentTemplate{
    {
        Type:        ConsentRequired,
        Title:       "서비스 이용약관 동의",
        Description: "K-ERP 서비스 이용을 위한 필수 약관입니다.",
        Required:    true,
        Version:     "1.0",
    },
    {
        Type:        ConsentRequired,
        Title:       "개인정보 수집 및 이용 동의",
        Description: "서비스 제공을 위한 개인정보(이름, 이메일, 연락처) 수집에 동의합니다.",
        Required:    true,
        Version:     "1.0",
    },
    {
        Type:        ConsentSensitive,
        Title:       "민감정보 수집 동의 (급여/인사)",
        Description: "급여 정산 및 4대보험 신고를 위한 주민등록번호, 계좌정보 수집에 동의합니다.",
        Required:    false,  // HR 모듈 사용 시 필요
        Version:     "1.0",
    },
    {
        Type:        ConsentThirdParty,
        Title:       "제3자 제공 동의",
        Description: "세금계산서 발행(Popbill), 4대보험 신고(공단)를 위한 정보 제공에 동의합니다.",
        Required:    false,
        Version:     "1.0",
    },
    {
        Type:        ConsentMarketing,
        Title:       "마케팅 정보 수신 동의",
        Description: "K-ERP의 신규 기능, 프로모션 정보를 이메일로 받습니다.",
        Required:    false,
        Version:     "1.0",
    },
}
```

### 2.5 개인정보 파기 정책
```go
// internal/service/privacy/data_retention.go
package privacy

import (
    "context"
    "time"
)

type RetentionPolicy struct {
    DataType       string
    RetentionYears int
    LegalBasis     string
    Action         string  // "anonymize" or "delete"
}

var RetentionPolicies = []RetentionPolicy{
    // 세법상 보존 의무 (5년)
    {
        DataType:       "tax_invoices",
        RetentionYears: 5,
        LegalBasis:     "국세기본법 제85조의3",
        Action:         "anonymize",
    },
    {
        DataType:       "vouchers",
        RetentionYears: 5,
        LegalBasis:     "상법 제33조",
        Action:         "anonymize",
    },

    // 근로기준법 보존 의무 (3년)
    {
        DataType:       "payroll_records",
        RetentionYears: 3,
        LegalBasis:     "근로기준법 제42조",
        Action:         "delete",
    },

    // 개인정보보호법 (회원 탈퇴 후 즉시 또는 1년)
    {
        DataType:       "user_pii",
        RetentionYears: 1,  // 탈퇴 후 1년
        LegalBasis:     "개인정보보호법 제21조",
        Action:         "delete",
    },

    // 로그 데이터 (1년)
    {
        DataType:       "audit_logs",
        RetentionYears: 1,
        LegalBasis:     "정보통신망법 제15조",
        Action:         "delete",
    },
}

type DataRetentionService struct {
    db        *gorm.DB
    encryptor *PIIEncryptor
}

// 개인정보 파기 실행
func (s *DataRetentionService) ExecuteRetentionPolicy(ctx context.Context) error {
    for _, policy := range RetentionPolicies {
        cutoffDate := time.Now().AddDate(-policy.RetentionYears, 0, 0)

        switch policy.Action {
        case "delete":
            if err := s.deleteExpiredData(ctx, policy.DataType, cutoffDate); err != nil {
                return err
            }
        case "anonymize":
            if err := s.anonymizeExpiredData(ctx, policy.DataType, cutoffDate); err != nil {
                return err
            }
        }

        log.Info("retention policy executed",
            "data_type", policy.DataType,
            "cutoff_date", cutoffDate,
            "action", policy.Action,
        )
    }

    return nil
}

// 익명화 처리
func (s *DataRetentionService) anonymizeExpiredData(ctx context.Context, dataType string, cutoff time.Time) error {
    switch dataType {
    case "tax_invoices":
        return s.db.WithContext(ctx).
            Model(&TaxInvoice{}).
            Where("created_at < ? AND is_anonymized = false", cutoff).
            Updates(map[string]interface{}{
                "buyer_name":      "***",
                "buyer_email":     nil,
                "buyer_phone":     nil,
                "is_anonymized":   true,
                "anonymized_at":   time.Now(),
            }).Error

    case "vouchers":
        return s.db.WithContext(ctx).
            Model(&Voucher{}).
            Where("created_at < ? AND is_anonymized = false", cutoff).
            Updates(map[string]interface{}{
                "description":     "익명화됨",
                "is_anonymized":   true,
                "anonymized_at":   time.Now(),
            }).Error
    }

    return nil
}
```

## 3. K-ISMS 인증 요구사항

### 3.1 인증 대상 판단
```yaml
isms_certification:
  mandatory_criteria:
    # 의무 대상 (하나라도 해당 시)
    - condition: "정보통신서비스 매출액 100억원 이상"
      applicable: false  # K-ERP 초기에는 미해당 예상

    - condition: "일평균 이용자 100만명 이상"
      applicable: false

    - condition: "의료, 교육, 정보통신 분야 상급종합병원/대학/ISP"
      applicable: false

  voluntary_certification:
    benefits:
      - 고객 신뢰도 향상
      - 공공기관 입찰 가점
      - 보안사고 시 책임 경감

    target_timeline: "서비스 출시 후 2년 내"
```

### 3.2 ISMS 통제 항목 구현
```go
// internal/compliance/isms/controls.go
package isms

// 1. 관리체계 수립 및 운영
type PolicyControl struct {
    ID          string
    Name        string
    Description string
    Status      ControlStatus
    Evidence    []string
}

var ISMSControls = []PolicyControl{
    // 1.1 정보보호 정책
    {
        ID:          "1.1.1",
        Name:        "정보보호 정책 수립",
        Description: "정보보호 정책 및 시행문서 수립",
        Status:      Implemented,
        Evidence:    []string{"docs/security-policy.md", "docs/claude/07_보안_설계.md"},
    },

    // 2.1 인적 보안
    {
        ID:          "2.1.1",
        Name:        "보안 서약",
        Description: "임직원 보안 서약서 징구",
        Status:      Implemented,
        Evidence:    []string{"hr/security-agreement-template.pdf"},
    },

    // 2.5 접근 통제
    {
        ID:          "2.5.1",
        Name:        "접근 통제 정책",
        Description: "사용자 접근 권한 관리 정책",
        Status:      Implemented,
        Evidence:    []string{"RBAC 구현", "최소권한원칙 적용"},
    },
    {
        ID:          "2.5.2",
        Name:        "사용자 인증",
        Description: "안전한 인증 수단 적용",
        Status:      Implemented,
        Evidence:    []string{"JWT + MFA", "비밀번호 정책"},
    },

    // 2.6 암호화
    {
        ID:          "2.6.1",
        Name:        "암호화 정책",
        Description: "중요 정보의 암호화",
        Status:      Implemented,
        Evidence:    []string{"AES-256-GCM", "TLS 1.3"},
    },

    // 2.9 보안 감사
    {
        ID:          "2.9.1",
        Name:        "감사 로그 관리",
        Description: "보안 이벤트 로그 기록 및 보관",
        Status:      Implemented,
        Evidence:    []string{"감사 로그 시스템", "1년 보관"},
    },
}

// 통제 상태 점검
func CheckControlStatus() ComplianceReport {
    var report ComplianceReport

    for _, control := range ISMSControls {
        report.Controls = append(report.Controls, ControlResult{
            ID:         control.ID,
            Name:       control.Name,
            Status:     control.Status,
            Compliant:  control.Status == Implemented,
            Evidence:   control.Evidence,
            LastAudit:  time.Now(),
        })
    }

    report.CalculateScore()
    return report
}
```

### 3.3 보안 감사 로그
```go
// internal/audit/audit_logger.go
package audit

import (
    "context"
    "encoding/json"
    "time"

    "github.com/google/uuid"
)

type AuditEventType string

const (
    AuditLogin           AuditEventType = "auth.login"
    AuditLogout          AuditEventType = "auth.logout"
    AuditLoginFailed     AuditEventType = "auth.login_failed"
    AuditPasswordChange  AuditEventType = "auth.password_change"

    AuditDataCreate      AuditEventType = "data.create"
    AuditDataRead        AuditEventType = "data.read"
    AuditDataUpdate      AuditEventType = "data.update"
    AuditDataDelete      AuditEventType = "data.delete"
    AuditDataExport      AuditEventType = "data.export"

    AuditPermissionGrant AuditEventType = "permission.grant"
    AuditPermissionRevoke AuditEventType = "permission.revoke"

    AuditSystemConfig    AuditEventType = "system.config_change"
)

type AuditLog struct {
    ID          uuid.UUID      `json:"id"`
    Timestamp   time.Time      `json:"timestamp"`
    EventType   AuditEventType `json:"event_type"`
    UserID      uuid.UUID      `json:"user_id"`
    CompanyID   uuid.UUID      `json:"company_id"`
    IPAddress   string         `json:"ip_address"`
    UserAgent   string         `json:"user_agent"`
    Resource    string         `json:"resource"`      // 대상 리소스
    ResourceID  string         `json:"resource_id"`   // 리소스 ID
    Action      string         `json:"action"`        // 수행 작업
    OldValue    json.RawMessage `json:"old_value,omitempty"`
    NewValue    json.RawMessage `json:"new_value,omitempty"`
    Result      string         `json:"result"`        // success/failure
    Details     json.RawMessage `json:"details,omitempty"`
}

type AuditLogger struct {
    writer AuditWriter
}

// 감사 이벤트 기록
func (l *AuditLogger) Log(ctx context.Context, event AuditEvent) error {
    log := AuditLog{
        ID:         uuid.New(),
        Timestamp:  time.Now().UTC(),
        EventType:  event.Type,
        UserID:     GetUserID(ctx),
        CompanyID:  GetCompanyID(ctx),
        IPAddress:  GetIPAddress(ctx),
        UserAgent:  GetUserAgent(ctx),
        Resource:   event.Resource,
        ResourceID: event.ResourceID,
        Action:     event.Action,
        Result:     event.Result,
    }

    if event.OldValue != nil {
        log.OldValue, _ = json.Marshal(event.OldValue)
    }
    if event.NewValue != nil {
        log.NewValue, _ = json.Marshal(event.NewValue)
    }

    return l.writer.Write(ctx, log)
}

// 민감 데이터 접근 감사
func (l *AuditLogger) LogSensitiveAccess(ctx context.Context, resource, resourceID, reason string) error {
    return l.Log(ctx, AuditEvent{
        Type:       AuditDataRead,
        Resource:   resource,
        ResourceID: resourceID,
        Action:     "sensitive_data_access",
        Result:     "success",
        Details: map[string]string{
            "reason": reason,
            "data_classification": "PII",
        },
    })
}
```

## 4. 세무 규정 준수

### 4.1 전자세금계산서 법적 요구사항
```go
// internal/compliance/tax/requirements.go
package tax

// 전자세금계산서 필수 기재사항 (부가가치세법 제32조)
type TaxInvoiceRequiredFields struct {
    // 공급자 정보 (필수)
    SupplierBusinessNo   string `validate:"required,len=10"`  // 사업자등록번호
    SupplierName         string `validate:"required"`         // 상호
    SupplierRepName      string `validate:"required"`         // 대표자명
    SupplierAddress      string `validate:"required"`         // 사업장 소재지

    // 공급받는자 정보 (필수)
    BuyerBusinessNo      string `validate:"required,len=10"`
    BuyerName            string `validate:"required"`
    BuyerRepName         string `validate:"required"`
    BuyerAddress         string `validate:"required"`

    // 거래 정보 (필수)
    IssueDate            time.Time `validate:"required"`      // 작성일자
    SupplyValue          int64     `validate:"required,gt=0"` // 공급가액
    TaxAmount            int64     `validate:"gte=0"`         // 세액

    // 품목 정보 (1개 이상 필수)
    Items                []TaxInvoiceItem `validate:"required,min=1,dive"`
}

// 세금계산서 발행 기한 검증
func ValidateIssuanceDeadline(supplyDate, issueDate time.Time) error {
    // 공급일이 속하는 달의 다음달 10일까지 발행 (부가가치세법 제34조)
    deadline := time.Date(
        supplyDate.Year(),
        supplyDate.Month()+2,
        10, 23, 59, 59, 0,
        time.Local,
    )

    if issueDate.After(deadline) {
        return &ComplianceError{
            Code:    "TAX_LATE_ISSUANCE",
            Message: "세금계산서 발행 기한 초과",
            LegalBasis: "부가가치세법 제34조",
            Details: map[string]interface{}{
                "supply_date": supplyDate,
                "issue_date":  issueDate,
                "deadline":    deadline,
            },
        }
    }

    return nil
}

// 수정세금계산서 발행 사유 코드
var ModificationReasons = map[string]string{
    "01": "기재사항 착오정정",
    "02": "공급가액 변동",
    "03": "환입",
    "04": "계약의 해제",
    "05": "내국신용장 사후개설",
    "06": "착오에 의한 이중발급",
}
```

### 4.2 회계 장부 보존 요구사항
```go
// internal/compliance/accounting/retention.go
package accounting

import "time"

// 상법 제33조: 10년 보존
// 국세기본법 제85조의3: 5년 보존
type BookRetentionRequirement struct {
    BookType       string
    MinRetention   int  // 년
    LegalBasis     string
    StorageFormat  string
}

var RetentionRequirements = []BookRetentionRequirement{
    {
        BookType:      "회계장부",
        MinRetention:  10,
        LegalBasis:    "상법 제33조",
        StorageFormat: "전자문서",
    },
    {
        BookType:      "재무제표",
        MinRetention:  10,
        LegalBasis:    "상법 제33조",
        StorageFormat: "전자문서",
    },
    {
        BookType:      "세금계산서",
        MinRetention:  5,
        LegalBasis:    "국세기본법 제85조의3",
        StorageFormat: "전자문서",
    },
    {
        BookType:      "증빙서류",
        MinRetention:  5,
        LegalBasis:    "국세기본법 제85조의3",
        StorageFormat: "전자문서/스캔",
    },
}

// 회계연도 마감 검증
type FiscalYearClosing struct {
    CompanyID     uuid.UUID
    FiscalYear    int
    ClosingDate   time.Time
    Status        ClosingStatus
    Checklist     []ClosingCheckItem
}

type ClosingCheckItem struct {
    Item       string
    Required   bool
    Completed  bool
    Evidence   string
}

var ClosingChecklist = []ClosingCheckItem{
    {Item: "모든 전표 승인 완료", Required: true},
    {Item: "미결 거래 정리", Required: true},
    {Item: "재고 실사 완료", Required: true},
    {Item: "감가상각 계상", Required: true},
    {Item: "대손충당금 설정", Required: true},
    {Item: "결산 조정 전표 입력", Required: true},
    {Item: "차대변 균형 검증", Required: true},
    {Item: "재무제표 생성", Required: true},
    {Item: "외부 감사 검토", Required: false},
}
```

## 5. 근로 관련 법규 준수

### 5.1 급여 계산 법적 요구사항
```go
// internal/compliance/labor/payroll.go
package labor

import (
    "time"

    "github.com/shopspring/decimal"
)

// 2025년 기준 (매년 업데이트 필요)
var LaborLawConstants = struct {
    MinimumWageHourly    decimal.Decimal // 최저시급
    MinimumWageMonthly   decimal.Decimal // 최저월급 (209시간 기준)
    MaxOvertimeHours     int             // 주 최대 연장근로
    WeeklyHolidayHours   int             // 주휴시간
    AnnualLeaveBaseYear  int             // 연차 기준 근속년수
}{
    MinimumWageHourly:   decimal.NewFromInt(10030),    // 2025년 예상
    MinimumWageMonthly:  decimal.NewFromInt(2096270),  // 209시간 기준
    MaxOvertimeHours:    12,                           // 주 12시간
    WeeklyHolidayHours:  8,                            // 주휴 8시간
    AnnualLeaveBaseYear: 1,
}

// 최저임금 준수 검증
func ValidateMinimumWage(monthlySalary decimal.Decimal, monthlyHours int) error {
    if monthlyHours == 0 {
        monthlyHours = 209 // 기본값
    }

    hourlyWage := monthlySalary.Div(decimal.NewFromInt(int64(monthlyHours)))

    if hourlyWage.LessThan(LaborLawConstants.MinimumWageHourly) {
        return &ComplianceError{
            Code:       "LABOR_MINIMUM_WAGE",
            Message:    "최저임금 미달",
            LegalBasis: "최저임금법 제6조",
            Details: map[string]interface{}{
                "calculated_hourly": hourlyWage.String(),
                "minimum_hourly":    LaborLawConstants.MinimumWageHourly.String(),
            },
        }
    }

    return nil
}

// 연장근로수당 계산 (통상임금 * 1.5)
func CalculateOvertimePay(baseWage decimal.Decimal, overtimeHours decimal.Decimal) decimal.Decimal {
    rate := decimal.NewFromFloat(1.5)
    return baseWage.Mul(overtimeHours).Mul(rate)
}

// 야간근로수당 계산 (22:00 ~ 06:00, 통상임금 * 0.5 가산)
func CalculateNightShiftPay(baseWage decimal.Decimal, nightHours decimal.Decimal) decimal.Decimal {
    rate := decimal.NewFromFloat(0.5)
    return baseWage.Mul(nightHours).Mul(rate)
}

// 연차 계산 (근로기준법 제60조)
func CalculateAnnualLeave(hireDate time.Time, referenceDate time.Time) int {
    tenure := referenceDate.Sub(hireDate)
    years := int(tenure.Hours() / 24 / 365)

    if years < 1 {
        // 1년 미만: 월 1일씩 (최대 11일)
        months := int(tenure.Hours() / 24 / 30)
        if months > 11 {
            months = 11
        }
        return months
    }

    // 1년 이상: 15일 + 2년마다 1일 추가 (최대 25일)
    additionalDays := (years - 1) / 2
    totalDays := 15 + additionalDays

    if totalDays > 25 {
        totalDays = 25
    }

    return totalDays
}
```

### 5.2 4대보험 신고 요구사항
```go
// internal/compliance/labor/insurance.go
package labor

import "time"

// 4대보험 요율 (2025년 예상, 매년 변경)
var InsuranceRates = struct {
    NationalPension    InsuranceRate  // 국민연금
    HealthInsurance    InsuranceRate  // 건강보험
    LongTermCare       InsuranceRate  // 장기요양보험
    Employment         InsuranceRate  // 고용보험
    IndustrialAccident InsuranceRate  // 산재보험
}{
    NationalPension: InsuranceRate{
        Employee: decimal.NewFromFloat(0.045),  // 4.5%
        Employer: decimal.NewFromFloat(0.045),  // 4.5%
    },
    HealthInsurance: InsuranceRate{
        Employee: decimal.NewFromFloat(0.0354), // 3.54%
        Employer: decimal.NewFromFloat(0.0354), // 3.54%
    },
    LongTermCare: InsuranceRate{
        Employee: decimal.NewFromFloat(0.1295), // 건보료의 12.95%
        Employer: decimal.NewFromFloat(0.1295),
    },
    Employment: InsuranceRate{
        Employee: decimal.NewFromFloat(0.009),  // 0.9%
        Employer: decimal.NewFromFloat(0.0115), // 1.15% (150인 미만)
    },
    IndustrialAccident: InsuranceRate{
        Employee: decimal.NewFromFloat(0),      // 근로자 부담 없음
        Employer: decimal.NewFromFloat(0.007),  // 업종별 상이 (평균 0.7%)
    },
}

// EDI 신고 기한
type InsuranceReportDeadline struct {
    Type         string
    ReportType   string
    Deadline     string  // 매월 기준
    LegalBasis   string
}

var ReportDeadlines = []InsuranceReportDeadline{
    {
        Type:       "national_pension",
        ReportType: "월별 납부",
        Deadline:   "익월 10일",
        LegalBasis: "국민연금법 제89조",
    },
    {
        Type:       "health_insurance",
        ReportType: "월별 납부",
        Deadline:   "익월 10일",
        LegalBasis: "국민건강보험법 제79조",
    },
    {
        Type:       "employment",
        ReportType: "월별 납부",
        Deadline:   "익월 10일",
        LegalBasis: "고용보험법 제16조",
    },
    {
        Type:       "year_end_settlement",
        ReportType: "연말정산",
        Deadline:   "2월 말",
        LegalBasis: "소득세법 제137조",
    },
}
```

## 6. 규정 준수 모니터링

### 6.1 자동 준수 검사
```go
// internal/compliance/checker.go
package compliance

import (
    "context"
    "time"
)

type ComplianceChecker struct {
    pipaChecker      *PIPAChecker
    taxChecker       *TaxComplianceChecker
    laborChecker     *LaborComplianceChecker
    accountingChecker *AccountingComplianceChecker
}

type ComplianceResult struct {
    CheckedAt    time.Time
    Domain       string
    Status       ComplianceStatus  // compliant, warning, violation
    Issues       []ComplianceIssue
    Score        float64           // 0-100
}

type ComplianceIssue struct {
    Code        string
    Severity    string  // low, medium, high, critical
    Description string
    LegalBasis  string
    Remediation string
    Deadline    *time.Time
}

// 전체 규정 준수 점검
func (c *ComplianceChecker) RunFullCheck(ctx context.Context, companyID uuid.UUID) (*ComplianceReport, error) {
    report := &ComplianceReport{
        CompanyID: companyID,
        CheckedAt: time.Now(),
        Results:   make([]ComplianceResult, 0),
    }

    // 개인정보보호법 점검
    pipaResult, err := c.pipaChecker.Check(ctx, companyID)
    if err != nil {
        return nil, fmt.Errorf("PIPA check failed: %w", err)
    }
    report.Results = append(report.Results, pipaResult)

    // 세무 규정 점검
    taxResult, err := c.taxChecker.Check(ctx, companyID)
    if err != nil {
        return nil, fmt.Errorf("tax compliance check failed: %w", err)
    }
    report.Results = append(report.Results, taxResult)

    // 근로 규정 점검
    laborResult, err := c.laborChecker.Check(ctx, companyID)
    if err != nil {
        return nil, fmt.Errorf("labor compliance check failed: %w", err)
    }
    report.Results = append(report.Results, laborResult)

    // 회계 규정 점검
    accountingResult, err := c.accountingChecker.Check(ctx, companyID)
    if err != nil {
        return nil, fmt.Errorf("accounting compliance check failed: %w", err)
    }
    report.Results = append(report.Results, accountingResult)

    report.CalculateOverallScore()
    return report, nil
}

// 위반 알림 발송
func (c *ComplianceChecker) NotifyViolations(ctx context.Context, report *ComplianceReport) error {
    for _, result := range report.Results {
        for _, issue := range result.Issues {
            if issue.Severity == "critical" || issue.Severity == "high" {
                // 즉시 알림
                c.notifier.SendAlert(ctx, ComplianceAlert{
                    CompanyID:   report.CompanyID,
                    Issue:       issue,
                    RequireACK:  true,
                })
            }
        }
    }

    return nil
}
```

### 6.2 규정 준수 대시보드
```typescript
// web/src/components/compliance/ComplianceDashboard.tsx
import React from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Progress } from '@/components/ui/progress';
import { Badge } from '@/components/ui/badge';
import { AlertTriangle, CheckCircle, XCircle } from 'lucide-react';

interface ComplianceScore {
  domain: string;
  score: number;
  status: 'compliant' | 'warning' | 'violation';
  issues: number;
}

const ComplianceDashboard: React.FC = () => {
  const scores: ComplianceScore[] = [
    { domain: '개인정보보호', score: 95, status: 'compliant', issues: 0 },
    { domain: '세무', score: 88, status: 'warning', issues: 2 },
    { domain: '근로', score: 100, status: 'compliant', issues: 0 },
    { domain: '회계', score: 92, status: 'compliant', issues: 1 },
  ];

  const getStatusIcon = (status: string) => {
    switch (status) {
      case 'compliant':
        return <CheckCircle className="h-5 w-5 text-green-500" />;
      case 'warning':
        return <AlertTriangle className="h-5 w-5 text-yellow-500" />;
      case 'violation':
        return <XCircle className="h-5 w-5 text-red-500" />;
    }
  };

  const getStatusBadge = (status: string) => {
    const variants = {
      compliant: 'default',
      warning: 'warning',
      violation: 'destructive',
    } as const;

    const labels = {
      compliant: '준수',
      warning: '주의',
      violation: '위반',
    };

    return (
      <Badge variant={variants[status as keyof typeof variants]}>
        {labels[status as keyof typeof labels]}
      </Badge>
    );
  };

  return (
    <div className="space-y-6">
      <h2 className="text-2xl font-bold">규정 준수 현황</h2>

      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        {scores.map((item) => (
          <Card key={item.domain}>
            <CardHeader className="flex flex-row items-center justify-between pb-2">
              <CardTitle className="text-sm font-medium">
                {item.domain}
              </CardTitle>
              {getStatusIcon(item.status)}
            </CardHeader>
            <CardContent>
              <div className="text-2xl font-bold">{item.score}%</div>
              <Progress value={item.score} className="mt-2" />
              <div className="flex justify-between items-center mt-2">
                {getStatusBadge(item.status)}
                <span className="text-sm text-muted-foreground">
                  {item.issues > 0 ? `${item.issues}건 조치 필요` : '문제 없음'}
                </span>
              </div>
            </CardContent>
          </Card>
        ))}
      </div>

      {/* 최근 이슈 목록 */}
      <Card>
        <CardHeader>
          <CardTitle>최근 규정 준수 이슈</CardTitle>
        </CardHeader>
        <CardContent>
          <div className="space-y-4">
            <div className="flex items-center gap-4 p-3 border rounded-lg">
              <AlertTriangle className="h-5 w-5 text-yellow-500" />
              <div className="flex-1">
                <p className="font-medium">세금계산서 발행 기한 임박</p>
                <p className="text-sm text-muted-foreground">
                  3건의 세금계산서가 발행 기한(익월 10일)이 다가옵니다.
                </p>
              </div>
              <Badge variant="warning">경고</Badge>
            </div>
            <div className="flex items-center gap-4 p-3 border rounded-lg">
              <CheckCircle className="h-5 w-5 text-green-500" />
              <div className="flex-1">
                <p className="font-medium">4대보험 신고 완료</p>
                <p className="text-sm text-muted-foreground">
                  2025년 1월 4대보험 EDI 신고가 완료되었습니다.
                </p>
              </div>
              <Badge>완료</Badge>
            </div>
          </div>
        </CardContent>
      </Card>
    </div>
  );
};

export default ComplianceDashboard;
```

## 7. 관련 문서

| 문서 | 설명 |
|------|------|
| [07_보안_설계.md](./07_보안_설계.md) | 보안 아키텍처 |
| [02_세금계산서_연동_설계.md](./02_세금계산서_연동_설계.md) | 세금계산서 연동 |
| [03_4대보험_EDI_연동.md](./03_4대보험_EDI_연동.md) | 4대보험 EDI |
| [25_재해복구_계획.md](./25_재해복구_계획.md) | 재해복구 |

---

*문서 버전: 1.0.0*
*최종 수정: 2025년 1월*
*작성자: K-ERP 개발팀*
*법률 검토: 법무팀*

# 23. 코딩 컨벤션 상세 가이드

## 개요

K-ERP 프로젝트의 코드 품질과 일관성을 유지하기 위한 상세 코딩 컨벤션.
Go 백엔드 및 React/TypeScript 프론트엔드 코딩 표준.

---

## 1. Go 백엔드 컨벤션

### 1.1 파일/패키지 명명 규칙

```
✅ Good
internal/
├── domain/
│   ├── voucher.go           # 도메인 모델
│   ├── voucher_status.go    # 관련 타입
│   └── voucher_test.go      # 테스트
├── service/
│   ├── voucher_service.go   # 서비스 구현
│   └── voucher_service_test.go
├── repository/
│   └── voucher_repo.go      # 레포지토리
└── handler/
    └── voucher_handler.go   # HTTP 핸들러

❌ Bad
internal/
├── domain/
│   ├── Voucher.go           # 대문자 시작 X
│   ├── voucherModel.go      # camelCase X
│   └── voucher-model.go     # kebab-case X
```

### 1.2 구조체 및 타입 정의

```go
// ✅ Good: 명확한 구조체 정의
type Voucher struct {
    ID          uuid.UUID       `json:"id" gorm:"type:uuid;primary_key;default:uuid_generate_v4()"`
    CompanyID   uuid.UUID       `json:"company_id" gorm:"type:uuid;not null;index"`
    VoucherNo   string          `json:"voucher_no" gorm:"type:varchar(20);not null"`
    VoucherDate time.Time       `json:"voucher_date" gorm:"type:date;not null"`
    VoucherType VoucherType     `json:"voucher_type" gorm:"type:varchar(20);not null;default:'general'"`
    Description string          `json:"description" gorm:"type:text"`
    Status      VoucherStatus   `json:"status" gorm:"type:varchar(20);not null;default:'draft'"`
    TotalDebit  decimal.Decimal `json:"total_debit" gorm:"type:numeric(18,2);not null;default:0"`
    TotalCredit decimal.Decimal `json:"total_credit" gorm:"type:numeric(18,2);not null;default:0"`

    // 관계
    Lines []VoucherLine `json:"lines,omitempty" gorm:"foreignKey:VoucherID;constraint:OnDelete:CASCADE"`

    // 감사 필드
    CreatedBy *uuid.UUID `json:"created_by,omitempty" gorm:"type:uuid"`
    ApprovedBy *uuid.UUID `json:"approved_by,omitempty" gorm:"type:uuid"`
    ApprovedAt *time.Time `json:"approved_at,omitempty"`

    // 타임스탬프
    CreatedAt time.Time  `json:"created_at" gorm:"not null;default:CURRENT_TIMESTAMP"`
    UpdatedAt time.Time  `json:"updated_at" gorm:"not null;default:CURRENT_TIMESTAMP"`
    DeletedAt *time.Time `json:"deleted_at,omitempty" gorm:"index"`
}

// 타입 정의는 별도 파일 또는 상단에
type VoucherType string

const (
    VoucherTypeGeneral  VoucherType = "general"
    VoucherTypePurchase VoucherType = "purchase"
    VoucherTypeSales    VoucherType = "sales"
    VoucherTypePayment  VoucherType = "payment"
    VoucherTypeReceipt  VoucherType = "receipt"
)

func (t VoucherType) IsValid() bool {
    switch t {
    case VoucherTypeGeneral, VoucherTypePurchase, VoucherTypeSales,
         VoucherTypePayment, VoucherTypeReceipt:
        return true
    }
    return false
}
```

### 1.3 인터페이스 정의

```go
// ✅ Good: 소비자 측에서 인터페이스 정의
// internal/service/voucher_service.go

// VoucherRepository 전표 저장소 인터페이스 (서비스에서 정의)
type VoucherRepository interface {
    Create(ctx context.Context, voucher *domain.Voucher) error
    FindByID(ctx context.Context, id uuid.UUID) (*domain.Voucher, error)
    FindByCompany(ctx context.Context, companyID uuid.UUID, filter VoucherFilter) ([]domain.Voucher, int64, error)
    Update(ctx context.Context, voucher *domain.Voucher) error
    Delete(ctx context.Context, id uuid.UUID) error
}

// VoucherService 전표 서비스
type VoucherService struct {
    repo   VoucherRepository
    cache  CacheRepository
    events EventPublisher
}

// ❌ Bad: 구현체 측에서 모든 인터페이스 정의
// internal/repository/interfaces.go (사용하지 않는 메서드까지 포함)
```

### 1.4 함수/메서드 시그니처

```go
// ✅ Good: 컨텍스트 첫 번째, 에러 마지막
func (s *VoucherService) CreateVoucher(ctx context.Context, input *CreateVoucherInput) (*domain.Voucher, error) {
    // ...
}

// ✅ Good: 옵션 패턴
type FindOptions struct {
    Limit      int
    Offset     int
    SortBy     string
    SortOrder  string
    IncludeDeleted bool
}

func (r *VoucherRepository) FindByCompany(ctx context.Context, companyID uuid.UUID, opts *FindOptions) ([]domain.Voucher, error) {
    // ...
}

// ❌ Bad: 컨텍스트가 중간에
func (s *VoucherService) CreateVoucher(input *CreateVoucherInput, ctx context.Context) (*domain.Voucher, error)

// ❌ Bad: 파라미터 과다
func (s *VoucherService) FindVouchers(ctx context.Context, companyID uuid.UUID, startDate, endDate time.Time, status string, voucherType string, limit, offset int, sortBy, sortOrder string) ([]domain.Voucher, error)
```

### 1.5 에러 처리

```go
// ✅ Good: 에러 래핑으로 컨텍스트 추가
func (s *VoucherService) CreateVoucher(ctx context.Context, input *CreateVoucherInput) (*domain.Voucher, error) {
    voucher := input.ToVoucher()

    if err := voucher.Validate(); err != nil {
        return nil, fmt.Errorf("voucher validation failed: %w", err)
    }

    if err := s.repo.Create(ctx, voucher); err != nil {
        return nil, fmt.Errorf("failed to create voucher: %w", err)
    }

    return voucher, nil
}

// ✅ Good: 센티널 에러 정의
var (
    ErrVoucherNotFound     = errors.New("voucher not found")
    ErrVoucherUnbalanced   = errors.New("voucher is not balanced")
    ErrPeriodClosed        = errors.New("accounting period is closed")
)

// ✅ Good: 에러 타입 검사
func (h *VoucherHandler) GetVoucher(c *gin.Context) {
    voucher, err := h.service.GetVoucher(ctx, id)
    if err != nil {
        if errors.Is(err, service.ErrVoucherNotFound) {
            c.JSON(http.StatusNotFound, gin.H{"error": "Voucher not found"})
            return
        }
        c.JSON(http.StatusInternalServerError, gin.H{"error": "Internal error"})
        return
    }
    c.JSON(http.StatusOK, voucher)
}

// ❌ Bad: 에러 무시
result, _ := s.repo.Create(ctx, voucher)

// ❌ Bad: 에러 메시지만 비교
if err.Error() == "voucher not found" {
    // ...
}
```

### 1.6 테스트 컨벤션

```go
// ✅ Good: 테이블 드리븐 테스트
func TestVoucher_Validate(t *testing.T) {
    tests := []struct {
        name        string
        voucher     *domain.Voucher
        wantErr     bool
        errContains string
    }{
        {
            name: "valid_balanced_voucher",
            voucher: &domain.Voucher{
                Lines: []domain.VoucherLine{
                    {DebitAmount: decimal.NewFromInt(100000), CreditAmount: decimal.Zero},
                    {DebitAmount: decimal.Zero, CreditAmount: decimal.NewFromInt(100000)},
                },
            },
            wantErr: false,
        },
        {
            name: "invalid_unbalanced_voucher",
            voucher: &domain.Voucher{
                Lines: []domain.VoucherLine{
                    {DebitAmount: decimal.NewFromInt(100000), CreditAmount: decimal.Zero},
                },
            },
            wantErr:     true,
            errContains: "not balanced",
        },
        {
            name: "invalid_empty_lines",
            voucher: &domain.Voucher{
                Lines: []domain.VoucherLine{},
            },
            wantErr:     true,
            errContains: "at least one line",
        },
    }

    for _, tt := range tests {
        t.Run(tt.name, func(t *testing.T) {
            err := tt.voucher.Validate()

            if tt.wantErr {
                require.Error(t, err)
                assert.Contains(t, err.Error(), tt.errContains)
            } else {
                require.NoError(t, err)
            }
        })
    }
}

// ✅ Good: 서브테스트 사용
func TestVoucherService(t *testing.T) {
    t.Run("CreateVoucher", func(t *testing.T) {
        t.Run("success", func(t *testing.T) {
            // ...
        })
        t.Run("validation_error", func(t *testing.T) {
            // ...
        })
    })

    t.Run("UpdateVoucher", func(t *testing.T) {
        // ...
    })
}
```

---

## 2. React/TypeScript 프론트엔드 컨벤션

### 2.1 파일/디렉토리 구조

```
web/src/
├── components/              # 재사용 가능한 컴포넌트
│   ├── ui/                 # shadcn/ui 컴포넌트
│   │   ├── button.tsx
│   │   └── input.tsx
│   ├── voucher/            # 도메인별 컴포넌트
│   │   ├── VoucherForm.tsx
│   │   ├── VoucherTable.tsx
│   │   └── index.ts        # barrel export
│   └── layout/
│       ├── Sidebar.tsx
│       └── Header.tsx
├── pages/                   # 페이지 컴포넌트
│   ├── accounting/
│   │   ├── VoucherListPage.tsx
│   │   └── VoucherEditPage.tsx
│   └── dashboard/
│       └── DashboardPage.tsx
├── hooks/                   # 커스텀 훅
│   ├── useVouchers.ts
│   └── useAuth.ts
├── lib/                     # 유틸리티
│   ├── api/
│   │   ├── client.ts
│   │   └── vouchers.ts
│   └── utils.ts
├── types/                   # 타입 정의
│   ├── voucher.ts
│   └── api.ts
└── stores/                  # 상태 관리
    └── authStore.ts
```

### 2.2 컴포넌트 작성

```tsx
// ✅ Good: 함수형 컴포넌트 + TypeScript
// components/voucher/VoucherForm.tsx

import { useForm } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import { z } from 'zod'
import { Button } from '@/components/ui/button'
import { Form, FormField, FormItem, FormLabel, FormControl, FormMessage } from '@/components/ui/form'

// Props 타입 정의
interface VoucherFormProps {
  initialData?: Voucher
  onSubmit: (data: VoucherFormData) => Promise<void>
  onCancel?: () => void
  isLoading?: boolean
}

// 폼 스키마
const voucherFormSchema = z.object({
  voucherDate: z.string().min(1, '전표일자를 입력하세요'),
  voucherType: z.enum(['general', 'purchase', 'sales', 'payment', 'receipt']),
  description: z.string().max(500, '적요는 500자 이내로 입력하세요').optional(),
  lines: z.array(z.object({
    accountCode: z.string().min(1, '계정과목을 선택하세요'),
    debitAmount: z.number().min(0),
    creditAmount: z.number().min(0),
  })).min(1, '최소 1개 이상의 라인이 필요합니다'),
})

type VoucherFormData = z.infer<typeof voucherFormSchema>

// 컴포넌트
export function VoucherForm({
  initialData,
  onSubmit,
  onCancel,
  isLoading = false,
}: VoucherFormProps) {
  const form = useForm<VoucherFormData>({
    resolver: zodResolver(voucherFormSchema),
    defaultValues: initialData ?? {
      voucherDate: new Date().toISOString().split('T')[0],
      voucherType: 'general',
      description: '',
      lines: [
        { accountCode: '', debitAmount: 0, creditAmount: 0 },
        { accountCode: '', debitAmount: 0, creditAmount: 0 },
      ],
    },
  })

  const handleSubmit = async (data: VoucherFormData) => {
    try {
      await onSubmit(data)
    } catch (error) {
      // 에러 처리는 상위에서
    }
  }

  return (
    <Form {...form}>
      <form onSubmit={form.handleSubmit(handleSubmit)} className="space-y-4">
        <FormField
          control={form.control}
          name="voucherDate"
          render={({ field }) => (
            <FormItem>
              <FormLabel>전표일자</FormLabel>
              <FormControl>
                <Input type="date" {...field} />
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />

        {/* 나머지 필드... */}

        <div className="flex justify-end gap-2">
          {onCancel && (
            <Button type="button" variant="outline" onClick={onCancel}>
              취소
            </Button>
          )}
          <Button type="submit" disabled={isLoading}>
            {isLoading ? '저장 중...' : '저장'}
          </Button>
        </div>
      </form>
    </Form>
  )
}

// ❌ Bad: any 타입 사용
function VoucherForm({ data }: any) { ... }

// ❌ Bad: 인라인 타입 정의
function VoucherForm({ data }: { data: { id: string, name: string } }) { ... }
```

### 2.3 커스텀 훅

```tsx
// ✅ Good: 단일 책임 원칙
// hooks/useVouchers.ts

import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'
import { getVouchers, createVoucher, updateVoucher, deleteVoucher } from '@/lib/api/vouchers'
import type { Voucher, VoucherFilter, CreateVoucherInput } from '@/types/voucher'

// 목록 조회
export function useVouchers(filter?: VoucherFilter) {
  return useQuery({
    queryKey: ['vouchers', filter],
    queryFn: () => getVouchers(filter),
    staleTime: 5 * 60 * 1000, // 5분
  })
}

// 단건 조회
export function useVoucher(id: string) {
  return useQuery({
    queryKey: ['vouchers', id],
    queryFn: () => getVoucherById(id),
    enabled: !!id,
  })
}

// 생성
export function useCreateVoucher() {
  const queryClient = useQueryClient()

  return useMutation({
    mutationFn: (input: CreateVoucherInput) => createVoucher(input),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['vouchers'] })
    },
  })
}

// 수정
export function useUpdateVoucher() {
  const queryClient = useQueryClient()

  return useMutation({
    mutationFn: ({ id, data }: { id: string; data: UpdateVoucherInput }) =>
      updateVoucher(id, data),
    onSuccess: (_, { id }) => {
      queryClient.invalidateQueries({ queryKey: ['vouchers'] })
      queryClient.invalidateQueries({ queryKey: ['vouchers', id] })
    },
  })
}

// 삭제
export function useDeleteVoucher() {
  const queryClient = useQueryClient()

  return useMutation({
    mutationFn: (id: string) => deleteVoucher(id),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['vouchers'] })
    },
  })
}
```

### 2.4 타입 정의

```tsx
// ✅ Good: 명확한 타입 정의
// types/voucher.ts

export interface Voucher {
  id: string
  companyId: string
  voucherNo: string
  voucherDate: string
  voucherType: VoucherType
  description?: string
  status: VoucherStatus
  totalDebit: number
  totalCredit: number
  lines: VoucherLine[]
  createdAt: string
  updatedAt: string
}

export type VoucherType = 'general' | 'purchase' | 'sales' | 'payment' | 'receipt'
export type VoucherStatus = 'draft' | 'pending' | 'approved' | 'rejected'

export interface VoucherLine {
  id: string
  voucherId: string
  lineNo: number
  accountCode: string
  accountName?: string
  debitAmount: number
  creditAmount: number
  description?: string
}

export interface VoucherFilter {
  startDate?: string
  endDate?: string
  status?: VoucherStatus
  voucherType?: VoucherType
  search?: string
  page?: number
  limit?: number
}

export interface CreateVoucherInput {
  voucherDate: string
  voucherType: VoucherType
  description?: string
  lines: Omit<VoucherLine, 'id' | 'voucherId'>[]
}

export interface UpdateVoucherInput extends Partial<CreateVoucherInput> {}

// API 응답 타입
export interface PaginatedResponse<T> {
  data: T[]
  meta: {
    total: number
    page: number
    limit: number
    totalPages: number
  }
}

// ❌ Bad: any 타입
export interface Voucher {
  lines: any[]
}

// ❌ Bad: 중복 타입 정의
export interface CreateVoucher {
  voucherDate: string
  voucherType: string // VoucherType 대신 string
}
```

### 2.5 스타일 컨벤션 (Tailwind CSS)

```tsx
// ✅ Good: 일관된 클래스 순서
// 레이아웃 → 크기 → 간격 → 색상 → 기타
<div className="flex flex-col w-full max-w-md p-4 space-y-4 bg-white rounded-lg shadow-md">
  <h2 className="text-xl font-semibold text-gray-900">제목</h2>
  <p className="text-sm text-gray-500">설명</p>
</div>

// ✅ Good: cn() 유틸리티로 조건부 클래스
import { cn } from '@/lib/utils'

<Button
  className={cn(
    'w-full',
    variant === 'destructive' && 'bg-red-500 hover:bg-red-600',
    disabled && 'opacity-50 cursor-not-allowed'
  )}
>

// ✅ Good: 반복되는 스타일은 컴포넌트화
// components/ui/card.tsx
export function Card({ className, ...props }: CardProps) {
  return (
    <div
      className={cn('rounded-lg border bg-card p-6 shadow-sm', className)}
      {...props}
    />
  )
}

// ❌ Bad: 인라인 스타일
<div style={{ padding: '16px', backgroundColor: 'white' }}>

// ❌ Bad: 클래스 순서 무작위
<div className="shadow-md p-4 bg-white flex rounded-lg max-w-md flex-col w-full space-y-4">
```

---

## 3. 공통 컨벤션

### 3.1 Git 커밋 메시지

```bash
# 커밋 메시지 형식
<type>(<scope>): <subject>

<body>

<footer>

# type
feat:     새로운 기능
fix:      버그 수정
docs:     문서 변경
style:    코드 포맷팅 (기능 변경 없음)
refactor: 리팩토링 (기능 변경 없음)
test:     테스트 추가/수정
chore:    빌드, 설정 변경

# 예시
feat(accounting): 전표 일괄 승인 기능 추가

- 다중 선택 UI 구현
- 일괄 승인 API 연동
- 승인 결과 토스트 메시지 표시

Closes #123

# ❌ Bad
fix bugs
update code
wip
```

### 3.2 브랜치 명명 규칙

```bash
# 형식
<type>/<ticket-id>-<short-description>

# 예시
feature/ACC-123-voucher-batch-approval
bugfix/HR-456-payroll-calculation-error
hotfix/critical-login-issue
release/v1.2.0

# ❌ Bad
my-feature
fix
test-branch
```

### 3.3 환경 변수

```bash
# ✅ Good: 명확한 prefix와 설명
# Backend (.env)
KERP_ENV=production
KERP_DB_HOST=localhost
KERP_DB_PORT=5432
KERP_DB_NAME=kerp
KERP_DB_USER=kerp
KERP_DB_PASSWORD=secret
KERP_REDIS_URL=redis://localhost:6379
KERP_JWT_SECRET=your-secret-key
KERP_POPBILL_LINK_ID=your-link-id
KERP_POPBILL_SECRET_KEY=your-secret-key

# Frontend (.env)
VITE_API_BASE_URL=https://api.kerp.example.com
VITE_APP_NAME=K-ERP
VITE_ENABLE_MOCK=false

# ❌ Bad: 의미 불명확
HOST=localhost
SECRET=abc123
URL=http://example.com
```

### 3.4 API 엔드포인트 명명

```
# RESTful 규칙

# 리소스 목록
GET    /api/v1/vouchers
GET    /api/v1/vouchers?status=draft&limit=20

# 리소스 상세
GET    /api/v1/vouchers/{id}

# 리소스 생성
POST   /api/v1/vouchers

# 리소스 수정
PUT    /api/v1/vouchers/{id}        # 전체 교체
PATCH  /api/v1/vouchers/{id}        # 부분 수정

# 리소스 삭제
DELETE /api/v1/vouchers/{id}

# 중첩 리소스
GET    /api/v1/vouchers/{id}/lines
POST   /api/v1/vouchers/{id}/lines

# 액션 (RPC 스타일, 필요시)
POST   /api/v1/vouchers/{id}/approve
POST   /api/v1/vouchers/{id}/reject
POST   /api/v1/vouchers/bulk-approve

# ❌ Bad
GET    /api/v1/getVouchers
POST   /api/v1/createVoucher
POST   /api/v1/voucher/delete/{id}
```

---

## 4. 린터 설정

### 4.1 Go (golangci-lint)

```yaml
# .golangci.yml
run:
  timeout: 5m
  skip-dirs:
    - vendor
    - generated

linters:
  enable:
    - errcheck
    - gosimple
    - govet
    - ineffassign
    - staticcheck
    - unused
    - gofmt
    - goimports
    - misspell
    - unconvert
    - gocritic
    - revive

linters-settings:
  errcheck:
    check-type-assertions: true
    check-blank: true

  govet:
    check-shadowing: true

  revive:
    rules:
      - name: exported
        disabled: false
      - name: var-naming
        disabled: false

  gocritic:
    enabled-tags:
      - diagnostic
      - style
      - performance

issues:
  exclude-rules:
    - path: _test\.go
      linters:
        - errcheck
```

### 4.2 TypeScript/React (ESLint)

```javascript
// .eslintrc.cjs
module.exports = {
  root: true,
  env: { browser: true, es2020: true },
  extends: [
    'eslint:recommended',
    'plugin:@typescript-eslint/recommended',
    'plugin:react-hooks/recommended',
    'plugin:react/recommended',
    'prettier',
  ],
  ignorePatterns: ['dist', '.eslintrc.cjs'],
  parser: '@typescript-eslint/parser',
  plugins: ['react-refresh'],
  rules: {
    'react-refresh/only-export-components': [
      'warn',
      { allowConstantExport: true },
    ],
    'react/react-in-jsx-scope': 'off',
    '@typescript-eslint/no-unused-vars': ['error', { argsIgnorePattern: '^_' }],
    '@typescript-eslint/explicit-function-return-type': 'off',
    '@typescript-eslint/no-explicit-any': 'error',
    'no-console': ['warn', { allow: ['warn', 'error'] }],
  },
  settings: {
    react: {
      version: 'detect',
    },
  },
}
```

### 4.3 Prettier

```json
// .prettierrc
{
  "semi": false,
  "singleQuote": true,
  "tabWidth": 2,
  "trailingComma": "es5",
  "printWidth": 100,
  "bracketSpacing": true,
  "arrowParens": "always",
  "endOfLine": "lf"
}
```

---

**문서 버전**: 1.0
**작성일**: 2025년 1월
**작성자**: K-ERP 개발팀

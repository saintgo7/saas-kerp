# 20. ê³ ê° ì˜¨ë³´ë”© ê°€ì´ë“œ

## ê°œìš”

K-ERP ì‹ ê·œ ê³ ê°(í…Œë„ŒíŠ¸)ì˜ ì˜¨ë³´ë”© í”„ë¡œì„¸ìŠ¤ ë° ì´ˆê¸° ì„¤ì • ê°€ì´ë“œ.
SaaS ë©€í‹°í…Œë„ŒíŠ¸ í™˜ê²½ì—ì„œì˜ ê³ ê° ë°ì´í„° ë¶„ë¦¬ ë° ì´ˆê¸°í™” ì ˆì°¨.

### ì˜¨ë³´ë”© ëª©í‘œ

| ëª©í‘œ | ì¸¡ì • ì§€í‘œ |
|------|----------|
| ë¹ ë¥¸ ì‹œì‘ | ê°€ì… í›„ 30ë¶„ ë‚´ ì²« ì „í‘œ ì…ë ¥ |
| ìê¸° í•™ìŠµ | ê°€ì´ë“œ íˆ¬ì–´ ì™„ë£Œìœ¨ 80%+ |
| ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ | ê¸°ì¡´ ë°ì´í„° ì´ê´€ ì§€ì› |
| ì´ˆê¸° ì„¤ì • ìë™í™” | ìˆ˜ë™ ì„¤ì • ìµœì†Œí™” |

---

## 1. ì˜¨ë³´ë”© í”„ë¡œì„¸ìŠ¤ ê°œìš”

### 1.1 ì˜¨ë³´ë”© í”Œë¡œìš°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       K-ERP ì˜¨ë³´ë”© í”Œë¡œìš°                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  [1. íšŒì›ê°€ì…]                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ì´ë©”ì¼ ì¸ì¦ â†’ ì•½ê´€ ë™ì˜ â†’ ê¸°ë³¸ ì •ë³´ ì…ë ¥                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â–¼                                       â”‚
â”‚  [2. íšŒì‚¬ ì •ë³´ ë“±ë¡]                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ ê²€ì¦ â†’ íšŒì‚¬ ì •ë³´ ì…ë ¥ â†’ í…Œë„ŒíŠ¸ ìƒì„±          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â–¼                                       â”‚
â”‚  [3. ìš”ê¸ˆì œ ì„ íƒ]                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ìš”ê¸ˆì œ ë¹„êµ â†’ ê²°ì œ ì •ë³´ ì…ë ¥ â†’ êµ¬ë… ì‹œì‘                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â–¼                                       â”‚
â”‚  [4. ì´ˆê¸° ì„¤ì •]                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  íšŒê³„ê¸°ê°„ ì„¤ì • â†’ ê³„ì •ê³¼ëª© ì„ íƒ â†’ ê¸°ì´ˆ ì”ì•¡ ì…ë ¥              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â–¼                                       â”‚
â”‚  [5. ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜] (ì„ íƒ)                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ê¸°ì¡´ ë°ì´í„° ì—…ë¡œë“œ â†’ ê²€ì¦ â†’ ë³€í™˜ â†’ ì ì¬                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â–¼                                       â”‚
â”‚  [6. ê°€ì´ë“œ íˆ¬ì–´]                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ëŒ€ì‹œë³´ë“œ â†’ ì „í‘œ ì…ë ¥ â†’ ì¬ë¬´ì œí‘œ â†’ ì„¸ê¸ˆê³„ì‚°ì„œ                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ì˜¨ë³´ë”© ë‹¨ê³„ë³„ ì†Œìš” ì‹œê°„

| ë‹¨ê³„ | ì˜ˆìƒ ì‹œê°„ | í•„ìˆ˜ ì—¬ë¶€ |
|------|----------|----------|
| íšŒì›ê°€ì… | 3ë¶„ | í•„ìˆ˜ |
| íšŒì‚¬ ì •ë³´ ë“±ë¡ | 5ë¶„ | í•„ìˆ˜ |
| ìš”ê¸ˆì œ ì„ íƒ | 5ë¶„ | í•„ìˆ˜ (14ì¼ ë¬´ë£Œ ì²´í—˜ ê°€ëŠ¥) |
| ì´ˆê¸° ì„¤ì • | 10ë¶„ | í•„ìˆ˜ |
| ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ | 30ë¶„~ | ì„ íƒ |
| ê°€ì´ë“œ íˆ¬ì–´ | 15ë¶„ | ê¶Œì¥ |

---

## 2. í…Œë„ŒíŠ¸ ìƒì„± í”„ë¡œì„¸ìŠ¤

### 2.1 íšŒì‚¬ ë“±ë¡ API

```go
// internal/service/onboarding_service.go
package service

import (
    "context"
    "fmt"

    "kerp/internal/domain"
    "kerp/internal/apperror"
)

type OnboardingService struct {
    companyRepo   CompanyRepository
    userRepo      UserRepository
    accountRepo   AccountRepository
    billingRepo   BillingRepository
    eventPublisher EventPublisher
}

type RegisterCompanyInput struct {
    // ê´€ë¦¬ì ì •ë³´
    AdminEmail    string `json:"admin_email" validate:"required,email"`
    AdminName     string `json:"admin_name" validate:"required"`
    AdminPassword string `json:"admin_password" validate:"required,min=8"`
    AdminPhone    string `json:"admin_phone" validate:"required"`

    // íšŒì‚¬ ì •ë³´
    CompanyName       string `json:"company_name" validate:"required"`
    BusinessNumber    string `json:"business_number" validate:"required,len=10"`
    RepresentativeName string `json:"representative_name" validate:"required"`
    BusinessType      string `json:"business_type"`
    BusinessCategory  string `json:"business_category"`

    // ì£¼ì†Œ
    ZipCode  string `json:"zip_code"`
    Address1 string `json:"address1"`
    Address2 string `json:"address2"`

    // ì„¤ì •
    FiscalYearStart int `json:"fiscal_year_start" validate:"min=1,max=12"` // íšŒê³„ì—°ë„ ì‹œì‘ì›”
    AccountPlanType string `json:"account_plan_type" validate:"oneof=standard manufacturing service"`
}

type RegisterCompanyOutput struct {
    CompanyID   string `json:"company_id"`
    AdminUserID string `json:"admin_user_id"`
    AccessToken string `json:"access_token"`
}

func (s *OnboardingService) RegisterCompany(ctx context.Context, input *RegisterCompanyInput) (*RegisterCompanyOutput, error) {
    // 1. ì…ë ¥ ê²€ì¦
    if err := input.Validate(); err != nil {
        return nil, err
    }

    // 2. ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ ì¤‘ë³µ í™•ì¸
    exists, err := s.companyRepo.ExistsByBusinessNumber(ctx, input.BusinessNumber)
    if err != nil {
        return nil, apperror.NewInternalError(err)
    }
    if exists {
        return nil, apperror.NewConflictError("ì´ë¯¸ ë“±ë¡ëœ ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ì…ë‹ˆë‹¤.")
    }

    // 3. ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ ìœ íš¨ì„± ê²€ì¦ (êµ­ì„¸ì²­ API)
    valid, err := s.validateBusinessNumber(ctx, input.BusinessNumber)
    if err != nil {
        return nil, apperror.NewServiceUnavailableError("ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ ê²€ì¦", err)
    }
    if !valid {
        return nil, apperror.NewValidationError(
            "ìœ íš¨í•˜ì§€ ì•Šì€ ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ì…ë‹ˆë‹¤.",
            []apperror.FieldError{
                {Field: "business_number", Code: "invalid", Message: "êµ­ì„¸ì²­ì— ë“±ë¡ë˜ì§€ ì•Šì€ ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ì…ë‹ˆë‹¤."},
            },
        )
    }

    // 4. íŠ¸ëœì­ì…˜ ì‹œì‘
    tx, err := s.companyRepo.BeginTx(ctx)
    if err != nil {
        return nil, apperror.NewInternalError(err)
    }
    defer tx.Rollback()

    // 5. íšŒì‚¬ ìƒì„±
    company := &domain.Company{
        Name:               input.CompanyName,
        BusinessNumber:     input.BusinessNumber,
        RepresentativeName: input.RepresentativeName,
        BusinessType:       input.BusinessType,
        BusinessCategory:   input.BusinessCategory,
        ZipCode:            input.ZipCode,
        Address1:           input.Address1,
        Address2:           input.Address2,
        FiscalYearStart:    input.FiscalYearStart,
        Status:             domain.CompanyStatusTrial, // 14ì¼ ë¬´ë£Œ ì²´í—˜
        TrialEndsAt:        time.Now().AddDate(0, 0, 14),
    }

    if err := s.companyRepo.CreateWithTx(ctx, tx, company); err != nil {
        return nil, apperror.NewInternalError(err)
    }

    // 6. ê´€ë¦¬ì ì‚¬ìš©ì ìƒì„±
    adminUser := &domain.User{
        CompanyID:   company.ID,
        Email:       input.AdminEmail,
        Name:        input.AdminName,
        Phone:       input.AdminPhone,
        Role:        domain.RoleAdmin,
        Status:      domain.UserStatusActive,
    }
    adminUser.SetPassword(input.AdminPassword)

    if err := s.userRepo.CreateWithTx(ctx, tx, adminUser); err != nil {
        return nil, apperror.NewInternalError(err)
    }

    // 7. ê¸°ë³¸ ê³„ì •ê³¼ëª© ìƒì„±
    if err := s.createDefaultAccounts(ctx, tx, company.ID, input.AccountPlanType); err != nil {
        return nil, apperror.NewInternalError(err)
    }

    // 8. ê¸°ë³¸ ì„¤ì • ìƒì„±
    if err := s.createDefaultSettings(ctx, tx, company.ID); err != nil {
        return nil, apperror.NewInternalError(err)
    }

    // 9. íŠ¸ëœì­ì…˜ ì»¤ë°‹
    if err := tx.Commit(); err != nil {
        return nil, apperror.NewInternalError(err)
    }

    // 10. ì´ë²¤íŠ¸ ë°œí–‰ (ë¹„ë™ê¸° ì²˜ë¦¬)
    s.eventPublisher.Publish(ctx, &domain.CompanyRegisteredEvent{
        CompanyID:  company.ID,
        AdminEmail: adminUser.Email,
    })

    // 11. í† í° ë°œê¸‰
    token, err := s.authService.GenerateToken(adminUser)
    if err != nil {
        return nil, apperror.NewInternalError(err)
    }

    return &RegisterCompanyOutput{
        CompanyID:   company.ID.String(),
        AdminUserID: adminUser.ID.String(),
        AccessToken: token,
    }, nil
}
```

### 2.2 ê¸°ë³¸ ê³„ì •ê³¼ëª© ìƒì„±

```go
// internal/service/account_plan.go
package service

// í‘œì¤€ ê³„ì •ê³¼ëª© í…œí”Œë¦¿
var standardAccountPlan = []AccountTemplate{
    // ìì‚°
    {Code: "1", Name: "ìì‚°", Type: "asset", Level: 1},
    {Code: "11", Name: "ìœ ë™ìì‚°", Type: "asset", Level: 2, ParentCode: "1"},
    {Code: "101", Name: "í˜„ê¸ˆë°í˜„ê¸ˆì„±ìì‚°", Type: "asset", Level: 3, ParentCode: "11"},
    {Code: "10101", Name: "í˜„ê¸ˆ", Type: "asset", Level: 4, ParentCode: "101"},
    {Code: "10102", Name: "ë³´í†µì˜ˆê¸ˆ", Type: "asset", Level: 4, ParentCode: "101"},
    {Code: "10103", Name: "ë‹¹ì¢Œì˜ˆê¸ˆ", Type: "asset", Level: 4, ParentCode: "101"},
    {Code: "102", Name: "ë§¤ì¶œì±„ê¶Œ", Type: "asset", Level: 3, ParentCode: "11"},
    {Code: "10201", Name: "ì™¸ìƒë§¤ì¶œê¸ˆ", Type: "asset", Level: 4, ParentCode: "102"},
    {Code: "10202", Name: "ë°›ì„ì–´ìŒ", Type: "asset", Level: 4, ParentCode: "102"},
    // ... ë” ë§ì€ ê³„ì •ê³¼ëª©

    // ë¶€ì±„
    {Code: "2", Name: "ë¶€ì±„", Type: "liability", Level: 1},
    {Code: "21", Name: "ìœ ë™ë¶€ì±„", Type: "liability", Level: 2, ParentCode: "2"},
    {Code: "201", Name: "ë§¤ì…ì±„ë¬´", Type: "liability", Level: 3, ParentCode: "21"},
    {Code: "20101", Name: "ì™¸ìƒë§¤ì…ê¸ˆ", Type: "liability", Level: 4, ParentCode: "201"},
    // ... ë” ë§ì€ ê³„ì •ê³¼ëª©

    // ìë³¸
    {Code: "3", Name: "ìë³¸", Type: "equity", Level: 1},
    {Code: "31", Name: "ìë³¸ê¸ˆ", Type: "equity", Level: 2, ParentCode: "3"},
    // ... ë” ë§ì€ ê³„ì •ê³¼ëª©

    // ìˆ˜ìµ
    {Code: "4", Name: "ìˆ˜ìµ", Type: "revenue", Level: 1},
    {Code: "41", Name: "ë§¤ì¶œì•¡", Type: "revenue", Level: 2, ParentCode: "4"},
    {Code: "401", Name: "ìƒí’ˆë§¤ì¶œ", Type: "revenue", Level: 3, ParentCode: "41"},
    {Code: "402", Name: "ì œí’ˆë§¤ì¶œ", Type: "revenue", Level: 3, ParentCode: "41"},
    {Code: "403", Name: "ì„œë¹„ìŠ¤ë§¤ì¶œ", Type: "revenue", Level: 3, ParentCode: "41"},
    // ... ë” ë§ì€ ê³„ì •ê³¼ëª©

    // ë¹„ìš©
    {Code: "5", Name: "ë¹„ìš©", Type: "expense", Level: 1},
    {Code: "51", Name: "ë§¤ì¶œì›ê°€", Type: "expense", Level: 2, ParentCode: "5"},
    {Code: "52", Name: "íŒë§¤ë¹„ì™€ê´€ë¦¬ë¹„", Type: "expense", Level: 2, ParentCode: "5"},
    {Code: "521", Name: "ê¸‰ì—¬", Type: "expense", Level: 3, ParentCode: "52"},
    {Code: "522", Name: "ë³µë¦¬í›„ìƒë¹„", Type: "expense", Level: 3, ParentCode: "52"},
    // ... ë” ë§ì€ ê³„ì •ê³¼ëª©
}

func (s *OnboardingService) createDefaultAccounts(ctx context.Context, tx Transaction, companyID uuid.UUID, planType string) error {
    var plan []AccountTemplate

    switch planType {
    case "standard":
        plan = standardAccountPlan
    case "manufacturing":
        plan = manufacturingAccountPlan
    case "service":
        plan = serviceAccountPlan
    default:
        plan = standardAccountPlan
    }

    for _, template := range plan {
        account := &domain.Account{
            CompanyID:   companyID,
            Code:        template.Code,
            Name:        template.Name,
            AccountType: template.Type,
            Level:       template.Level,
            ParentCode:  template.ParentCode,
            IsActive:    true,
            IsSystem:    true, // ì‹œìŠ¤í…œ ìƒì„± ê³„ì •
        }

        if err := s.accountRepo.CreateWithTx(ctx, tx, account); err != nil {
            return fmt.Errorf("failed to create account %s: %w", template.Code, err)
        }
    }

    return nil
}
```

---

## 3. ì´ˆê¸° ì„¤ì • ë§ˆë²•ì‚¬

### 3.1 í”„ë¡ íŠ¸ì—”ë“œ ì˜¨ë³´ë”© ìœ„ì €ë“œ

```typescript
// web/src/pages/onboarding/OnboardingWizard.tsx
import { useState } from 'react'
import { useNavigate } from 'react-router-dom'
import { Steps } from '@/components/ui/steps'
import { CompanyInfoStep } from './steps/CompanyInfoStep'
import { FiscalYearStep } from './steps/FiscalYearStep'
import { AccountPlanStep } from './steps/AccountPlanStep'
import { OpeningBalanceStep } from './steps/OpeningBalanceStep'
import { GuideTourStep } from './steps/GuideTourStep'
import { useOnboarding } from '@/hooks/useOnboarding'

const STEPS = [
  { id: 'company', title: 'íšŒì‚¬ ì •ë³´', description: 'ê¸°ë³¸ ì •ë³´ í™•ì¸' },
  { id: 'fiscal', title: 'íšŒê³„ê¸°ê°„', description: 'íšŒê³„ì—°ë„ ì„¤ì •' },
  { id: 'accounts', title: 'ê³„ì •ê³¼ëª©', description: 'ê³„ì •ì²´ê³„ ì„ íƒ' },
  { id: 'opening', title: 'ê¸°ì´ˆì”ì•¡', description: 'ê¸°ì´ˆ ì”ì•¡ ì…ë ¥' },
  { id: 'tour', title: 'ì‹œì‘í•˜ê¸°', description: 'ê°€ì´ë“œ íˆ¬ì–´' },
]

export function OnboardingWizard() {
  const [currentStep, setCurrentStep] = useState(0)
  const navigate = useNavigate()
  const { completeOnboarding } = useOnboarding()

  const handleNext = () => {
    if (currentStep < STEPS.length - 1) {
      setCurrentStep(currentStep + 1)
    } else {
      // ì˜¨ë³´ë”© ì™„ë£Œ
      completeOnboarding()
      navigate('/dashboard')
    }
  }

  const handleBack = () => {
    if (currentStep > 0) {
      setCurrentStep(currentStep - 1)
    }
  }

  const handleSkip = () => {
    // ì„ íƒ ë‹¨ê³„ëŠ” ìŠ¤í‚µ ê°€ëŠ¥
    if (['opening', 'tour'].includes(STEPS[currentStep].id)) {
      handleNext()
    }
  }

  return (
    <div className="min-h-screen bg-background p-8">
      <div className="mx-auto max-w-4xl">
        <div className="mb-8">
          <h1 className="text-2xl font-bold">K-ERP ì‹œì‘í•˜ê¸°</h1>
          <p className="text-muted-foreground">
            ëª‡ ê°€ì§€ ì„¤ì •ë§Œ ì™„ë£Œí•˜ë©´ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          </p>
        </div>

        <Steps
          steps={STEPS}
          currentStep={currentStep}
          className="mb-8"
        />

        <div className="rounded-lg border bg-card p-6">
          {currentStep === 0 && <CompanyInfoStep onNext={handleNext} />}
          {currentStep === 1 && <FiscalYearStep onNext={handleNext} onBack={handleBack} />}
          {currentStep === 2 && <AccountPlanStep onNext={handleNext} onBack={handleBack} />}
          {currentStep === 3 && (
            <OpeningBalanceStep
              onNext={handleNext}
              onBack={handleBack}
              onSkip={handleSkip}
            />
          )}
          {currentStep === 4 && (
            <GuideTourStep
              onComplete={handleNext}
              onSkip={handleSkip}
            />
          )}
        </div>
      </div>
    </div>
  )
}
```

### 3.2 íšŒê³„ê¸°ê°„ ì„¤ì •

```typescript
// web/src/pages/onboarding/steps/FiscalYearStep.tsx
import { useForm } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import { z } from 'zod'
import { Button } from '@/components/ui/button'
import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
  FormDescription,
} from '@/components/ui/form'
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select'
import { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group'
import { useUpdateCompanySettings } from '@/hooks/useCompanySettings'

const fiscalYearSchema = z.object({
  fiscalYearStart: z.number().min(1).max(12),
  currentFiscalYear: z.string().regex(/^\d{4}$/),
  vatPeriod: z.enum(['monthly', 'quarterly']),
})

type FiscalYearFormData = z.infer<typeof fiscalYearSchema>

interface FiscalYearStepProps {
  onNext: () => void
  onBack: () => void
}

export function FiscalYearStep({ onNext, onBack }: FiscalYearStepProps) {
  const updateSettings = useUpdateCompanySettings()

  const form = useForm<FiscalYearFormData>({
    resolver: zodResolver(fiscalYearSchema),
    defaultValues: {
      fiscalYearStart: 1,
      currentFiscalYear: new Date().getFullYear().toString(),
      vatPeriod: 'quarterly',
    },
  })

  const onSubmit = async (data: FiscalYearFormData) => {
    await updateSettings.mutateAsync({
      fiscal_year_start: data.fiscalYearStart,
      current_fiscal_year: parseInt(data.currentFiscalYear),
      vat_period: data.vatPeriod,
    })
    onNext()
  }

  return (
    <Form {...form}>
      <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-6">
        <div>
          <h2 className="text-lg font-semibold">íšŒê³„ê¸°ê°„ ì„¤ì •</h2>
          <p className="text-sm text-muted-foreground">
            íšŒê³„ì—°ë„ ì‹œì‘ì›”ê³¼ ë¶€ê°€ì„¸ ì‹ ê³  ê¸°ê°„ì„ ì„¤ì •í•©ë‹ˆë‹¤.
          </p>
        </div>

        <FormField
          control={form.control}
          name="fiscalYearStart"
          render={({ field }) => (
            <FormItem>
              <FormLabel>íšŒê³„ì—°ë„ ì‹œì‘ì›”</FormLabel>
              <Select
                onValueChange={(v) => field.onChange(parseInt(v))}
                defaultValue={field.value.toString()}
              >
                <FormControl>
                  <SelectTrigger>
                    <SelectValue placeholder="ì‹œì‘ì›” ì„ íƒ" />
                  </SelectTrigger>
                </FormControl>
                <SelectContent>
                  {Array.from({ length: 12 }, (_, i) => i + 1).map((month) => (
                    <SelectItem key={month} value={month.toString()}>
                      {month}ì›”
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
              <FormDescription>
                ëŒ€ë¶€ë¶„ì˜ ê¸°ì—…ì€ 1ì›”(1~12ì›”)ì„ íšŒê³„ì—°ë„ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
              </FormDescription>
              <FormMessage />
            </FormItem>
          )}
        />

        <FormField
          control={form.control}
          name="currentFiscalYear"
          render={({ field }) => (
            <FormItem>
              <FormLabel>í˜„ì¬ íšŒê³„ì—°ë„</FormLabel>
              <Select onValueChange={field.onChange} defaultValue={field.value}>
                <FormControl>
                  <SelectTrigger>
                    <SelectValue placeholder="íšŒê³„ì—°ë„ ì„ íƒ" />
                  </SelectTrigger>
                </FormControl>
                <SelectContent>
                  {[2023, 2024, 2025].map((year) => (
                    <SelectItem key={year} value={year.toString()}>
                      {year}ë…„
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
              <FormMessage />
            </FormItem>
          )}
        />

        <FormField
          control={form.control}
          name="vatPeriod"
          render={({ field }) => (
            <FormItem>
              <FormLabel>ë¶€ê°€ì„¸ ì‹ ê³  ê¸°ê°„</FormLabel>
              <FormControl>
                <RadioGroup
                  onValueChange={field.onChange}
                  defaultValue={field.value}
                  className="flex gap-4"
                >
                  <div className="flex items-center space-x-2">
                    <RadioGroupItem value="quarterly" id="quarterly" />
                    <label htmlFor="quarterly" className="text-sm">
                      ë¶„ê¸°ë³„ (1ì›”, 4ì›”, 7ì›”, 10ì›”)
                    </label>
                  </div>
                  <div className="flex items-center space-x-2">
                    <RadioGroupItem value="monthly" id="monthly" />
                    <label htmlFor="monthly" className="text-sm">
                      ë§¤ì›”
                    </label>
                  </div>
                </RadioGroup>
              </FormControl>
              <FormDescription>
                ì¼ë°˜ ì‚¬ì—…ìëŠ” ë¶„ê¸°ë³„, ê°„ì´ ì‚¬ì—…ìëŠ” ì—° 1íšŒ ì‹ ê³ í•©ë‹ˆë‹¤.
              </FormDescription>
              <FormMessage />
            </FormItem>
          )}
        />

        <div className="flex justify-between pt-4">
          <Button type="button" variant="outline" onClick={onBack}>
            ì´ì „
          </Button>
          <Button type="submit" disabled={updateSettings.isPending}>
            {updateSettings.isPending ? 'ì €ì¥ ì¤‘...' : 'ë‹¤ìŒ'}
          </Button>
        </div>
      </form>
    </Form>
  )
}
```

---

## 4. ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜

### 4.1 Excel í…œí”Œë¦¿ ê¸°ë°˜ ë§ˆì´ê·¸ë ˆì´ì…˜

```go
// internal/service/migration_service.go
package service

import (
    "context"
    "fmt"
    "io"

    "github.com/xuri/excelize/v2"
)

type MigrationService struct {
    companyRepo   CompanyRepository
    accountRepo   AccountRepository
    voucherRepo   VoucherRepository
    customerRepo  CustomerRepository
    eventPublisher EventPublisher
}

type MigrationInput struct {
    CompanyID  uuid.UUID
    DataType   string // accounts, customers, opening_balances, vouchers
    FileReader io.Reader
}

type MigrationResult struct {
    TotalRows    int      `json:"total_rows"`
    SuccessRows  int      `json:"success_rows"`
    FailedRows   int      `json:"failed_rows"`
    Errors       []MigrationError `json:"errors,omitempty"`
}

type MigrationError struct {
    Row     int    `json:"row"`
    Column  string `json:"column,omitempty"`
    Message string `json:"message"`
}

// ImportOpeningBalances ê¸°ì´ˆì”ì•¡ ë§ˆì´ê·¸ë ˆì´ì…˜
func (s *MigrationService) ImportOpeningBalances(ctx context.Context, input *MigrationInput) (*MigrationResult, error) {
    result := &MigrationResult{}

    // Excel íŒŒì¼ íŒŒì‹±
    f, err := excelize.OpenReader(input.FileReader)
    if err != nil {
        return nil, apperror.NewValidationError(
            "Excel íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",
            []apperror.FieldError{
                {Field: "file", Code: "invalid_format", Message: "ìœ íš¨í•œ Excel íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤."},
            },
        )
    }
    defer f.Close()

    // ì‹œíŠ¸ ë°ì´í„° ì½ê¸°
    rows, err := f.GetRows("ê¸°ì´ˆì”ì•¡")
    if err != nil {
        return nil, apperror.NewValidationError(
            "'ê¸°ì´ˆì”ì•¡' ì‹œíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",
            nil,
        )
    }

    // í—¤ë” ê²€ì¦ (1í–‰)
    if len(rows) < 2 {
        return nil, apperror.NewValidationError("ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.", nil)
    }

    expectedHeaders := []string{"ê³„ì •ì½”ë“œ", "ê³„ì •ëª…", "ì°¨ë³€ì”ì•¡", "ëŒ€ë³€ì”ì•¡"}
    if !validateHeaders(rows[0], expectedHeaders) {
        return nil, apperror.NewValidationError(
            "í…œí”Œë¦¿ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. ì˜¬ë°”ë¥¸ í…œí”Œë¦¿ì„ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”.",
            nil,
        )
    }

    // ë°ì´í„° ì²˜ë¦¬ (2í–‰ë¶€í„°)
    var balances []*domain.OpeningBalance

    for i, row := range rows[1:] {
        rowNum := i + 2 // Excel í–‰ ë²ˆí˜¸
        result.TotalRows++

        if len(row) < 4 {
            result.FailedRows++
            result.Errors = append(result.Errors, MigrationError{
                Row:     rowNum,
                Message: "ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.",
            })
            continue
        }

        accountCode := strings.TrimSpace(row[0])
        debitAmount, err1 := parseAmount(row[2])
        creditAmount, err2 := parseAmount(row[3])

        if err1 != nil || err2 != nil {
            result.FailedRows++
            result.Errors = append(result.Errors, MigrationError{
                Row:     rowNum,
                Column:  "ê¸ˆì•¡",
                Message: "ê¸ˆì•¡ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.",
            })
            continue
        }

        // ê³„ì •ì½”ë“œ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
        account, err := s.accountRepo.FindByCode(ctx, input.CompanyID, accountCode)
        if err != nil {
            result.FailedRows++
            result.Errors = append(result.Errors, MigrationError{
                Row:     rowNum,
                Column:  "ê³„ì •ì½”ë“œ",
                Message: fmt.Sprintf("ê³„ì •ì½”ë“œ '%s'ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", accountCode),
            })
            continue
        }

        balances = append(balances, &domain.OpeningBalance{
            CompanyID:    input.CompanyID,
            AccountID:    account.ID,
            AccountCode:  accountCode,
            DebitAmount:  debitAmount,
            CreditAmount: creditAmount,
        })

        result.SuccessRows++
    }

    // ì°¨ëŒ€ ê· í˜• ê²€ì¦
    totalDebit := decimal.Zero
    totalCredit := decimal.Zero
    for _, b := range balances {
        totalDebit = totalDebit.Add(b.DebitAmount)
        totalCredit = totalCredit.Add(b.CreditAmount)
    }

    if !totalDebit.Equal(totalCredit) {
        return nil, apperror.NewValidationError(
            fmt.Sprintf("ê¸°ì´ˆì”ì•¡ì˜ ì°¨ë³€ í•©ê³„(%s)ì™€ ëŒ€ë³€ í•©ê³„(%s)ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.",
                totalDebit.String(), totalCredit.String()),
            nil,
        )
    }

    // ì €ì¥
    if len(balances) > 0 {
        if err := s.accountRepo.SaveOpeningBalances(ctx, input.CompanyID, balances); err != nil {
            return nil, apperror.NewInternalError(err)
        }
    }

    return result, nil
}

// GetMigrationTemplate ë§ˆì´ê·¸ë ˆì´ì…˜ í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ
func (s *MigrationService) GetMigrationTemplate(dataType string) (io.Reader, string, error) {
    f := excelize.NewFile()

    switch dataType {
    case "opening_balances":
        // ê¸°ì´ˆì”ì•¡ í…œí”Œë¦¿
        f.SetSheetName("Sheet1", "ê¸°ì´ˆì”ì•¡")
        f.SetSheetRow("ê¸°ì´ˆì”ì•¡", "A1", &[]interface{}{
            "ê³„ì •ì½”ë“œ", "ê³„ì •ëª…", "ì°¨ë³€ì”ì•¡", "ëŒ€ë³€ì”ì•¡",
        })
        // ì˜ˆì‹œ ë°ì´í„°
        f.SetSheetRow("ê¸°ì´ˆì”ì•¡", "A2", &[]interface{}{
            "10101", "í˜„ê¸ˆ", 1000000, 0,
        })
        f.SetSheetRow("ê¸°ì´ˆì”ì•¡", "A3", &[]interface{}{
            "31101", "ìë³¸ê¸ˆ", 0, 1000000,
        })

    case "customers":
        // ê±°ë˜ì²˜ í…œí”Œë¦¿
        f.SetSheetName("Sheet1", "ê±°ë˜ì²˜")
        f.SetSheetRow("ê±°ë˜ì²˜", "A1", &[]interface{}{
            "ê±°ë˜ì²˜ì½”ë“œ", "ê±°ë˜ì²˜ëª…", "ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸", "ëŒ€í‘œìëª…",
            "ì—…íƒœ", "ì¢…ëª©", "ì£¼ì†Œ", "ì „í™”ë²ˆí˜¸", "ì´ë©”ì¼",
        })

    case "items":
        // í’ˆëª© í…œí”Œë¦¿
        f.SetSheetName("Sheet1", "í’ˆëª©")
        f.SetSheetRow("í’ˆëª©", "A1", &[]interface{}{
            "í’ˆëª©ì½”ë“œ", "í’ˆëª©ëª…", "ê·œê²©", "ë‹¨ìœ„", "ë‹¨ê°€", "ê³¼ì„¸ìœ í˜•",
        })
    }

    buffer, err := f.WriteToBuffer()
    if err != nil {
        return nil, "", err
    }

    filename := fmt.Sprintf("kerp_%s_template.xlsx", dataType)
    return buffer, filename, nil
}
```

### 4.2 ë§ˆì´ê·¸ë ˆì´ì…˜ í”„ë¡ íŠ¸ì—”ë“œ

```typescript
// web/src/pages/onboarding/steps/OpeningBalanceStep.tsx
import { useState } from 'react'
import { useDropzone } from 'react-dropzone'
import { Button } from '@/components/ui/button'
import { Alert, AlertDescription } from '@/components/ui/alert'
import { Progress } from '@/components/ui/progress'
import { Download, Upload, AlertCircle, CheckCircle } from 'lucide-react'
import { useImportOpeningBalances, useDownloadTemplate } from '@/hooks/useMigration'

interface OpeningBalanceStepProps {
  onNext: () => void
  onBack: () => void
  onSkip: () => void
}

export function OpeningBalanceStep({ onNext, onBack, onSkip }: OpeningBalanceStepProps) {
  const [uploadResult, setUploadResult] = useState<ImportResult | null>(null)

  const downloadTemplate = useDownloadTemplate()
  const importBalances = useImportOpeningBalances()

  const { getRootProps, getInputProps, isDragActive } = useDropzone({
    accept: {
      'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': ['.xlsx'],
      'application/vnd.ms-excel': ['.xls'],
    },
    maxFiles: 1,
    onDrop: async (files) => {
      if (files.length === 0) return

      try {
        const result = await importBalances.mutateAsync({ file: files[0] })
        setUploadResult(result)
      } catch (error) {
        // ì—ëŸ¬ëŠ” mutationì—ì„œ ì²˜ë¦¬
      }
    },
  })

  const handleDownloadTemplate = async () => {
    const blob = await downloadTemplate.mutateAsync('opening_balances')
    const url = URL.createObjectURL(blob)
    const a = document.createElement('a')
    a.href = url
    a.download = 'kerp_opening_balances_template.xlsx'
    a.click()
    URL.revokeObjectURL(url)
  }

  return (
    <div className="space-y-6">
      <div>
        <h2 className="text-lg font-semibold">ê¸°ì´ˆì”ì•¡ ì…ë ¥</h2>
        <p className="text-sm text-muted-foreground">
          ê¸°ì¡´ íšŒê³„ ë°ì´í„°ê°€ ìˆë‹¤ë©´ ê¸°ì´ˆì”ì•¡ì„ ì…ë ¥í•˜ì„¸ìš”.
          ì²˜ìŒ ì‹œì‘í•˜ëŠ” ê²½ìš° ê±´ë„ˆë›¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </p>
      </div>

      {/* í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ */}
      <div className="rounded-lg border p-4">
        <h3 className="font-medium mb-2">1. í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ</h3>
        <p className="text-sm text-muted-foreground mb-4">
          ì•„ë˜ í…œí”Œë¦¿ì„ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ê¸°ì´ˆì”ì•¡ì„ ì…ë ¥í•˜ì„¸ìš”.
        </p>
        <Button
          variant="outline"
          onClick={handleDownloadTemplate}
          disabled={downloadTemplate.isPending}
        >
          <Download className="mr-2 h-4 w-4" />
          Excel í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ
        </Button>
      </div>

      {/* íŒŒì¼ ì—…ë¡œë“œ */}
      <div className="rounded-lg border p-4">
        <h3 className="font-medium mb-2">2. íŒŒì¼ ì—…ë¡œë“œ</h3>
        <div
          {...getRootProps()}
          className={`
            border-2 border-dashed rounded-lg p-8 text-center cursor-pointer
            transition-colors
            ${isDragActive ? 'border-primary bg-primary/5' : 'border-muted'}
            ${importBalances.isPending ? 'pointer-events-none opacity-50' : ''}
          `}
        >
          <input {...getInputProps()} />
          <Upload className="mx-auto h-8 w-8 text-muted-foreground mb-2" />
          {isDragActive ? (
            <p>íŒŒì¼ì„ ì—¬ê¸°ì— ë†“ìœ¼ì„¸ìš”</p>
          ) : (
            <p>
              Excel íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ <span className="text-primary">í´ë¦­</span>í•˜ì—¬ ì—…ë¡œë“œ
            </p>
          )}
        </div>

        {importBalances.isPending && (
          <div className="mt-4">
            <Progress value={undefined} className="w-full" />
            <p className="text-sm text-center mt-2">ì—…ë¡œë“œ ì¤‘...</p>
          </div>
        )}
      </div>

      {/* ì—…ë¡œë“œ ê²°ê³¼ */}
      {uploadResult && (
        <Alert variant={uploadResult.failedRows > 0 ? 'destructive' : 'default'}>
          {uploadResult.failedRows > 0 ? (
            <AlertCircle className="h-4 w-4" />
          ) : (
            <CheckCircle className="h-4 w-4" />
          )}
          <AlertDescription>
            <p className="font-medium">
              ì´ {uploadResult.totalRows}ê±´ ì¤‘ {uploadResult.successRows}ê±´ ì„±ê³µ
              {uploadResult.failedRows > 0 && `, ${uploadResult.failedRows}ê±´ ì‹¤íŒ¨`}
            </p>
            {uploadResult.errors?.length > 0 && (
              <ul className="mt-2 text-sm list-disc list-inside">
                {uploadResult.errors.slice(0, 5).map((err, i) => (
                  <li key={i}>
                    {err.row}í–‰: {err.message}
                  </li>
                ))}
                {uploadResult.errors.length > 5 && (
                  <li>... ì™¸ {uploadResult.errors.length - 5}ê±´</li>
                )}
              </ul>
            )}
          </AlertDescription>
        </Alert>
      )}

      {/* ë²„íŠ¼ */}
      <div className="flex justify-between pt-4">
        <Button type="button" variant="outline" onClick={onBack}>
          ì´ì „
        </Button>
        <div className="space-x-2">
          <Button type="button" variant="ghost" onClick={onSkip}>
            ê±´ë„ˆë›°ê¸°
          </Button>
          <Button
            onClick={onNext}
            disabled={!uploadResult || uploadResult.successRows === 0}
          >
            ë‹¤ìŒ
          </Button>
        </div>
      </div>
    </div>
  )
}
```

---

## 5. ê°€ì´ë“œ íˆ¬ì–´

### 5.1 ì¸í„°ë™í‹°ë¸Œ íˆ¬ì–´ êµ¬í˜„

```typescript
// web/src/components/tour/GuidedTour.tsx
import { useState, useEffect } from 'react'
import Joyride, { Step, CallBackProps, STATUS } from 'react-joyride'
import { useLocalStorage } from '@/hooks/useLocalStorage'

const TOUR_STEPS: Step[] = [
  {
    target: '[data-tour="sidebar"]',
    content: 'ì™¼ìª½ ì‚¬ì´ë“œë°”ì—ì„œ ëª¨ë“  ë©”ë‰´ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
    placement: 'right',
    disableBeacon: true,
  },
  {
    target: '[data-tour="dashboard-summary"]',
    content: 'ëŒ€ì‹œë³´ë“œì—ì„œ ë§¤ì¶œ, ë¹„ìš©, í˜„ê¸ˆíë¦„ ë“± í•µì‹¬ ì§€í‘œë¥¼ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”.',
    placement: 'bottom',
  },
  {
    target: '[data-tour="quick-actions"]',
    content: 'ìì£¼ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥ì„ ë¹ ë¥´ê²Œ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
    placement: 'left',
  },
  {
    target: '[data-tour="voucher-entry"]',
    content: 'ì „í‘œì…ë ¥ ë©”ë‰´ì—ì„œ ê±°ë˜ë¥¼ ê¸°ë¡í•©ë‹ˆë‹¤. ì°¨ë³€ê³¼ ëŒ€ë³€ì´ ìë™ìœ¼ë¡œ ê· í˜•ì„ ë§ì¶¥ë‹ˆë‹¤.',
    placement: 'right',
  },
  {
    target: '[data-tour="reports"]',
    content: 'ì¬ë¬´ì œí‘œì™€ ê°ì¢… ë¦¬í¬íŠ¸ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
    placement: 'right',
  },
  {
    target: '[data-tour="tax-invoice"]',
    content: 'ì„¸ê¸ˆê³„ì‚°ì„œë¥¼ ë°œí–‰í•˜ê³  êµ­ì„¸ì²­ì— ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
    placement: 'right',
  },
  {
    target: '[data-tour="help"]',
    content: 'ë„ì›€ì´ í•„ìš”í•˜ì‹œë©´ ì–¸ì œë“  ê³ ê°ì„¼í„°ì— ë¬¸ì˜í•˜ì„¸ìš”.',
    placement: 'left',
  },
]

interface GuidedTourProps {
  onComplete?: () => void
}

export function GuidedTour({ onComplete }: GuidedTourProps) {
  const [run, setRun] = useState(false)
  const [tourCompleted, setTourCompleted] = useLocalStorage('tour_completed', false)

  useEffect(() => {
    if (!tourCompleted) {
      // í˜ì´ì§€ ë¡œë“œ í›„ ì•½ê°„ì˜ ë”œë ˆì´
      const timer = setTimeout(() => setRun(true), 500)
      return () => clearTimeout(timer)
    }
  }, [tourCompleted])

  const handleCallback = (data: CallBackProps) => {
    const { status } = data

    if (status === STATUS.FINISHED || status === STATUS.SKIPPED) {
      setRun(false)
      setTourCompleted(true)
      onComplete?.()
    }
  }

  return (
    <Joyride
      steps={TOUR_STEPS}
      run={run}
      continuous
      showProgress
      showSkipButton
      callback={handleCallback}
      locale={{
        back: 'ì´ì „',
        close: 'ë‹«ê¸°',
        last: 'ì™„ë£Œ',
        next: 'ë‹¤ìŒ',
        skip: 'ê±´ë„ˆë›°ê¸°',
      }}
      styles={{
        options: {
          primaryColor: 'hsl(var(--primary))',
          zIndex: 10000,
        },
      }}
    />
  )
}
```

---

## 6. ì˜¨ë³´ë”© ì™„ë£Œ í›„ ì²˜ë¦¬

### 6.1 ì›°ì»´ ì´ë©”ì¼ ë°œì†¡

```go
// internal/service/notification_service.go
package service

type WelcomeEmailData struct {
    CompanyName    string
    AdminName      string
    AdminEmail     string
    LoginURL       string
    SupportEmail   string
    DocsURL        string
    TrialEndsAt    time.Time
}

func (s *NotificationService) SendWelcomeEmail(ctx context.Context, data *WelcomeEmailData) error {
    template := `
ì•ˆë…•í•˜ì„¸ìš”, {{.AdminName}}ë‹˜!

{{.CompanyName}}ì˜ K-ERP ê°€ì…ì„ í™˜ì˜í•©ë‹ˆë‹¤!

K-ERPë¥¼ í†µí•´ íšŒê³„, ì„¸ê¸ˆê³„ì‚°ì„œ, ê¸‰ì—¬ ê´€ë¦¬ë¥¼ ë”ìš± í¸ë¦¬í•˜ê²Œ ì´ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ğŸ“Œ ì‹œì‘í•˜ê¸°
- ë¡œê·¸ì¸: {{.LoginURL}}
- ì‚¬ìš© ê°€ì´ë“œ: {{.DocsURL}}

ğŸ ë¬´ë£Œ ì²´í—˜ ê¸°ê°„
{{.TrialEndsAt.Format "2006ë…„ 01ì›” 02ì¼"}}ê¹Œì§€ ëª¨ë“  ê¸°ëŠ¥ì„ ë¬´ë£Œë¡œ ì´ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê¶ê¸ˆí•˜ì‹  ì ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ë¬¸ì˜í•´ ì£¼ì„¸ìš”.
- ê³ ê°ì„¼í„°: {{.SupportEmail}}
- ì „í™”: 1588-0000

ê°ì‚¬í•©ë‹ˆë‹¤.
K-ERP íŒ€ ë“œë¦¼
`

    return s.emailClient.Send(ctx, &EmailMessage{
        To:      []string{data.AdminEmail},
        Subject: fmt.Sprintf("[K-ERP] %së‹˜, ê°€ì…ì„ í™˜ì˜í•©ë‹ˆë‹¤!", data.AdminName),
        Body:    executeTemplate(template, data),
    })
}
```

### 6.2 ì˜¨ë³´ë”© ì§„í–‰ë¥  ì¶”ì 

```go
// internal/service/onboarding_progress_service.go
package service

type OnboardingProgress struct {
    CompanyID         uuid.UUID `json:"company_id"`
    CompletedSteps    []string  `json:"completed_steps"`
    CurrentStep       string    `json:"current_step"`
    ProgressPercent   int       `json:"progress_percent"`
    IsComplete        bool      `json:"is_complete"`
    CompletedAt       *time.Time `json:"completed_at,omitempty"`
}

var onboardingSteps = []string{
    "company_info",
    "fiscal_year",
    "account_plan",
    "opening_balance",
    "guide_tour",
}

func (s *OnboardingService) GetProgress(ctx context.Context, companyID uuid.UUID) (*OnboardingProgress, error) {
    company, err := s.companyRepo.FindByID(ctx, companyID)
    if err != nil {
        return nil, err
    }

    progress := &OnboardingProgress{
        CompanyID:      companyID,
        CompletedSteps: company.OnboardingSteps,
    }

    // ì§„í–‰ë¥  ê³„ì‚°
    completedCount := len(company.OnboardingSteps)
    totalCount := len(onboardingSteps)
    progress.ProgressPercent = (completedCount * 100) / totalCount

    // í˜„ì¬ ë‹¨ê³„ í™•ì¸
    for _, step := range onboardingSteps {
        if !contains(company.OnboardingSteps, step) {
            progress.CurrentStep = step
            break
        }
    }

    // ì™„ë£Œ ì—¬ë¶€
    if completedCount >= totalCount {
        progress.IsComplete = true
        progress.CompletedAt = company.OnboardingCompletedAt
    }

    return progress, nil
}

func (s *OnboardingService) CompleteStep(ctx context.Context, companyID uuid.UUID, step string) error {
    // ìœ íš¨í•œ ë‹¨ê³„ì¸ì§€ í™•ì¸
    if !contains(onboardingSteps, step) {
        return apperror.NewValidationError("ìœ íš¨í•˜ì§€ ì•Šì€ ì˜¨ë³´ë”© ë‹¨ê³„ì…ë‹ˆë‹¤.", nil)
    }

    return s.companyRepo.AddOnboardingStep(ctx, companyID, step)
}
```

---

**ë¬¸ì„œ ë²„ì „**: 1.0
**ì‘ì„±ì¼**: 2025ë…„ 1ì›”
**ì‘ì„±ì**: K-ERP ê°œë°œíŒ€

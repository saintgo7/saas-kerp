# 13. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ìƒì„¸

## ê°œìš”

K-ERP ì‹œìŠ¤í…œì˜ PostgreSQL ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ìƒì„¸ ì„¤ê³„.
DDL, ì¸ë±ìŠ¤, ì œì•½ì¡°ê±´, íŒŒí‹°ì…”ë‹ ì „ëµ í¬í•¨.

### ì„¤ê³„ ì›ì¹™

| ì›ì¹™ | ì„¤ëª… |
|------|------|
| ë©€í‹°í…Œë„Œì‹œ | ëª¨ë“  í…Œì´ë¸”ì— `company_id` í•„ìˆ˜ |
| RLS | Row Level Securityë¡œ í…Œë„ŒíŠ¸ ê²©ë¦¬ |
| UUID | Primary KeyëŠ” UUID v4 ì‚¬ìš© |
| ê°ì‚¬ ë¡œê·¸ | `created_at`, `updated_at`, `deleted_at` |
| Soft Delete | ë¬¼ë¦¬ ì‚­ì œ ëŒ€ì‹  ë…¼ë¦¬ ì‚­ì œ |

---

## 1. ê³µí†µ ì„¤ì •

### 1.1 í™•ì¥ ëª¨ë“ˆ ì„¤ì¹˜

#### MVP í•„ìˆ˜ í™•ì¥ (Phase 1)

```sql
-- db/migrations/000001_init_extensions.up.sql

-- UUID ìƒì„± (í•„ìˆ˜: ëª¨ë“  í…Œì´ë¸” PK)
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- ì•”í˜¸í™” (í•„ìˆ˜: ë¯¼ê° ë°ì´í„° ì•”í˜¸í™”)
CREATE EXTENSION IF NOT EXISTS "pgcrypto";
```

#### Phase 2 í™•ì¥ (ì„±ëŠ¥ ìµœì í™” ë‹¨ê³„)

```sql
-- db/migrations/000050_phase2_extensions.up.sql
-- âš ï¸ MVP ì´í›„ í•„ìš” ì‹œ ì„¤ì¹˜

-- ì „ë¬¸ ê²€ìƒ‰ (í•œê¸€) - ê²€ìƒ‰ ê¸°ëŠ¥ ê³ ë„í™” ì‹œ
CREATE EXTENSION IF NOT EXISTS "pg_trgm";

-- ë¶€ë¶„ ì¸ë±ìŠ¤ ì„±ëŠ¥ - ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬ ì‹œ
CREATE EXTENSION IF NOT EXISTS "btree_gin";
```

#### Phase 3 í™•ì¥ (ê³ ê¸‰ ê¸°ëŠ¥)

```sql
-- db/migrations/000100_phase3_extensions.up.sql
-- âš ï¸ ì‹œê³„ì—´ ë¶„ì„, ëŒ€ì‹œë³´ë“œ ê³ ë„í™” ì‹œ í•„ìš”

-- ì‹œê³„ì—´ ë°ì´í„° - ê²½ì˜ ë¶„ì„ ëŒ€ì‹œë³´ë“œ ê³ ë„í™” ì‹œ
-- CREATE EXTENSION IF NOT EXISTS "timescaledb" CASCADE;
```

> ğŸ’¡ **MVP ì›ì¹™**: ì´ˆê¸° ê°œë°œì€ uuid-ossp, pgcryptoë§Œ ì‚¬ìš©.
> ì¶”ê°€ í™•ì¥ì€ ì„±ëŠ¥ ë³‘ëª© ë°œìƒ ì‹œ ë„ì….

### 1.2 ê³µí†µ í•¨ìˆ˜

```sql
-- db/migrations/000002_common_functions.up.sql

-- í˜„ì¬ í…Œë„ŒíŠ¸ ID ì¡°íšŒ í•¨ìˆ˜
CREATE OR REPLACE FUNCTION current_tenant_id()
RETURNS UUID AS $$
BEGIN
    RETURN NULLIF(current_setting('app.current_tenant', true), '')::UUID;
END;
$$ LANGUAGE plpgsql STABLE;

-- RLS ì •ì±… ìƒì„± í—¬í¼
CREATE OR REPLACE FUNCTION enable_rls_for_table(table_name TEXT)
RETURNS VOID AS $$
BEGIN
    EXECUTE format('ALTER TABLE %I ENABLE ROW LEVEL SECURITY', table_name);
    EXECUTE format('ALTER TABLE %I FORCE ROW LEVEL SECURITY', table_name);
    EXECUTE format(
        'CREATE POLICY tenant_isolation_policy ON %I
         FOR ALL
         USING (company_id = current_tenant_id())
         WITH CHECK (company_id = current_tenant_id())',
        table_name
    );
END;
$$ LANGUAGE plpgsql;

-- Updated At ìë™ ê°±ì‹  íŠ¸ë¦¬ê±°
CREATE OR REPLACE FUNCTION update_updated_at()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- Soft Delete ë·° ìƒì„± í—¬í¼
CREATE OR REPLACE FUNCTION create_active_view(table_name TEXT)
RETURNS VOID AS $$
BEGIN
    EXECUTE format(
        'CREATE OR REPLACE VIEW %I_active AS
         SELECT * FROM %I WHERE deleted_at IS NULL',
        table_name, table_name
    );
END;
$$ LANGUAGE plpgsql;
```

---

## 2. ê¸°ì¤€ì •ë³´ í…Œì´ë¸”

### 2.1 íšŒì‚¬ (companies)

```sql
-- db/migrations/000010_create_companies.up.sql

CREATE TABLE companies (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),

    -- ê¸°ë³¸ ì •ë³´
    code VARCHAR(20) NOT NULL,
    name VARCHAR(100) NOT NULL,
    name_en VARCHAR(100),

    -- ì‚¬ì—…ì ì •ë³´
    business_number VARCHAR(10) NOT NULL,
    corp_number VARCHAR(13),
    ceo_name VARCHAR(50) NOT NULL,
    business_type VARCHAR(100),    -- ì—…íƒœ
    business_class VARCHAR(100),   -- ì¢…ëª©

    -- ì—°ë½ì²˜
    address VARCHAR(200),
    address_detail VARCHAR(100),
    postal_code VARCHAR(10),
    phone VARCHAR(20),
    fax VARCHAR(20),
    email VARCHAR(100),
    website VARCHAR(200),

    -- íšŒê³„ ì„¤ì •
    fiscal_year_start_month INTEGER DEFAULT 1 CHECK (fiscal_year_start_month BETWEEN 1 AND 12),
    currency_code VARCHAR(3) DEFAULT 'KRW',

    -- ìƒíƒœ
    status VARCHAR(20) DEFAULT 'ACTIVE' CHECK (status IN ('ACTIVE', 'SUSPENDED', 'TERMINATED')),
    subscription_plan VARCHAR(20) DEFAULT 'BASIC',

    -- ê°ì‚¬
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP WITH TIME ZONE,

    -- ì œì•½ì¡°ê±´
    CONSTRAINT uk_companies_code UNIQUE (code),
    CONSTRAINT uk_companies_business_number UNIQUE (business_number)
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_companies_status ON companies(status) WHERE deleted_at IS NULL;
CREATE INDEX idx_companies_name_trgm ON companies USING gin (name gin_trgm_ops);

-- íŠ¸ë¦¬ê±°
CREATE TRIGGER tr_companies_updated_at
    BEFORE UPDATE ON companies
    FOR EACH ROW
    EXECUTE FUNCTION update_updated_at();

COMMENT ON TABLE companies IS 'íšŒì‚¬ (í…Œë„ŒíŠ¸) ì •ë³´';
COMMENT ON COLUMN companies.business_number IS 'ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ (10ìë¦¬, í•˜ì´í”ˆ ì—†ì´)';
COMMENT ON COLUMN companies.fiscal_year_start_month IS 'íšŒê³„ì—°ë„ ì‹œì‘ì›” (1-12)';
```

### 2.2 ì‚¬ìš©ì (users)

```sql
-- db/migrations/000011_create_users.up.sql

CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    company_id UUID NOT NULL REFERENCES companies(id),

    -- ì¸ì¦ ì •ë³´
    email VARCHAR(100) NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    password_changed_at TIMESTAMP WITH TIME ZONE,

    -- ê¸°ë³¸ ì •ë³´
    name VARCHAR(50) NOT NULL,
    phone VARCHAR(20),
    department VARCHAR(50),
    position VARCHAR(50),

    -- ìƒíƒœ
    status VARCHAR(20) DEFAULT 'ACTIVE' CHECK (status IN ('ACTIVE', 'INACTIVE', 'LOCKED')),
    failed_login_attempts INTEGER DEFAULT 0,
    locked_until TIMESTAMP WITH TIME ZONE,
    last_login_at TIMESTAMP WITH TIME ZONE,

    -- MFA
    mfa_enabled BOOLEAN DEFAULT FALSE,
    mfa_secret VARCHAR(100),

    -- ê°ì‚¬
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP WITH TIME ZONE,

    -- ì œì•½ì¡°ê±´
    CONSTRAINT uk_users_email UNIQUE (email)
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_users_company_id ON users(company_id);
CREATE INDEX idx_users_email_lower ON users(LOWER(email));
CREATE INDEX idx_users_status ON users(status) WHERE deleted_at IS NULL;

-- RLS í™œì„±í™”
SELECT enable_rls_for_table('users');

-- íŠ¸ë¦¬ê±°
CREATE TRIGGER tr_users_updated_at
    BEFORE UPDATE ON users
    FOR EACH ROW
    EXECUTE FUNCTION update_updated_at();

COMMENT ON TABLE users IS 'ì‚¬ìš©ì ì •ë³´';
```

### 2.3 ì—­í•  ë° ê¶Œí•œ

```sql
-- db/migrations/000012_create_roles.up.sql

-- ì—­í• 
CREATE TABLE roles (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    company_id UUID NOT NULL REFERENCES companies(id),

    code VARCHAR(50) NOT NULL,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    is_system BOOLEAN DEFAULT FALSE,  -- ì‹œìŠ¤í…œ ê¸°ë³¸ ì—­í• 

    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT uk_roles_company_code UNIQUE (company_id, code)
);

-- ê¶Œí•œ
CREATE TABLE permissions (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),

    code VARCHAR(50) NOT NULL UNIQUE,  -- ì˜ˆ: voucher:create, report:read
    name VARCHAR(100) NOT NULL,
    module VARCHAR(50) NOT NULL,       -- ì˜ˆ: accounting, hr, inventory
    description TEXT,

    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- ì—­í• -ê¶Œí•œ ë§¤í•‘
CREATE TABLE role_permissions (
    role_id UUID NOT NULL REFERENCES roles(id) ON DELETE CASCADE,
    permission_id UUID NOT NULL REFERENCES permissions(id) ON DELETE CASCADE,

    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,

    PRIMARY KEY (role_id, permission_id)
);

-- ì‚¬ìš©ì-ì—­í•  ë§¤í•‘
CREATE TABLE user_roles (
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    role_id UUID NOT NULL REFERENCES roles(id) ON DELETE CASCADE,

    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,

    PRIMARY KEY (user_id, role_id)
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_roles_company_id ON roles(company_id);
CREATE INDEX idx_role_permissions_permission_id ON role_permissions(permission_id);
CREATE INDEX idx_user_roles_role_id ON user_roles(role_id);

-- RLS
SELECT enable_rls_for_table('roles');

-- ê¸°ë³¸ ê¶Œí•œ ë°ì´í„°
INSERT INTO permissions (code, name, module) VALUES
    -- íšŒê³„
    ('voucher:create', 'ì „í‘œ ìƒì„±', 'accounting'),
    ('voucher:read', 'ì „í‘œ ì¡°íšŒ', 'accounting'),
    ('voucher:update', 'ì „í‘œ ìˆ˜ì •', 'accounting'),
    ('voucher:delete', 'ì „í‘œ ì‚­ì œ', 'accounting'),
    ('voucher:approve', 'ì „í‘œ ìŠ¹ì¸', 'accounting'),
    ('voucher:post', 'ì „í‘œ ê¸°ì¥', 'accounting'),
    ('report:read', 'ë³´ê³ ì„œ ì¡°íšŒ', 'accounting'),
    ('report:export', 'ë³´ê³ ì„œ ë‚´ë³´ë‚´ê¸°', 'accounting'),
    -- ì„¸ê¸ˆê³„ì‚°ì„œ
    ('tax_invoice:create', 'ì„¸ê¸ˆê³„ì‚°ì„œ ìƒì„±', 'tax'),
    ('tax_invoice:read', 'ì„¸ê¸ˆê³„ì‚°ì„œ ì¡°íšŒ', 'tax'),
    ('tax_invoice:issue', 'ì„¸ê¸ˆê³„ì‚°ì„œ ë°œí–‰', 'tax'),
    ('tax_invoice:cancel', 'ì„¸ê¸ˆê³„ì‚°ì„œ ì·¨ì†Œ', 'tax'),
    -- ì¸ì‚¬/ê¸‰ì—¬
    ('employee:create', 'ì§ì› ìƒì„±', 'hr'),
    ('employee:read', 'ì§ì› ì¡°íšŒ', 'hr'),
    ('employee:update', 'ì§ì› ìˆ˜ì •', 'hr'),
    ('payroll:read', 'ê¸‰ì—¬ ì¡°íšŒ', 'hr'),
    ('payroll:calculate', 'ê¸‰ì—¬ ê³„ì‚°', 'hr'),
    ('payroll:confirm', 'ê¸‰ì—¬ í™•ì •', 'hr'),
    -- ì¬ê³ 
    ('inventory:read', 'ì¬ê³  ì¡°íšŒ', 'inventory'),
    ('inventory:adjust', 'ì¬ê³  ì¡°ì •', 'inventory'),
    -- ê´€ë¦¬
    ('admin:users', 'ì‚¬ìš©ì ê´€ë¦¬', 'admin'),
    ('admin:roles', 'ì—­í•  ê´€ë¦¬', 'admin'),
    ('admin:settings', 'ì„¤ì • ê´€ë¦¬', 'admin');
```

### 2.4 ê³„ì •ê³¼ëª© (accounts)

```sql
-- db/migrations/000020_create_accounts.up.sql

CREATE TABLE accounts (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    company_id UUID NOT NULL REFERENCES companies(id),

    -- ê³„ì • ì •ë³´
    code VARCHAR(10) NOT NULL,
    name VARCHAR(100) NOT NULL,
    name_en VARCHAR(100),

    -- ê³„ì¸µ êµ¬ì¡°
    parent_id UUID REFERENCES accounts(id),
    level INTEGER NOT NULL DEFAULT 1 CHECK (level BETWEEN 1 AND 5),
    path LTREE,  -- ê³„ì¸µ ê²½ë¡œ (ì˜ˆ: 1.11.1101)

    -- ë¶„ë¥˜
    account_type VARCHAR(20) NOT NULL CHECK (account_type IN (
        'ASSET',      -- ìì‚°
        'LIABILITY',  -- ë¶€ì±„
        'EQUITY',     -- ìë³¸
        'REVENUE',    -- ìˆ˜ìµ
        'EXPENSE'     -- ë¹„ìš©
    )),
    account_nature VARCHAR(10) NOT NULL CHECK (account_nature IN ('DEBIT', 'CREDIT')),

    -- ì†ì„±
    is_control_account BOOLEAN DEFAULT FALSE,  -- í†µì œê³„ì • (ê±°ë˜ì²˜ì›ì¥ ì—°ë™)
    is_cash_account BOOLEAN DEFAULT FALSE,     -- í˜„ê¸ˆì„± ê³„ì •
    is_bank_account BOOLEAN DEFAULT FALSE,     -- ì€í–‰ ê³„ì •
    is_tax_account BOOLEAN DEFAULT FALSE,      -- ì„¸ê¸ˆ ê´€ë ¨ ê³„ì •

    -- ì„¤ì •
    is_active BOOLEAN DEFAULT TRUE,
    is_system BOOLEAN DEFAULT FALSE,           -- ì‹œìŠ¤í…œ ê¸°ë³¸ ê³„ì •

    -- ê°ì‚¬
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP WITH TIME ZONE,

    -- ì œì•½ì¡°ê±´
    CONSTRAINT uk_accounts_company_code UNIQUE (company_id, code)
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_accounts_company_id ON accounts(company_id);
CREATE INDEX idx_accounts_parent_id ON accounts(parent_id);
CREATE INDEX idx_accounts_type ON accounts(account_type);
CREATE INDEX idx_accounts_path ON accounts USING gist(path);
CREATE INDEX idx_accounts_code_pattern ON accounts(code varchar_pattern_ops);

-- RLS
SELECT enable_rls_for_table('accounts');

-- íŠ¸ë¦¬ê±°
CREATE TRIGGER tr_accounts_updated_at
    BEFORE UPDATE ON accounts
    FOR EACH ROW
    EXECUTE FUNCTION update_updated_at();

COMMENT ON TABLE accounts IS 'ê³„ì •ê³¼ëª©';
COMMENT ON COLUMN accounts.account_nature IS 'ê³„ì • ì„±ê²© (ì°¨ë³€/ëŒ€ë³€ ì¦ê°€)';
COMMENT ON COLUMN accounts.path IS 'LTREE ê³„ì¸µ ê²½ë¡œ';
```

### 2.5 ê±°ë˜ì²˜ (partners)

```sql
-- db/migrations/000021_create_partners.up.sql

CREATE TABLE partners (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    company_id UUID NOT NULL REFERENCES companies(id),

    -- ê¸°ë³¸ ì •ë³´
    code VARCHAR(20) NOT NULL,
    name VARCHAR(100) NOT NULL,
    name_short VARCHAR(50),

    -- ê±°ë˜ì²˜ ìœ í˜•
    partner_type VARCHAR(20) NOT NULL CHECK (partner_type IN (
        'CUSTOMER',   -- ê³ ê°
        'VENDOR',     -- ê³µê¸‰ì—…ì²´
        'BOTH'        -- ë‘˜ ë‹¤
    )),

    -- ì‚¬ì—…ì ì •ë³´
    business_number VARCHAR(10),
    corp_number VARCHAR(13),
    ceo_name VARCHAR(50),
    business_type VARCHAR(100),
    business_class VARCHAR(100),

    -- ì—°ë½ì²˜
    address VARCHAR(200),
    phone VARCHAR(20),
    fax VARCHAR(20),
    email VARCHAR(100),
    contact_name VARCHAR(50),
    contact_phone VARCHAR(20),

    -- ê±°ë˜ ì¡°ê±´
    payment_terms INTEGER DEFAULT 0,  -- ê²°ì œ ì¡°ê±´ (ì¼ìˆ˜)
    credit_limit DECIMAL(18, 2),      -- ì—¬ì‹  í•œë„

    -- ê³„ì • ì—°ê²°
    ar_account_id UUID REFERENCES accounts(id),  -- ì™¸ìƒë§¤ì¶œê¸ˆ ê³„ì •
    ap_account_id UUID REFERENCES accounts(id),  -- ì™¸ìƒë§¤ì…ê¸ˆ ê³„ì •

    -- ìƒíƒœ
    is_active BOOLEAN DEFAULT TRUE,

    -- ê°ì‚¬
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP WITH TIME ZONE,

    CONSTRAINT uk_partners_company_code UNIQUE (company_id, code)
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_partners_company_id ON partners(company_id);
CREATE INDEX idx_partners_type ON partners(partner_type);
CREATE INDEX idx_partners_business_number ON partners(business_number);
CREATE INDEX idx_partners_name_trgm ON partners USING gin (name gin_trgm_ops);

-- RLS
SELECT enable_rls_for_table('partners');

CREATE TRIGGER tr_partners_updated_at
    BEFORE UPDATE ON partners
    FOR EACH ROW
    EXECUTE FUNCTION update_updated_at();

COMMENT ON TABLE partners IS 'ê±°ë˜ì²˜ ì •ë³´';
```

---

## 3. íšŒê³„ í…Œì´ë¸”

### 3.1 ì „í‘œ (vouchers)

```sql
-- db/migrations/000030_create_vouchers.up.sql

CREATE TABLE vouchers (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    company_id UUID NOT NULL REFERENCES companies(id),

    -- ì „í‘œ ì •ë³´
    voucher_number VARCHAR(20) NOT NULL,
    voucher_date DATE NOT NULL,
    voucher_type VARCHAR(20) NOT NULL CHECK (voucher_type IN (
        'GENERAL',    -- ì¼ë°˜ì „í‘œ
        'SALES',      -- ë§¤ì¶œì „í‘œ
        'PURCHASE',   -- ë§¤ì…ì „í‘œ
        'RECEIPT',    -- ìˆ˜ê¸ˆì „í‘œ
        'PAYMENT',    -- ì§€ê¸‰ì „í‘œ
        'ADJUSTMENT'  -- ì¡°ì •ì „í‘œ
    )),

    -- ìƒíƒœ
    status VARCHAR(20) NOT NULL DEFAULT 'DRAFT' CHECK (status IN (
        'DRAFT',      -- ì´ˆì•ˆ
        'PENDING',    -- ìŠ¹ì¸ëŒ€ê¸°
        'APPROVED',   -- ìŠ¹ì¸ë¨
        'REJECTED',   -- ë°˜ë ¤ë¨
        'POSTED'      -- ê¸°ì¥ë¨
    )),

    -- ë‚´ìš©
    description TEXT,
    reference_number VARCHAR(50),  -- ì°¸ì¡°ë²ˆí˜¸ (ì™¸ë¶€ ë¬¸ì„œë²ˆí˜¸)

    -- ê¸ˆì•¡ í•©ê³„ (ì„±ëŠ¥ ìµœì í™”ìš©)
    total_debit DECIMAL(18, 2) NOT NULL DEFAULT 0,
    total_credit DECIMAL(18, 2) NOT NULL DEFAULT 0,

    -- ê²°ì¬
    created_by UUID REFERENCES users(id),
    approved_by UUID REFERENCES users(id),
    approved_at TIMESTAMP WITH TIME ZONE,
    rejection_reason TEXT,

    -- ê¸°ì¥
    posted_at TIMESTAMP WITH TIME ZONE,
    posted_by UUID REFERENCES users(id),

    -- ê°ì‚¬
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP WITH TIME ZONE,

    CONSTRAINT uk_vouchers_company_number UNIQUE (company_id, voucher_number),
    CONSTRAINT ck_vouchers_balance CHECK (total_debit = total_credit)
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_vouchers_company_id ON vouchers(company_id);
CREATE INDEX idx_vouchers_date ON vouchers(voucher_date);
CREATE INDEX idx_vouchers_type ON vouchers(voucher_type);
CREATE INDEX idx_vouchers_status ON vouchers(status);
CREATE INDEX idx_vouchers_company_date ON vouchers(company_id, voucher_date);
CREATE INDEX idx_vouchers_created_by ON vouchers(created_by);

-- ë³µí•© ì¸ë±ìŠ¤ (ì¡°íšŒ ìµœì í™”)
CREATE INDEX idx_vouchers_company_status_date ON vouchers(company_id, status, voucher_date DESC)
    WHERE deleted_at IS NULL;

-- RLS
SELECT enable_rls_for_table('vouchers');

CREATE TRIGGER tr_vouchers_updated_at
    BEFORE UPDATE ON vouchers
    FOR EACH ROW
    EXECUTE FUNCTION update_updated_at();

COMMENT ON TABLE vouchers IS 'ì „í‘œ í—¤ë”';
COMMENT ON COLUMN vouchers.total_debit IS 'ì°¨ë³€ í•©ê³„ (ì„±ëŠ¥ ìµœì í™”)';
```

### 3.2 ì „í‘œ ìƒì„¸ (voucher_lines)

```sql
-- db/migrations/000031_create_voucher_lines.up.sql

CREATE TABLE voucher_lines (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    company_id UUID NOT NULL REFERENCES companies(id),
    voucher_id UUID NOT NULL REFERENCES vouchers(id) ON DELETE CASCADE,

    -- ë¼ì¸ ì •ë³´
    line_number INTEGER NOT NULL,

    -- ê³„ì •
    account_id UUID NOT NULL REFERENCES accounts(id),
    account_code VARCHAR(10) NOT NULL,  -- ë¹„ì •ê·œí™” (ì¡°íšŒ ì„±ëŠ¥)

    -- ê¸ˆì•¡
    debit_amount DECIMAL(18, 2) NOT NULL DEFAULT 0 CHECK (debit_amount >= 0),
    credit_amount DECIMAL(18, 2) NOT NULL DEFAULT 0 CHECK (credit_amount >= 0),

    -- ë¶€ê°€ ì •ë³´
    description VARCHAR(200),
    partner_id UUID REFERENCES partners(id),
    cost_center_id UUID,  -- ì½”ìŠ¤íŠ¸ì„¼í„° (ë³„ë„ í…Œì´ë¸”)
    project_id UUID,      -- í”„ë¡œì íŠ¸ (ë³„ë„ í…Œì´ë¸”)

    -- ì™¸í™”
    currency_code VARCHAR(3) DEFAULT 'KRW',
    exchange_rate DECIMAL(18, 6) DEFAULT 1,
    foreign_debit DECIMAL(18, 2),
    foreign_credit DECIMAL(18, 2),

    -- ê°ì‚¬
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,

    -- ì œì•½ì¡°ê±´: ì°¨ë³€/ëŒ€ë³€ ì¤‘ í•˜ë‚˜ë§Œ
    CONSTRAINT ck_voucher_lines_amount CHECK (
        (debit_amount > 0 AND credit_amount = 0) OR
        (debit_amount = 0 AND credit_amount > 0) OR
        (debit_amount = 0 AND credit_amount = 0)
    ),
    CONSTRAINT uk_voucher_lines_voucher_line UNIQUE (voucher_id, line_number)
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_voucher_lines_company_id ON voucher_lines(company_id);
CREATE INDEX idx_voucher_lines_voucher_id ON voucher_lines(voucher_id);
CREATE INDEX idx_voucher_lines_account_id ON voucher_lines(account_id);
CREATE INDEX idx_voucher_lines_partner_id ON voucher_lines(partner_id);
CREATE INDEX idx_voucher_lines_account_code ON voucher_lines(account_code);

-- RLS
SELECT enable_rls_for_table('voucher_lines');

COMMENT ON TABLE voucher_lines IS 'ì „í‘œ ìƒì„¸ ë¼ì¸';
```

### 3.3 ì›ì¥ (ledger_entries)

```sql
-- db/migrations/000032_create_ledger_entries.up.sql

-- ì´ê³„ì •ì›ì¥ (ê¸°ì¥ëœ ì „í‘œì—ì„œ ìƒì„±)
CREATE TABLE ledger_entries (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    company_id UUID NOT NULL REFERENCES companies(id),

    -- ì›ì¥ ì •ë³´
    fiscal_year INTEGER NOT NULL,
    fiscal_period INTEGER NOT NULL,  -- ì›” (1-12)
    entry_date DATE NOT NULL,

    -- ì „í‘œ ì°¸ì¡°
    voucher_id UUID NOT NULL REFERENCES vouchers(id),
    voucher_line_id UUID NOT NULL REFERENCES voucher_lines(id),
    voucher_number VARCHAR(20) NOT NULL,

    -- ê³„ì •
    account_id UUID NOT NULL REFERENCES accounts(id),
    account_code VARCHAR(10) NOT NULL,

    -- ê¸ˆì•¡
    debit_amount DECIMAL(18, 2) NOT NULL DEFAULT 0,
    credit_amount DECIMAL(18, 2) NOT NULL DEFAULT 0,

    -- ì”ì•¡ (ëˆ„ì )
    running_balance DECIMAL(18, 2) NOT NULL DEFAULT 0,

    -- ë¶€ê°€ ì •ë³´
    description VARCHAR(200),
    partner_id UUID REFERENCES partners(id),

    -- ê°ì‚¬
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
) PARTITION BY RANGE (fiscal_year);

-- ì—°ë„ë³„ íŒŒí‹°ì…˜ ìƒì„±
CREATE TABLE ledger_entries_2024 PARTITION OF ledger_entries
    FOR VALUES FROM (2024) TO (2025);

CREATE TABLE ledger_entries_2025 PARTITION OF ledger_entries
    FOR VALUES FROM (2025) TO (2026);

CREATE TABLE ledger_entries_2026 PARTITION OF ledger_entries
    FOR VALUES FROM (2026) TO (2027);

-- ì¸ë±ìŠ¤ (íŒŒí‹°ì…˜ë³„ë¡œ ìƒì„±ë¨)
CREATE INDEX idx_ledger_company_account ON ledger_entries(company_id, account_code);
CREATE INDEX idx_ledger_company_date ON ledger_entries(company_id, entry_date);
CREATE INDEX idx_ledger_voucher ON ledger_entries(voucher_id);
CREATE INDEX idx_ledger_account_date ON ledger_entries(account_id, entry_date);

-- RLS
ALTER TABLE ledger_entries ENABLE ROW LEVEL SECURITY;
CREATE POLICY tenant_isolation ON ledger_entries
    FOR ALL
    USING (company_id = current_tenant_id())
    WITH CHECK (company_id = current_tenant_id());

COMMENT ON TABLE ledger_entries IS 'ì´ê³„ì •ì›ì¥ (ì—°ë„ë³„ íŒŒí‹°ì…˜)';
```

### 3.4 ê³„ì • ì”ì•¡ (account_balances)

```sql
-- db/migrations/000033_create_account_balances.up.sql

-- ê³„ì •ë³„ ì”ì•¡ ì§‘ê³„ (ì„±ëŠ¥ ìµœì í™”ìš©)
CREATE TABLE account_balances (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    company_id UUID NOT NULL REFERENCES companies(id),

    -- ê¸°ê°„
    fiscal_year INTEGER NOT NULL,
    fiscal_period INTEGER NOT NULL,  -- 0: ì´ì›”, 1-12: ì›”ë³„

    -- ê³„ì •
    account_id UUID NOT NULL REFERENCES accounts(id),
    account_code VARCHAR(10) NOT NULL,

    -- ê¸ˆì•¡
    opening_debit DECIMAL(18, 2) NOT NULL DEFAULT 0,   -- ê¸°ì´ˆ ì°¨ë³€
    opening_credit DECIMAL(18, 2) NOT NULL DEFAULT 0,  -- ê¸°ì´ˆ ëŒ€ë³€
    period_debit DECIMAL(18, 2) NOT NULL DEFAULT 0,    -- ë‹¹ê¸° ì°¨ë³€
    period_credit DECIMAL(18, 2) NOT NULL DEFAULT 0,   -- ë‹¹ê¸° ëŒ€ë³€
    closing_debit DECIMAL(18, 2) NOT NULL DEFAULT 0,   -- ê¸°ë§ ì°¨ë³€
    closing_credit DECIMAL(18, 2) NOT NULL DEFAULT 0,  -- ê¸°ë§ ëŒ€ë³€

    -- ê°ì‚¬
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT uk_account_balances UNIQUE (company_id, fiscal_year, fiscal_period, account_id)
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_account_balances_company_year ON account_balances(company_id, fiscal_year);
CREATE INDEX idx_account_balances_account ON account_balances(account_id);

-- RLS
SELECT enable_rls_for_table('account_balances');

COMMENT ON TABLE account_balances IS 'ê³„ì •ë³„ ì”ì•¡ ì§‘ê³„';
```

---

## 4. ì„¸ê¸ˆê³„ì‚°ì„œ í…Œì´ë¸”

### 4.1 ì„¸ê¸ˆê³„ì‚°ì„œ (tax_invoices)

```sql
-- db/migrations/000040_create_tax_invoices.up.sql

CREATE TABLE tax_invoices (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    company_id UUID NOT NULL REFERENCES companies(id),

    -- ë¬¸ì„œ ì •ë³´
    mgt_key VARCHAR(24) NOT NULL,  -- ê´€ë¦¬ë²ˆí˜¸ (Popbill)
    issue_type VARCHAR(10) NOT NULL CHECK (issue_type IN ('ISSUED', 'RECEIVED')),
    invoice_type VARCHAR(20) NOT NULL CHECK (invoice_type IN (
        'TAX',       -- ì„¸ê¸ˆê³„ì‚°ì„œ
        'ZERO_TAX',  -- ì˜ì„¸ìœ¨
        'RECEIPT'    -- ê³„ì‚°ì„œ (ë©´ì„¸)
    )),

    -- ìƒíƒœ
    status VARCHAR(20) NOT NULL DEFAULT 'DRAFT' CHECK (status IN (
        'DRAFT',     -- ì„ì‹œì €ì¥
        'ISSUED',    -- ë°œí–‰ë¨
        'SENT',      -- ì „ì†¡ë¨
        'ACCEPTED',  -- ìŠ¹ì¸ë¨
        'REFUSED',   -- ê±°ë¶€ë¨
        'CANCELLED'  -- ì·¨ì†Œë¨
    )),

    -- ì¼ì
    invoice_date DATE NOT NULL,
    write_date DATE NOT NULL,

    -- ê³µê¸‰ì
    supplier_corp_num VARCHAR(10) NOT NULL,
    supplier_corp_name VARCHAR(100) NOT NULL,
    supplier_ceo_name VARCHAR(50),
    supplier_address VARCHAR(200),
    supplier_biz_type VARCHAR(100),
    supplier_biz_class VARCHAR(100),
    supplier_email VARCHAR(100),

    -- ê³µê¸‰ë°›ëŠ”ì
    buyer_corp_num VARCHAR(10) NOT NULL,
    buyer_corp_name VARCHAR(100) NOT NULL,
    buyer_ceo_name VARCHAR(50),
    buyer_address VARCHAR(200),
    buyer_biz_type VARCHAR(100),
    buyer_biz_class VARCHAR(100),
    buyer_email VARCHAR(100),

    -- ê¸ˆì•¡
    supply_value DECIMAL(18, 0) NOT NULL,  -- ê³µê¸‰ê°€ì•¡
    tax_amount DECIMAL(18, 0) NOT NULL,    -- ì„¸ì•¡
    total_amount DECIMAL(18, 0) NOT NULL,  -- í•©ê³„ê¸ˆì•¡

    -- êµ­ì„¸ì²­
    nts_confirm_num VARCHAR(24),           -- êµ­ì„¸ì²­ ìŠ¹ì¸ë²ˆí˜¸
    nts_result_code VARCHAR(10),
    nts_result_message TEXT,

    -- ë¹„ê³ 
    remark1 VARCHAR(150),
    remark2 VARCHAR(150),
    remark3 VARCHAR(150),

    -- ì—°ê²°
    voucher_id UUID REFERENCES vouchers(id),
    partner_id UUID REFERENCES partners(id),

    -- Popbill ì •ë³´
    popbill_state INTEGER,
    popbill_state_dt TIMESTAMP WITH TIME ZONE,

    -- ê°ì‚¬
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP WITH TIME ZONE,

    CONSTRAINT uk_tax_invoices_mgt_key UNIQUE (company_id, mgt_key)
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_tax_invoices_company_id ON tax_invoices(company_id);
CREATE INDEX idx_tax_invoices_date ON tax_invoices(invoice_date);
CREATE INDEX idx_tax_invoices_status ON tax_invoices(status);
CREATE INDEX idx_tax_invoices_buyer ON tax_invoices(buyer_corp_num);
CREATE INDEX idx_tax_invoices_supplier ON tax_invoices(supplier_corp_num);
CREATE INDEX idx_tax_invoices_company_date_status ON tax_invoices(company_id, invoice_date, status)
    WHERE deleted_at IS NULL;

-- RLS
SELECT enable_rls_for_table('tax_invoices');

CREATE TRIGGER tr_tax_invoices_updated_at
    BEFORE UPDATE ON tax_invoices
    FOR EACH ROW
    EXECUTE FUNCTION update_updated_at();

COMMENT ON TABLE tax_invoices IS 'ì„¸ê¸ˆê³„ì‚°ì„œ';
COMMENT ON COLUMN tax_invoices.mgt_key IS 'Popbill ê´€ë¦¬ë²ˆí˜¸ (ìœ ë‹ˆí¬)';
```

### 4.2 ì„¸ê¸ˆê³„ì‚°ì„œ í’ˆëª© (tax_invoice_items)

```sql
-- db/migrations/000041_create_tax_invoice_items.up.sql

CREATE TABLE tax_invoice_items (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    company_id UUID NOT NULL REFERENCES companies(id),
    tax_invoice_id UUID NOT NULL REFERENCES tax_invoices(id) ON DELETE CASCADE,

    -- í’ˆëª© ì •ë³´
    serial_num INTEGER NOT NULL CHECK (serial_num BETWEEN 1 AND 99),
    trade_date DATE,
    item_name VARCHAR(100) NOT NULL,
    spec VARCHAR(100),         -- ê·œê²©
    quantity DECIMAL(18, 2),
    unit_price DECIMAL(18, 2),
    supply_value DECIMAL(18, 0) NOT NULL,
    tax_amount DECIMAL(18, 0) NOT NULL DEFAULT 0,
    remark VARCHAR(100),

    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT uk_tax_invoice_items UNIQUE (tax_invoice_id, serial_num)
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_tax_invoice_items_invoice ON tax_invoice_items(tax_invoice_id);

-- RLS
SELECT enable_rls_for_table('tax_invoice_items');

COMMENT ON TABLE tax_invoice_items IS 'ì„¸ê¸ˆê³„ì‚°ì„œ í’ˆëª©';
```

---

## 5. ì¸ì‚¬/ê¸‰ì—¬ í…Œì´ë¸”

### 5.1 ì§ì› (employees)

```sql
-- db/migrations/000050_create_employees.up.sql

CREATE TABLE employees (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    company_id UUID NOT NULL REFERENCES companies(id),
    user_id UUID REFERENCES users(id),  -- ì‹œìŠ¤í…œ ì‚¬ìš©ì ì—°ê²° (ì„ íƒ)

    -- ê¸°ë³¸ ì •ë³´
    employee_number VARCHAR(20) NOT NULL,
    name VARCHAR(50) NOT NULL,
    name_en VARCHAR(50),
    resident_number_enc BYTEA,  -- ì•”í˜¸í™”ëœ ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸

    -- ì—°ë½ì²˜
    email VARCHAR(100),
    phone VARCHAR(20),
    mobile VARCHAR(20),
    address VARCHAR(200),

    -- ì¸ì‚¬ ì •ë³´
    department_id UUID,
    position VARCHAR(50),
    job_title VARCHAR(50),
    employment_type VARCHAR(20) CHECK (employment_type IN (
        'REGULAR',    -- ì •ê·œì§
        'CONTRACT',   -- ê³„ì•½ì§
        'PART_TIME',  -- íŒŒíŠ¸íƒ€ì„
        'INTERN',     -- ì¸í„´
        'EXECUTIVE'   -- ì„ì›
    )),

    -- ì…/í‡´ì‚¬
    join_date DATE NOT NULL,
    leave_date DATE,
    leave_reason VARCHAR(100),

    -- ê¸‰ì—¬
    base_salary DECIMAL(18, 2),
    bank_code VARCHAR(3),
    bank_account_enc BYTEA,  -- ì•”í˜¸í™”ëœ ê³„ì¢Œë²ˆí˜¸

    -- 4ëŒ€ë³´í—˜
    nps_number VARCHAR(20),        -- êµ­ë¯¼ì—°ê¸ˆ ë²ˆí˜¸
    nhi_number VARCHAR(20),        -- ê±´ê°•ë³´í—˜ ë²ˆí˜¸
    ei_number VARCHAR(20),         -- ê³ ìš©ë³´í—˜ ë²ˆí˜¸
    wci_number VARCHAR(20),        -- ì‚°ì¬ë³´í—˜ ë²ˆí˜¸
    nps_acquired_date DATE,
    nhi_acquired_date DATE,
    ei_acquired_date DATE,

    -- ìƒíƒœ
    status VARCHAR(20) DEFAULT 'ACTIVE' CHECK (status IN ('ACTIVE', 'ON_LEAVE', 'RESIGNED')),

    -- ê°ì‚¬
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP WITH TIME ZONE,

    CONSTRAINT uk_employees_company_number UNIQUE (company_id, employee_number)
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_employees_company_id ON employees(company_id);
CREATE INDEX idx_employees_department ON employees(department_id);
CREATE INDEX idx_employees_status ON employees(status) WHERE deleted_at IS NULL;
CREATE INDEX idx_employees_name_trgm ON employees USING gin (name gin_trgm_ops);

-- RLS
SELECT enable_rls_for_table('employees');

CREATE TRIGGER tr_employees_updated_at
    BEFORE UPDATE ON employees
    FOR EACH ROW
    EXECUTE FUNCTION update_updated_at();

COMMENT ON TABLE employees IS 'ì§ì› ì •ë³´';
COMMENT ON COLUMN employees.resident_number_enc IS 'ì•”í˜¸í™”ëœ ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ (AES-256-GCM)';
COMMENT ON COLUMN employees.bank_account_enc IS 'ì•”í˜¸í™”ëœ ê³„ì¢Œë²ˆí˜¸ (AES-256-GCM)';
```

### 5.2 ê¸‰ì—¬ ê¸°ê°„ (payroll_periods)

```sql
-- db/migrations/000051_create_payroll_periods.up.sql

CREATE TABLE payroll_periods (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    company_id UUID NOT NULL REFERENCES companies(id),

    -- ê¸°ê°„ ì •ë³´
    year INTEGER NOT NULL,
    month INTEGER NOT NULL CHECK (month BETWEEN 1 AND 12),
    pay_date DATE NOT NULL,

    -- ìƒíƒœ
    status VARCHAR(20) DEFAULT 'OPEN' CHECK (status IN (
        'OPEN',       -- ì—´ë¦¼
        'CALCULATED', -- ê³„ì‚°ë¨
        'CONFIRMED',  -- í™•ì •ë¨
        'PAID'        -- ì§€ê¸‰ì™„ë£Œ
    )),

    -- ì§‘ê³„
    employee_count INTEGER DEFAULT 0,
    total_gross DECIMAL(18, 2) DEFAULT 0,
    total_deductions DECIMAL(18, 2) DEFAULT 0,
    total_net DECIMAL(18, 2) DEFAULT 0,

    -- ì „í‘œ
    voucher_id UUID REFERENCES vouchers(id),

    -- ì²˜ë¦¬ ì´ë ¥
    calculated_at TIMESTAMP WITH TIME ZONE,
    calculated_by UUID REFERENCES users(id),
    confirmed_at TIMESTAMP WITH TIME ZONE,
    confirmed_by UUID REFERENCES users(id),

    -- ê°ì‚¬
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT uk_payroll_periods UNIQUE (company_id, year, month)
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_payroll_periods_company ON payroll_periods(company_id);
CREATE INDEX idx_payroll_periods_year_month ON payroll_periods(year, month);

-- RLS
SELECT enable_rls_for_table('payroll_periods');

COMMENT ON TABLE payroll_periods IS 'ê¸‰ì—¬ ê¸°ê°„';
```

### 5.3 ê¸‰ì—¬ ëª…ì„¸ (payslips)

```sql
-- db/migrations/000052_create_payslips.up.sql

CREATE TABLE payslips (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    company_id UUID NOT NULL REFERENCES companies(id),
    period_id UUID NOT NULL REFERENCES payroll_periods(id),
    employee_id UUID NOT NULL REFERENCES employees(id),

    -- ì§€ê¸‰ í•©ê³„
    gross_salary DECIMAL(18, 2) NOT NULL DEFAULT 0,

    -- ê³µì œ í•©ê³„
    total_deductions DECIMAL(18, 2) NOT NULL DEFAULT 0,

    -- ì‹¤ì§€ê¸‰ì•¡
    net_salary DECIMAL(18, 2) NOT NULL DEFAULT 0,

    -- ê³¼ì„¸ ì •ë³´
    taxable_income DECIMAL(18, 2) DEFAULT 0,
    non_taxable_income DECIMAL(18, 2) DEFAULT 0,

    -- 4ëŒ€ë³´í—˜ (ì§ì› ë¶€ë‹´ë¶„)
    nps_employee DECIMAL(18, 2) DEFAULT 0,   -- êµ­ë¯¼ì—°ê¸ˆ
    nhi_employee DECIMAL(18, 2) DEFAULT 0,   -- ê±´ê°•ë³´í—˜
    ltc_employee DECIMAL(18, 2) DEFAULT 0,   -- ì¥ê¸°ìš”ì–‘
    ei_employee DECIMAL(18, 2) DEFAULT 0,    -- ê³ ìš©ë³´í—˜

    -- 4ëŒ€ë³´í—˜ (íšŒì‚¬ ë¶€ë‹´ë¶„)
    nps_employer DECIMAL(18, 2) DEFAULT 0,
    nhi_employer DECIMAL(18, 2) DEFAULT 0,
    ltc_employer DECIMAL(18, 2) DEFAULT 0,
    ei_employer DECIMAL(18, 2) DEFAULT 0,
    wci_employer DECIMAL(18, 2) DEFAULT 0,   -- ì‚°ì¬ë³´í—˜

    -- ì†Œë“ì„¸
    income_tax DECIMAL(18, 2) DEFAULT 0,
    local_income_tax DECIMAL(18, 2) DEFAULT 0,

    -- ê°ì‚¬
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT uk_payslips UNIQUE (period_id, employee_id)
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_payslips_company_id ON payslips(company_id);
CREATE INDEX idx_payslips_period_id ON payslips(period_id);
CREATE INDEX idx_payslips_employee_id ON payslips(employee_id);

-- RLS
SELECT enable_rls_for_table('payslips');

COMMENT ON TABLE payslips IS 'ê¸‰ì—¬ ëª…ì„¸ì„œ';
```

### 5.4 ê¸‰ì—¬ í•­ëª© ìƒì„¸ (payslip_items)

```sql
-- db/migrations/000053_create_payslip_items.up.sql

CREATE TABLE payslip_items (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    company_id UUID NOT NULL REFERENCES companies(id),
    payslip_id UUID NOT NULL REFERENCES payslips(id) ON DELETE CASCADE,

    -- í•­ëª© ì •ë³´
    item_type VARCHAR(10) NOT NULL CHECK (item_type IN ('EARNING', 'DEDUCTION')),
    item_code VARCHAR(20) NOT NULL,
    item_name VARCHAR(50) NOT NULL,
    amount DECIMAL(18, 2) NOT NULL,

    -- ê³¼ì„¸ ì—¬ë¶€
    is_taxable BOOLEAN DEFAULT TRUE,

    -- ì •ë ¬
    display_order INTEGER DEFAULT 0,

    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_payslip_items_payslip ON payslip_items(payslip_id);
CREATE INDEX idx_payslip_items_type ON payslip_items(item_type);

-- RLS
SELECT enable_rls_for_table('payslip_items');

COMMENT ON TABLE payslip_items IS 'ê¸‰ì—¬ ëª…ì„¸ í•­ëª©';
```

---

## 6. ì¬ê³  í…Œì´ë¸”

### 6.1 í’ˆëª© (items)

```sql
-- db/migrations/000060_create_items.up.sql

CREATE TABLE items (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    company_id UUID NOT NULL REFERENCES companies(id),

    -- ê¸°ë³¸ ì •ë³´
    code VARCHAR(30) NOT NULL,
    name VARCHAR(100) NOT NULL,
    name_en VARCHAR(100),
    spec VARCHAR(100),       -- ê·œê²©
    unit VARCHAR(20),        -- ë‹¨ìœ„

    -- ë¶„ë¥˜
    category_id UUID,
    item_type VARCHAR(20) CHECK (item_type IN (
        'PRODUCT',    -- ì œí’ˆ
        'MATERIAL',   -- ì›ìì¬
        'GOODS',      -- ìƒí’ˆ
        'SUPPLIES',   -- ì†Œëª¨í’ˆ
        'ASSET'       -- ìì‚°
    )),

    -- ê°€ê²©
    standard_cost DECIMAL(18, 2),     -- í‘œì¤€ì›ê°€
    selling_price DECIMAL(18, 2),     -- íŒë§¤ê°€
    purchase_price DECIMAL(18, 2),    -- ë§¤ì…ê°€

    -- ì¬ê³  ì„¤ì •
    is_inventory_managed BOOLEAN DEFAULT TRUE,
    safety_stock DECIMAL(18, 2),      -- ì•ˆì „ì¬ê³ 
    reorder_point DECIMAL(18, 2),     -- ì¬ì£¼ë¬¸ì 
    lot_managed BOOLEAN DEFAULT FALSE,
    serial_managed BOOLEAN DEFAULT FALSE,

    -- ê³„ì • ì—°ê²°
    inventory_account_id UUID REFERENCES accounts(id),
    cogs_account_id UUID REFERENCES accounts(id),
    sales_account_id UUID REFERENCES accounts(id),

    -- ë°”ì½”ë“œ
    barcode VARCHAR(50),
    barcode_type VARCHAR(20),

    -- ìƒíƒœ
    is_active BOOLEAN DEFAULT TRUE,
    is_purchasable BOOLEAN DEFAULT TRUE,
    is_sellable BOOLEAN DEFAULT TRUE,

    -- ê°ì‚¬
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP WITH TIME ZONE,

    CONSTRAINT uk_items_company_code UNIQUE (company_id, code)
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_items_company_id ON items(company_id);
CREATE INDEX idx_items_category ON items(category_id);
CREATE INDEX idx_items_type ON items(item_type);
CREATE INDEX idx_items_barcode ON items(barcode);
CREATE INDEX idx_items_name_trgm ON items USING gin (name gin_trgm_ops);

-- RLS
SELECT enable_rls_for_table('items');

CREATE TRIGGER tr_items_updated_at
    BEFORE UPDATE ON items
    FOR EACH ROW
    EXECUTE FUNCTION update_updated_at();

COMMENT ON TABLE items IS 'í’ˆëª© ë§ˆìŠ¤í„°';
```

### 6.2 ì°½ê³  (warehouses)

```sql
-- db/migrations/000061_create_warehouses.up.sql

CREATE TABLE warehouses (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    company_id UUID NOT NULL REFERENCES companies(id),

    code VARCHAR(20) NOT NULL,
    name VARCHAR(100) NOT NULL,
    address VARCHAR(200),
    manager_id UUID REFERENCES employees(id),

    is_default BOOLEAN DEFAULT FALSE,
    is_active BOOLEAN DEFAULT TRUE,

    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP WITH TIME ZONE,

    CONSTRAINT uk_warehouses_company_code UNIQUE (company_id, code)
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_warehouses_company_id ON warehouses(company_id);

-- RLS
SELECT enable_rls_for_table('warehouses');

COMMENT ON TABLE warehouses IS 'ì°½ê³ ';
```

### 6.3 ì¬ê³  (inventory_stocks)

```sql
-- db/migrations/000062_create_inventory_stocks.up.sql

CREATE TABLE inventory_stocks (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    company_id UUID NOT NULL REFERENCES companies(id),

    item_id UUID NOT NULL REFERENCES items(id),
    warehouse_id UUID NOT NULL REFERENCES warehouses(id),

    -- ìˆ˜ëŸ‰
    quantity DECIMAL(18, 4) NOT NULL DEFAULT 0,
    reserved_quantity DECIMAL(18, 4) NOT NULL DEFAULT 0,  -- ì˜ˆì•½ ìˆ˜ëŸ‰
    available_quantity DECIMAL(18, 4) GENERATED ALWAYS AS (quantity - reserved_quantity) STORED,

    -- ê¸ˆì•¡
    unit_cost DECIMAL(18, 4),
    total_cost DECIMAL(18, 2) GENERATED ALWAYS AS (quantity * unit_cost) STORED,

    -- ê°ì‚¬
    last_stock_date DATE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT uk_inventory_stocks UNIQUE (company_id, item_id, warehouse_id),
    CONSTRAINT ck_inventory_positive CHECK (quantity >= 0)
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_inventory_stocks_company ON inventory_stocks(company_id);
CREATE INDEX idx_inventory_stocks_item ON inventory_stocks(item_id);
CREATE INDEX idx_inventory_stocks_warehouse ON inventory_stocks(warehouse_id);

-- RLS
SELECT enable_rls_for_table('inventory_stocks');

CREATE TRIGGER tr_inventory_stocks_updated_at
    BEFORE UPDATE ON inventory_stocks
    FOR EACH ROW
    EXECUTE FUNCTION update_updated_at();

COMMENT ON TABLE inventory_stocks IS 'ì¬ê³  í˜„í™©';
COMMENT ON COLUMN inventory_stocks.available_quantity IS 'ê°€ìš© ìˆ˜ëŸ‰ (ìˆ˜ëŸ‰ - ì˜ˆì•½)';
```

### 6.4 ì¬ê³  ì´ë™ (inventory_transactions)

```sql
-- db/migrations/000063_create_inventory_transactions.up.sql

CREATE TABLE inventory_transactions (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    company_id UUID NOT NULL REFERENCES companies(id),

    -- ê±°ë˜ ì •ë³´
    transaction_date DATE NOT NULL,
    transaction_type VARCHAR(20) NOT NULL CHECK (transaction_type IN (
        'RECEIPT',     -- ì…ê³ 
        'ISSUE',       -- ì¶œê³ 
        'TRANSFER',    -- ì´ë™
        'ADJUSTMENT',  -- ì¡°ì •
        'RETURN'       -- ë°˜í’ˆ
    )),
    reference_type VARCHAR(20),  -- ì°¸ì¡° ë¬¸ì„œ ìœ í˜•
    reference_id UUID,           -- ì°¸ì¡° ë¬¸ì„œ ID

    -- í’ˆëª©/ì°½ê³ 
    item_id UUID NOT NULL REFERENCES items(id),
    from_warehouse_id UUID REFERENCES warehouses(id),
    to_warehouse_id UUID REFERENCES warehouses(id),

    -- ìˆ˜ëŸ‰/ê¸ˆì•¡
    quantity DECIMAL(18, 4) NOT NULL,
    unit_cost DECIMAL(18, 4),
    total_cost DECIMAL(18, 2),

    -- ì´ë ¥
    before_quantity DECIMAL(18, 4),
    after_quantity DECIMAL(18, 4),

    -- ë¹„ê³ 
    description TEXT,

    -- ê°ì‚¬
    created_by UUID REFERENCES users(id),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
) PARTITION BY RANGE (transaction_date);

-- ì›”ë³„ íŒŒí‹°ì…˜ (ìµœê·¼ 3ë…„)
CREATE TABLE inventory_transactions_2024 PARTITION OF inventory_transactions
    FOR VALUES FROM ('2024-01-01') TO ('2025-01-01');

CREATE TABLE inventory_transactions_2025 PARTITION OF inventory_transactions
    FOR VALUES FROM ('2025-01-01') TO ('2026-01-01');

CREATE TABLE inventory_transactions_2026 PARTITION OF inventory_transactions
    FOR VALUES FROM ('2026-01-01') TO ('2027-01-01');

-- ì¸ë±ìŠ¤
CREATE INDEX idx_inv_trans_company ON inventory_transactions(company_id);
CREATE INDEX idx_inv_trans_item ON inventory_transactions(item_id);
CREATE INDEX idx_inv_trans_date ON inventory_transactions(transaction_date);
CREATE INDEX idx_inv_trans_type ON inventory_transactions(transaction_type);

-- RLS
ALTER TABLE inventory_transactions ENABLE ROW LEVEL SECURITY;
CREATE POLICY tenant_isolation ON inventory_transactions
    FOR ALL
    USING (company_id = current_tenant_id())
    WITH CHECK (company_id = current_tenant_id());

COMMENT ON TABLE inventory_transactions IS 'ì¬ê³  ì´ë™ ì´ë ¥';
```

---

## 7. ê°ì‚¬ ë¡œê·¸ í…Œì´ë¸”

```sql
-- db/migrations/000070_create_audit_logs.up.sql

CREATE TABLE audit_logs (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    company_id UUID REFERENCES companies(id),

    -- ì´ë²¤íŠ¸ ì •ë³´
    event_type VARCHAR(50) NOT NULL,  -- CREATE, UPDATE, DELETE, LOGIN, etc.
    event_time TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,

    -- ëŒ€ìƒ
    entity_type VARCHAR(50) NOT NULL,  -- voucher, employee, etc.
    entity_id UUID,
    entity_name VARCHAR(200),

    -- ì‚¬ìš©ì
    user_id UUID REFERENCES users(id),
    user_email VARCHAR(100),
    user_name VARCHAR(50),

    -- ë³€ê²½ ë‚´ìš©
    old_values JSONB,
    new_values JSONB,
    changed_fields TEXT[],

    -- ìš”ì²­ ì •ë³´
    ip_address INET,
    user_agent TEXT,
    request_id VARCHAR(50),

    -- ê²°ê³¼
    success BOOLEAN DEFAULT TRUE,
    error_message TEXT
) PARTITION BY RANGE (event_time);

-- ì›”ë³„ íŒŒí‹°ì…˜
CREATE TABLE audit_logs_2024_01 PARTITION OF audit_logs
    FOR VALUES FROM ('2024-01-01') TO ('2024-02-01');
-- ... (ê° ì›”ë³„ë¡œ ìƒì„±)

-- ì¸ë±ìŠ¤
CREATE INDEX idx_audit_logs_company ON audit_logs(company_id);
CREATE INDEX idx_audit_logs_user ON audit_logs(user_id);
CREATE INDEX idx_audit_logs_entity ON audit_logs(entity_type, entity_id);
CREATE INDEX idx_audit_logs_time ON audit_logs(event_time);
CREATE INDEX idx_audit_logs_type ON audit_logs(event_type);

-- RLS ì—†ìŒ (ê°ì‚¬ ë¡œê·¸ëŠ” ì „ì²´ ì¡°íšŒ ê°€ëŠ¥í•´ì•¼ í•¨, ê´€ë¦¬ìë§Œ ì ‘ê·¼)

-- ìë™ íŒŒí‹°ì…˜ ìƒì„± í•¨ìˆ˜
CREATE OR REPLACE FUNCTION create_audit_partition()
RETURNS VOID AS $$
DECLARE
    partition_date DATE := DATE_TRUNC('month', CURRENT_DATE + INTERVAL '1 month');
    partition_name TEXT := 'audit_logs_' || TO_CHAR(partition_date, 'YYYY_MM');
    start_date DATE := partition_date;
    end_date DATE := partition_date + INTERVAL '1 month';
BEGIN
    EXECUTE format(
        'CREATE TABLE IF NOT EXISTS %I PARTITION OF audit_logs
         FOR VALUES FROM (%L) TO (%L)',
        partition_name, start_date, end_date
    );
END;
$$ LANGUAGE plpgsql;

COMMENT ON TABLE audit_logs IS 'ê°ì‚¬ ë¡œê·¸ (ì›”ë³„ íŒŒí‹°ì…˜)';
```

---

## 8. GORM ëª¨ë¸ ì •ì˜

```go
// internal/domain/models.go
package domain

import (
    "time"

    "github.com/google/uuid"
    "gorm.io/gorm"
)

// BaseModel ê³µí†µ ëª¨ë¸ í•„ë“œ
type BaseModel struct {
    ID        uuid.UUID      `gorm:"type:uuid;primary_key;default:uuid_generate_v4()"`
    CompanyID uuid.UUID      `gorm:"type:uuid;not null;index"`
    CreatedAt time.Time      `gorm:"autoCreateTime"`
    UpdatedAt time.Time      `gorm:"autoUpdateTime"`
    DeletedAt gorm.DeletedAt `gorm:"index"`
}

// Company íšŒì‚¬
type Company struct {
    ID             uuid.UUID      `gorm:"type:uuid;primary_key;default:uuid_generate_v4()"`
    Code           string         `gorm:"size:20;not null;uniqueIndex"`
    Name           string         `gorm:"size:100;not null"`
    BusinessNumber string         `gorm:"size:10;not null;uniqueIndex"`
    CEOName        string         `gorm:"column:ceo_name;size:50;not null"`
    Address        string         `gorm:"size:200"`
    Phone          string         `gorm:"size:20"`
    Email          string         `gorm:"size:100"`
    Status         string         `gorm:"size:20;default:'ACTIVE'"`
    CreatedAt      time.Time      `gorm:"autoCreateTime"`
    UpdatedAt      time.Time      `gorm:"autoUpdateTime"`
    DeletedAt      gorm.DeletedAt `gorm:"index"`
}

func (Company) TableName() string {
    return "companies"
}

// User ì‚¬ìš©ì
type User struct {
    BaseModel
    Email        string     `gorm:"size:100;not null;uniqueIndex"`
    PasswordHash string     `gorm:"size:255;not null"`
    Name         string     `gorm:"size:50;not null"`
    Phone        string     `gorm:"size:20"`
    Department   string     `gorm:"size:50"`
    Position     string     `gorm:"size:50"`
    Status       string     `gorm:"size:20;default:'ACTIVE'"`
    MFAEnabled   bool       `gorm:"column:mfa_enabled;default:false"`
    LastLoginAt  *time.Time `gorm:"column:last_login_at"`

    // Relations
    Company *Company `gorm:"foreignKey:CompanyID"`
    Roles   []Role   `gorm:"many2many:user_roles;"`
}

func (User) TableName() string {
    return "users"
}

// Account ê³„ì •ê³¼ëª©
type Account struct {
    BaseModel
    Code          string  `gorm:"size:10;not null"`
    Name          string  `gorm:"size:100;not null"`
    ParentID      *uuid.UUID `gorm:"type:uuid"`
    Level         int     `gorm:"not null;default:1"`
    AccountType   string  `gorm:"size:20;not null"`
    AccountNature string  `gorm:"size:10;not null"`
    IsActive      bool    `gorm:"default:true"`
    IsSystem      bool    `gorm:"default:false"`

    // Relations
    Parent   *Account  `gorm:"foreignKey:ParentID"`
    Children []Account `gorm:"foreignKey:ParentID"`
}

func (Account) TableName() string {
    return "accounts"
}

// Voucher ì „í‘œ
type Voucher struct {
    BaseModel
    VoucherNumber string    `gorm:"size:20;not null"`
    VoucherDate   time.Time `gorm:"type:date;not null"`
    VoucherType   string    `gorm:"size:20;not null"`
    Status        string    `gorm:"size:20;not null;default:'DRAFT'"`
    Description   string    `gorm:"type:text"`
    TotalDebit    float64   `gorm:"type:decimal(18,2);not null;default:0"`
    TotalCredit   float64   `gorm:"type:decimal(18,2);not null;default:0"`
    CreatedBy     uuid.UUID `gorm:"type:uuid"`
    ApprovedBy    *uuid.UUID `gorm:"type:uuid"`
    ApprovedAt    *time.Time
    PostedAt      *time.Time
    PostedBy      *uuid.UUID `gorm:"type:uuid"`

    // Relations
    Lines       []VoucherLine `gorm:"foreignKey:VoucherID;constraint:OnDelete:CASCADE"`
    Creator     *User         `gorm:"foreignKey:CreatedBy"`
    Approver    *User         `gorm:"foreignKey:ApprovedBy"`
}

func (Voucher) TableName() string {
    return "vouchers"
}

// BeforeCreate ì „í‘œ ë²ˆí˜¸ ìë™ ìƒì„±
func (v *Voucher) BeforeCreate(tx *gorm.DB) error {
    if v.ID == uuid.Nil {
        v.ID = uuid.New()
    }
    // ì „í‘œ ë²ˆí˜¸ ìƒì„± ë¡œì§ì€ ì„œë¹„ìŠ¤ ë ˆì´ì–´ì—ì„œ ì²˜ë¦¬
    return nil
}

// VoucherLine ì „í‘œ ìƒì„¸
type VoucherLine struct {
    ID           uuid.UUID `gorm:"type:uuid;primary_key;default:uuid_generate_v4()"`
    CompanyID    uuid.UUID `gorm:"type:uuid;not null;index"`
    VoucherID    uuid.UUID `gorm:"type:uuid;not null;index"`
    LineNumber   int       `gorm:"not null"`
    AccountID    uuid.UUID `gorm:"type:uuid;not null"`
    AccountCode  string    `gorm:"size:10;not null"`
    DebitAmount  float64   `gorm:"type:decimal(18,2);not null;default:0"`
    CreditAmount float64   `gorm:"type:decimal(18,2);not null;default:0"`
    Description  string    `gorm:"size:200"`
    PartnerID    *uuid.UUID `gorm:"type:uuid"`
    CreatedAt    time.Time `gorm:"autoCreateTime"`
    UpdatedAt    time.Time `gorm:"autoUpdateTime"`

    // Relations
    Account *Account `gorm:"foreignKey:AccountID"`
    Partner *Partner `gorm:"foreignKey:PartnerID"`
}

func (VoucherLine) TableName() string {
    return "voucher_lines"
}

// Employee ì§ì›
type Employee struct {
    BaseModel
    EmployeeNumber    string    `gorm:"size:20;not null"`
    Name              string    `gorm:"size:50;not null"`
    ResidentNumberEnc []byte    `gorm:"column:resident_number_enc"`
    Email             string    `gorm:"size:100"`
    Phone             string    `gorm:"size:20"`
    DepartmentID      *uuid.UUID `gorm:"type:uuid"`
    Position          string    `gorm:"size:50"`
    EmploymentType    string    `gorm:"size:20"`
    JoinDate          time.Time `gorm:"type:date;not null"`
    LeaveDate         *time.Time `gorm:"type:date"`
    BaseSalary        *float64  `gorm:"type:decimal(18,2)"`
    BankCode          string    `gorm:"size:3"`
    BankAccountEnc    []byte    `gorm:"column:bank_account_enc"`
    Status            string    `gorm:"size:20;default:'ACTIVE'"`
}

func (Employee) TableName() string {
    return "employees"
}
```

---

## 9. ì¸ë±ìŠ¤ ì „ëµ ìš”ì•½

| í…Œì´ë¸” | ì¸ë±ìŠ¤ | ìš©ë„ |
|--------|--------|------|
| vouchers | (company_id, status, voucher_date) | ëª©ë¡ ì¡°íšŒ |
| vouchers | (company_id, voucher_number) | ë²ˆí˜¸ ê²€ìƒ‰ |
| voucher_lines | (account_code) | ê³„ì •ë³„ ì¡°íšŒ |
| ledger_entries | (company_id, account_code, entry_date) | ì›ì¥ ì¡°íšŒ |
| tax_invoices | (company_id, invoice_date, status) | ì„¸ê¸ˆê³„ì‚°ì„œ ëª©ë¡ |
| employees | USING gin (name gin_trgm_ops) | ì´ë¦„ ê²€ìƒ‰ |
| partners | USING gin (name gin_trgm_ops) | ê±°ë˜ì²˜ ê²€ìƒ‰ |
| audit_logs | (entity_type, entity_id) | ë³€ê²½ ì´ë ¥ ì¡°íšŒ |

---

## 10. ì²´í¬ë¦¬ìŠ¤íŠ¸

### ìŠ¤í‚¤ë§ˆ êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] í™•ì¥ ëª¨ë“ˆ ì„¤ì¹˜ (uuid-ossp, pgcrypto, pg_trgm)
- [ ] ê³µí†µ í•¨ìˆ˜ ìƒì„± (current_tenant_id, enable_rls_for_table)
- [ ] ê¸°ì¤€ì •ë³´ í…Œì´ë¸” (companies, users, roles, accounts, partners)
- [ ] íšŒê³„ í…Œì´ë¸” (vouchers, voucher_lines, ledger_entries)
- [ ] ì„¸ê¸ˆê³„ì‚°ì„œ í…Œì´ë¸” (tax_invoices, tax_invoice_items)
- [ ] ì¸ì‚¬/ê¸‰ì—¬ í…Œì´ë¸” (employees, payroll_periods, payslips)
- [ ] ì¬ê³  í…Œì´ë¸” (items, warehouses, inventory_stocks)
- [ ] ê°ì‚¬ ë¡œê·¸ í…Œì´ë¸” (audit_logs)
- [ ] RLS ì •ì±… ì ìš©
- [ ] íŒŒí‹°ì…”ë‹ ì„¤ì • (ledger_entries, inventory_transactions, audit_logs)
- [ ] GORM ëª¨ë¸ ì •ì˜

### ì„±ëŠ¥ ëª©í‘œ

| ì¿¼ë¦¬ ìœ í˜• | ëª©í‘œ | ë¹„ê³  |
|-----------|------|------|
| ë‹¨ê±´ ì¡°íšŒ | < 5ms | Primary Key |
| ëª©ë¡ ì¡°íšŒ | < 50ms | ì¸ë±ìŠ¤ ì‚¬ìš© |
| ì§‘ê³„ ì¿¼ë¦¬ | < 200ms | account_balances í™œìš© |
| ì „ë¬¸ ê²€ìƒ‰ | < 100ms | pg_trgm |

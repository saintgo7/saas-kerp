# K-ERP v0.2 - DB 스키마 상세

**문서 버전**: 0.2.0
**작성일**: 2026-01-16
**상태**: 검토 대기

---

## 목차

1. [데이터베이스 설계 원칙](#1-데이터베이스-설계-원칙)
2. [핵심 테이블 스키마](#2-핵심-테이블-스키마)
3. [회계 모듈 스키마](#3-회계-모듈-스키마)
4. [세금계산서 스키마](#4-세금계산서-스키마)
5. [인사/급여 스키마](#5-인사급여-스키마)
6. [인덱스 전략](#6-인덱스-전략)

---

## 1. 데이터베이스 설계 원칙

### 1.1 멀티테넌시 (Row-Level Security)

```sql
-- RLS 활성화
ALTER TABLE vouchers ENABLE ROW LEVEL SECURITY;

-- 정책 생성
CREATE POLICY tenant_isolation ON vouchers
    USING (company_id = current_setting('app.current_tenant')::uuid);

-- 세션 변수 설정 (미들웨어에서)
SET app.current_tenant = 'company-uuid';
```

### 1.2 공통 컬럼

모든 테이블에 포함되는 공통 컬럼:

```sql
-- 멀티테넌시
company_id UUID NOT NULL REFERENCES companies(id)

-- 감사 컬럼
created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
created_by UUID REFERENCES users(id)
updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
updated_by UUID REFERENCES users(id)

-- 소프트 삭제
deleted_at TIMESTAMPTZ
deleted_by UUID REFERENCES users(id)
```

### 1.3 UUID 전략

```sql
-- uuid-ossp 확장
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- UUID v7 함수 (시간 순서 보장)
CREATE OR REPLACE FUNCTION uuid_generate_v7()
RETURNS UUID AS $$
DECLARE
    timestamp_ms BIGINT;
    uuid_bytes BYTEA;
BEGIN
    timestamp_ms := (EXTRACT(EPOCH FROM clock_timestamp()) * 1000)::BIGINT;
    uuid_bytes := decode(lpad(to_hex(timestamp_ms), 12, '0'), 'hex') ||
                  gen_random_bytes(10);
    uuid_bytes := set_byte(uuid_bytes, 6, (get_byte(uuid_bytes, 6) & 15) | 112);
    uuid_bytes := set_byte(uuid_bytes, 8, (get_byte(uuid_bytes, 8) & 63) | 128);
    RETURN encode(uuid_bytes, 'hex')::UUID;
END;
$$ LANGUAGE plpgsql;
```

---

## 2. 핵심 테이블 스키마

### 2.1 회사 (Tenant)

```sql
CREATE TABLE companies (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v7(),

    -- 기본 정보
    business_number VARCHAR(12) NOT NULL UNIQUE,  -- 사업자등록번호
    company_name VARCHAR(100) NOT NULL,
    company_name_en VARCHAR(100),
    representative VARCHAR(50) NOT NULL,

    -- 사업 정보
    business_type VARCHAR(100),
    business_item VARCHAR(200),
    establishment_date DATE,

    -- 연락처
    phone VARCHAR(20),
    fax VARCHAR(20),
    email VARCHAR(100),
    website VARCHAR(200),

    -- 주소
    zip_code VARCHAR(10),
    address VARCHAR(200),
    address_detail VARCHAR(100),

    -- 설정
    fiscal_year_start_month INTEGER DEFAULT 1,
    currency_code VARCHAR(3) DEFAULT 'KRW',
    timezone VARCHAR(50) DEFAULT 'Asia/Seoul',

    -- 구독 정보
    plan_type VARCHAR(20) DEFAULT 'basic',
    plan_started_at TIMESTAMPTZ,
    plan_expires_at TIMESTAMPTZ,

    -- 상태
    status VARCHAR(20) DEFAULT 'active',

    -- 감사
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

CREATE INDEX idx_companies_business_number ON companies(business_number);
CREATE INDEX idx_companies_status ON companies(status);
```

### 2.2 사용자

```sql
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v7(),
    company_id UUID NOT NULL REFERENCES companies(id),

    -- 인증 정보
    email VARCHAR(100) NOT NULL,
    password_hash VARCHAR(255) NOT NULL,

    -- 프로필
    name VARCHAR(50) NOT NULL,
    phone VARCHAR(20),
    avatar_url VARCHAR(500),

    -- 상태
    status VARCHAR(20) DEFAULT 'active',
    email_verified_at TIMESTAMPTZ,
    last_login_at TIMESTAMPTZ,

    -- MFA
    mfa_enabled BOOLEAN DEFAULT FALSE,
    mfa_secret VARCHAR(100),

    -- 감사
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),

    UNIQUE(company_id, email)
);

CREATE INDEX idx_users_company ON users(company_id);
CREATE INDEX idx_users_email ON users(email);
```

### 2.3 역할 및 권한

```sql
CREATE TABLE roles (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v7(),
    company_id UUID NOT NULL REFERENCES companies(id),

    name VARCHAR(50) NOT NULL,
    description VARCHAR(200),
    is_system BOOLEAN DEFAULT FALSE,

    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),

    UNIQUE(company_id, name)
);

CREATE TABLE permissions (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v7(),

    code VARCHAR(50) NOT NULL UNIQUE,
    name VARCHAR(100) NOT NULL,
    module VARCHAR(50) NOT NULL,
    description VARCHAR(200)
);

CREATE TABLE role_permissions (
    role_id UUID NOT NULL REFERENCES roles(id) ON DELETE CASCADE,
    permission_id UUID NOT NULL REFERENCES permissions(id) ON DELETE CASCADE,

    PRIMARY KEY (role_id, permission_id)
);

CREATE TABLE user_roles (
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    role_id UUID NOT NULL REFERENCES roles(id) ON DELETE CASCADE,

    assigned_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    assigned_by UUID REFERENCES users(id),

    PRIMARY KEY (user_id, role_id)
);
```

---

## 3. 회계 모듈 스키마

### 3.1 계정과목

```sql
CREATE TABLE accounts (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v7(),
    company_id UUID NOT NULL REFERENCES companies(id),

    -- 계정 정보
    code VARCHAR(10) NOT NULL,
    name VARCHAR(100) NOT NULL,
    name_en VARCHAR(100),

    -- 계층 구조
    parent_id UUID REFERENCES accounts(id),
    level INTEGER NOT NULL DEFAULT 1,
    path LTREE,  -- ltree 확장 사용

    -- 분류
    account_type VARCHAR(20) NOT NULL,  -- asset, liability, equity, revenue, expense
    account_nature VARCHAR(10) NOT NULL, -- debit, credit

    -- 설정
    is_active BOOLEAN DEFAULT TRUE,
    is_control_account BOOLEAN DEFAULT FALSE,
    allow_direct_posting BOOLEAN DEFAULT TRUE,

    -- 감사
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),

    UNIQUE(company_id, code)
);

CREATE INDEX idx_accounts_company ON accounts(company_id);
CREATE INDEX idx_accounts_parent ON accounts(parent_id);
CREATE INDEX idx_accounts_path ON accounts USING GIST (path);
CREATE INDEX idx_accounts_type ON accounts(company_id, account_type);
```

### 3.2 전표

```sql
CREATE TABLE vouchers (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v7(),
    company_id UUID NOT NULL REFERENCES companies(id),

    -- 전표 정보
    voucher_no VARCHAR(20) NOT NULL,
    voucher_date DATE NOT NULL,
    voucher_type VARCHAR(20) NOT NULL,  -- general, sales, purchase, payment, receipt

    -- 상태
    status VARCHAR(20) NOT NULL DEFAULT 'draft',  -- draft, approved, posted, cancelled

    -- 금액 (검증용)
    total_debit DECIMAL(18, 2) NOT NULL DEFAULT 0,
    total_credit DECIMAL(18, 2) NOT NULL DEFAULT 0,

    -- 설명
    description VARCHAR(500),
    reference_type VARCHAR(50),
    reference_id UUID,

    -- 승인
    approved_at TIMESTAMPTZ,
    approved_by UUID REFERENCES users(id),
    posted_at TIMESTAMPTZ,
    posted_by UUID REFERENCES users(id),

    -- 감사
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    created_by UUID REFERENCES users(id),
    updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),

    UNIQUE(company_id, voucher_no),
    CONSTRAINT chk_voucher_balance CHECK (total_debit = total_credit)
);

CREATE INDEX idx_vouchers_company_date ON vouchers(company_id, voucher_date);
CREATE INDEX idx_vouchers_status ON vouchers(company_id, status);
CREATE INDEX idx_vouchers_type ON vouchers(company_id, voucher_type);
```

### 3.3 전표 항목

```sql
CREATE TABLE voucher_entries (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v7(),
    voucher_id UUID NOT NULL REFERENCES vouchers(id) ON DELETE CASCADE,
    company_id UUID NOT NULL REFERENCES companies(id),

    -- 항목 정보
    line_no INTEGER NOT NULL,
    account_id UUID NOT NULL REFERENCES accounts(id),

    -- 금액
    debit_amount DECIMAL(18, 2) NOT NULL DEFAULT 0,
    credit_amount DECIMAL(18, 2) NOT NULL DEFAULT 0,

    -- 설명
    description VARCHAR(200),

    -- 보조 정보
    partner_id UUID REFERENCES partners(id),
    department_id UUID REFERENCES departments(id),
    project_id UUID REFERENCES projects(id),

    -- 감사
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),

    UNIQUE(voucher_id, line_no),
    CONSTRAINT chk_entry_amount CHECK (
        (debit_amount > 0 AND credit_amount = 0) OR
        (debit_amount = 0 AND credit_amount > 0)
    )
);

CREATE INDEX idx_voucher_entries_voucher ON voucher_entries(voucher_id);
CREATE INDEX idx_voucher_entries_account ON voucher_entries(company_id, account_id);
```

### 3.4 원장 (집계 테이블)

```sql
CREATE TABLE ledger_balances (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v7(),
    company_id UUID NOT NULL REFERENCES companies(id),
    account_id UUID NOT NULL REFERENCES accounts(id),

    -- 기간
    fiscal_year INTEGER NOT NULL,
    fiscal_month INTEGER NOT NULL,

    -- 잔액
    opening_debit DECIMAL(18, 2) NOT NULL DEFAULT 0,
    opening_credit DECIMAL(18, 2) NOT NULL DEFAULT 0,
    period_debit DECIMAL(18, 2) NOT NULL DEFAULT 0,
    period_credit DECIMAL(18, 2) NOT NULL DEFAULT 0,
    closing_debit DECIMAL(18, 2) NOT NULL DEFAULT 0,
    closing_credit DECIMAL(18, 2) NOT NULL DEFAULT 0,

    -- 감사
    updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),

    UNIQUE(company_id, account_id, fiscal_year, fiscal_month)
);

CREATE INDEX idx_ledger_balances_period ON ledger_balances(company_id, fiscal_year, fiscal_month);
```

---

## 4. 세금계산서 스키마

### 4.1 세금계산서

```sql
CREATE TABLE invoices (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v7(),
    company_id UUID NOT NULL REFERENCES companies(id),

    -- 세금계산서 정보
    invoice_no VARCHAR(30) NOT NULL,
    invoice_type VARCHAR(10) NOT NULL,  -- sales, purchase
    issue_type VARCHAR(20) NOT NULL,    -- normal, modified, cancelled
    issue_date DATE NOT NULL,

    -- 상태
    status VARCHAR(20) NOT NULL DEFAULT 'draft',

    -- 국세청 정보
    nts_confirm_num VARCHAR(24),
    nts_result_code VARCHAR(10),
    nts_result_message VARCHAR(500),

    -- 공급자
    supplier_business_number VARCHAR(12) NOT NULL,
    supplier_company_name VARCHAR(100) NOT NULL,
    supplier_representative VARCHAR(50),
    supplier_address VARCHAR(200),
    supplier_business_type VARCHAR(100),
    supplier_business_item VARCHAR(200),
    supplier_email VARCHAR(100),

    -- 공급받는자
    buyer_business_number VARCHAR(12) NOT NULL,
    buyer_company_name VARCHAR(100) NOT NULL,
    buyer_representative VARCHAR(50),
    buyer_address VARCHAR(200),
    buyer_business_type VARCHAR(100),
    buyer_business_item VARCHAR(200),
    buyer_email VARCHAR(100),

    -- 금액
    supply_amount DECIMAL(18, 0) NOT NULL,
    tax_amount DECIMAL(18, 0) NOT NULL,
    total_amount DECIMAL(18, 0) NOT NULL,

    -- 비고
    notes VARCHAR(500),

    -- Provider 정보
    provider_used VARCHAR(20),  -- scraper, nts_api, popbill
    provider_response JSONB,

    -- 전표 연결
    voucher_id UUID REFERENCES vouchers(id),

    -- 감사
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    created_by UUID REFERENCES users(id),
    updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),

    UNIQUE(company_id, invoice_no)
);

CREATE INDEX idx_invoices_company_date ON invoices(company_id, issue_date);
CREATE INDEX idx_invoices_type ON invoices(company_id, invoice_type);
CREATE INDEX idx_invoices_status ON invoices(company_id, status);
CREATE INDEX idx_invoices_nts_confirm ON invoices(nts_confirm_num);
CREATE INDEX idx_invoices_supplier ON invoices(supplier_business_number);
CREATE INDEX idx_invoices_buyer ON invoices(buyer_business_number);
```

### 4.2 세금계산서 품목

```sql
CREATE TABLE invoice_items (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v7(),
    invoice_id UUID NOT NULL REFERENCES invoices(id) ON DELETE CASCADE,
    company_id UUID NOT NULL REFERENCES companies(id),

    -- 품목 정보
    line_no INTEGER NOT NULL,
    item_date DATE NOT NULL,
    description VARCHAR(200) NOT NULL,

    -- 수량/단가
    specification VARCHAR(100),
    quantity DECIMAL(18, 4) NOT NULL DEFAULT 1,
    unit_price DECIMAL(18, 2) NOT NULL,

    -- 금액
    supply_amount DECIMAL(18, 0) NOT NULL,
    tax_amount DECIMAL(18, 0) NOT NULL,

    -- 비고
    notes VARCHAR(100),

    UNIQUE(invoice_id, line_no)
);

CREATE INDEX idx_invoice_items_invoice ON invoice_items(invoice_id);
```

### 4.3 스크래핑 작업

```sql
CREATE TABLE scrape_jobs (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v7(),
    company_id UUID NOT NULL REFERENCES companies(id),

    -- 작업 정보
    job_type VARCHAR(20) NOT NULL,  -- invoice_scrape, invoice_issue
    status VARCHAR(20) NOT NULL DEFAULT 'pending',

    -- 파라미터
    parameters JSONB NOT NULL,

    -- 결과
    result JSONB,
    error_message TEXT,

    -- 진행
    started_at TIMESTAMPTZ,
    completed_at TIMESTAMPTZ,

    -- 감사
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    created_by UUID REFERENCES users(id)
);

CREATE INDEX idx_scrape_jobs_company ON scrape_jobs(company_id);
CREATE INDEX idx_scrape_jobs_status ON scrape_jobs(status);
```

---

## 5. 인사/급여 스키마

### 5.1 부서

```sql
CREATE TABLE departments (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v7(),
    company_id UUID NOT NULL REFERENCES companies(id),

    -- 부서 정보
    code VARCHAR(10) NOT NULL,
    name VARCHAR(50) NOT NULL,

    -- 계층 구조
    parent_id UUID REFERENCES departments(id),
    level INTEGER NOT NULL DEFAULT 1,
    path LTREE,

    -- 상태
    is_active BOOLEAN DEFAULT TRUE,

    -- 감사
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),

    UNIQUE(company_id, code)
);

CREATE INDEX idx_departments_company ON departments(company_id);
CREATE INDEX idx_departments_path ON departments USING GIST (path);
```

### 5.2 사원

```sql
CREATE TABLE employees (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v7(),
    company_id UUID NOT NULL REFERENCES companies(id),
    user_id UUID REFERENCES users(id),

    -- 사원 정보
    employee_no VARCHAR(20) NOT NULL,
    name VARCHAR(50) NOT NULL,
    name_en VARCHAR(100),

    -- 개인 정보 (암호화 필요)
    resident_number_enc BYTEA,  -- 주민등록번호 암호화
    birth_date DATE,
    gender VARCHAR(10),

    -- 연락처
    phone VARCHAR(20),
    email VARCHAR(100),
    address VARCHAR(200),

    -- 조직
    department_id UUID REFERENCES departments(id),
    position_id UUID REFERENCES positions(id),

    -- 고용 정보
    hire_date DATE NOT NULL,
    resignation_date DATE,
    employment_type VARCHAR(20),  -- regular, contract, part_time

    -- 상태
    status VARCHAR(20) DEFAULT 'active',

    -- 감사
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),

    UNIQUE(company_id, employee_no)
);

CREATE INDEX idx_employees_company ON employees(company_id);
CREATE INDEX idx_employees_department ON employees(company_id, department_id);
CREATE INDEX idx_employees_status ON employees(company_id, status);
```

### 5.3 급여 정보

```sql
CREATE TABLE employee_salaries (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v7(),
    employee_id UUID NOT NULL REFERENCES employees(id),
    company_id UUID NOT NULL REFERENCES companies(id),

    -- 기간
    effective_date DATE NOT NULL,
    end_date DATE,

    -- 급여 정보
    base_salary DECIMAL(18, 0) NOT NULL,
    payment_type VARCHAR(20) NOT NULL,  -- monthly, hourly

    -- 수당
    allowances JSONB DEFAULT '{}',

    -- 계좌
    bank_code VARCHAR(10),
    account_number_enc BYTEA,  -- 계좌번호 암호화
    account_holder VARCHAR(50),

    -- 감사
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),

    UNIQUE(employee_id, effective_date)
);

CREATE INDEX idx_employee_salaries_employee ON employee_salaries(employee_id);
```

### 5.4 급여 명세

```sql
CREATE TABLE payrolls (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v7(),
    company_id UUID NOT NULL REFERENCES companies(id),
    employee_id UUID NOT NULL REFERENCES employees(id),

    -- 기간
    pay_year INTEGER NOT NULL,
    pay_month INTEGER NOT NULL,

    -- 상태
    status VARCHAR(20) NOT NULL DEFAULT 'draft',

    -- 지급 항목
    base_salary DECIMAL(18, 0) NOT NULL DEFAULT 0,
    overtime_pay DECIMAL(18, 0) NOT NULL DEFAULT 0,
    bonus DECIMAL(18, 0) NOT NULL DEFAULT 0,
    allowances JSONB DEFAULT '{}',
    total_earnings DECIMAL(18, 0) NOT NULL DEFAULT 0,

    -- 공제 항목
    income_tax DECIMAL(18, 0) NOT NULL DEFAULT 0,
    local_income_tax DECIMAL(18, 0) NOT NULL DEFAULT 0,
    nps_employee DECIMAL(18, 0) NOT NULL DEFAULT 0,
    nhis_employee DECIMAL(18, 0) NOT NULL DEFAULT 0,
    ei_employee DECIMAL(18, 0) NOT NULL DEFAULT 0,
    other_deductions JSONB DEFAULT '{}',
    total_deductions DECIMAL(18, 0) NOT NULL DEFAULT 0,

    -- 실수령액
    net_pay DECIMAL(18, 0) NOT NULL DEFAULT 0,

    -- 지급
    payment_date DATE,
    paid_at TIMESTAMPTZ,

    -- 전표 연결
    voucher_id UUID REFERENCES vouchers(id),

    -- 감사
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),

    UNIQUE(company_id, employee_id, pay_year, pay_month)
);

CREATE INDEX idx_payrolls_company_period ON payrolls(company_id, pay_year, pay_month);
CREATE INDEX idx_payrolls_employee ON payrolls(employee_id);
CREATE INDEX idx_payrolls_status ON payrolls(company_id, status);
```

### 5.5 4대보험 신고

```sql
CREATE TABLE insurance_reports (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v7(),
    company_id UUID NOT NULL REFERENCES companies(id),

    -- 신고 정보
    report_type VARCHAR(20) NOT NULL,  -- acquisition, loss, change, monthly
    agency_type VARCHAR(10) NOT NULL,  -- nps, nhis, ei, wci

    -- 대상
    employee_id UUID REFERENCES employees(id),

    -- 기간
    report_year INTEGER,
    report_month INTEGER,
    effective_date DATE,

    -- 상태
    status VARCHAR(20) NOT NULL DEFAULT 'pending',

    -- 신고 데이터
    report_data JSONB NOT NULL,

    -- 결과
    receipt_number VARCHAR(50),
    submitted_at TIMESTAMPTZ,
    result_code VARCHAR(20),
    result_message TEXT,

    -- EDI 정보
    edi_message TEXT,
    edi_response TEXT,

    -- 감사
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    created_by UUID REFERENCES users(id)
);

CREATE INDEX idx_insurance_reports_company ON insurance_reports(company_id);
CREATE INDEX idx_insurance_reports_employee ON insurance_reports(employee_id);
CREATE INDEX idx_insurance_reports_status ON insurance_reports(status);
CREATE INDEX idx_insurance_reports_agency ON insurance_reports(company_id, agency_type);
```

---

## 6. 인덱스 전략

### 6.1 복합 인덱스 가이드

```sql
-- 자주 사용되는 조회 패턴에 맞춘 복합 인덱스

-- 전표 조회: 회사별 + 기간별
CREATE INDEX idx_vouchers_company_date_status
    ON vouchers(company_id, voucher_date, status);

-- 세금계산서 조회: 회사별 + 유형별 + 기간별
CREATE INDEX idx_invoices_company_type_date
    ON invoices(company_id, invoice_type, issue_date DESC);

-- 급여 조회: 회사별 + 기간별
CREATE INDEX idx_payrolls_company_year_month
    ON payrolls(company_id, pay_year DESC, pay_month DESC);
```

### 6.2 부분 인덱스

```sql
-- 활성 데이터만 인덱싱
CREATE INDEX idx_employees_active
    ON employees(company_id, department_id)
    WHERE status = 'active';

-- 미처리 작업만 인덱싱
CREATE INDEX idx_scrape_jobs_pending
    ON scrape_jobs(company_id, created_at)
    WHERE status IN ('pending', 'processing');
```

### 6.3 GIN 인덱스 (JSONB)

```sql
-- JSONB 필드 검색용
CREATE INDEX idx_payrolls_allowances ON payrolls USING GIN (allowances);
CREATE INDEX idx_insurance_reports_data ON insurance_reports USING GIN (report_data);
```

---

**다음 문서**: [14_모니터링_로깅_전략.md](./14_모니터링_로깅_전략.md)
